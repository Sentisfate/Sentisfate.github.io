<!DOCTYPE html>
<html><head>
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer" />
   
  <meta name="author" content="gisculibur">
  

   
  
  
  
  
  
  
  <meta name="keywords"
    content="theme,kagome">
  

  

  <meta name="generator" content="Hugo 0.115.2">


  
  
  
  
  <title>åŠ è½½æœ¬åœ°æ•°æ® ğŸŒŸ GISå’–å–±æ£’</title>

  <meta property="og:title" content="åŠ è½½æœ¬åœ°æ•°æ®" />
<meta property="og:description" content="1.shapefile æ€è·¯ï¼šCesiumæ— æ³•ç›´æ¥è¯†åˆ«shapefileï¼Œå› æ­¤éœ€è¦å°†shapefileæ ¼å¼æ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼Œè€ƒè™‘åˆ°Cesiumç›´æ¥æ”¯æŒçš„çŸ¢é‡æ•°æ®æ ¼å¼æœ‰" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Sentisfate.github.io/docs/gml6fmm2rkb8ap2h/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2022-12-11T07:07:18+00:00" />
<meta property="article:modified_time" content="2023-04-25T12:28:03+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="åŠ è½½æœ¬åœ°æ•°æ®"/>
<meta name="twitter:description" content="1.shapefile æ€è·¯ï¼šCesiumæ— æ³•ç›´æ¥è¯†åˆ«shapefileï¼Œå› æ­¤éœ€è¦å°†shapefileæ ¼å¼æ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼Œè€ƒè™‘åˆ°Cesiumç›´æ¥æ”¯æŒçš„çŸ¢é‡æ•°æ®æ ¼å¼æœ‰"/>


  
  
  
  
  <link rel="stylesheet" href="https://Sentisfate.github.io/assets/css/style.min.a9eba8a87a1f5444669cfe92317af83504187100f2529f484b2eeaff89777b86.css" integrity="sha256-qeuoqHofVERmnP6SMXr4NQQYcQDyUp9ISy7q/4l3e4Y=">

  <script src="https://Sentisfate.github.io/assets/js/main.min.182da266209851bc7c828aa7377f98f914e1e76c8decdd53a6cbe9bffea92cde.js" integrity="sha256-GC2iZiCYUbx8goqnN3&#43;Y&#43;RTh52yN7N1Tpsvpv/6pLN4="></script>

  </head><body><header class="header-container layout-block layout-padding">
  <div class="header-inner content-padding-large soft-size--large soft-style--box">
    <div class="header-logo">
      <a href="https://Sentisfate.github.io"><h1>GISå’–å–±æ£’</h1></a>
    </div>
    <nav class="header-nav">
      <div class="header-nav--btn">
        <div class="btn-item"></div>
        <div class="btn-item"></div>
        <div class="btn-item"></div>
      </div>
      <div class="header-nav--list">
        <div>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/" title="GISå’–å–±æ£’">ä¸»é¡µ</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/docs/" title="Docs">ç¬”è®°</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/categories/" title="Categories">åˆ†ç±»</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/tags/" title="Tags">æ ‡ç­¾</a>
          
        </div>
      </div>
    </nav>
  </div>
</header><main id="content">
    

    <div class="single-container layout-block">
      <div class="article-info">
        <div class="article-header layout-padding">
          <div class="article-cover card-container content-padding-large soft-size--large soft-style--box img">

  <div class="card-cover">
    
      <img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1670831494939-30245c7b-76e1-4b8f-94f1-1bc95abbd956.png" alt="https://cdn.nlark.com/yuque/0/2022/png/29064333/1670831494939-30245c7b-76e1-4b8f-94f1-1bc95abbd956.png" />
    
  </div>

  <div class="card-text">
    <h1 class="card-text--title">åŠ è½½æœ¬åœ°æ•°æ®</h1>
    
      <p class="card-text--row">2022-12-11 07:07</p>
      
      
      

      
      
    
  </div>

</div>
        </div>

        <div class="article-content">
          <div class="markdown-body content-padding-large soft-size--large soft-style--box">
            <p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="1shapefile">1.shapefile</h1>
<p>æ€è·¯ï¼š<!-- raw HTML omitted -->Cesiumæ— æ³•ç›´æ¥è¯†åˆ«shapefileï¼Œå› æ­¤éœ€è¦å°†shapefileæ ¼å¼æ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼Œè€ƒè™‘åˆ°Cesiumç›´æ¥æ”¯æŒçš„çŸ¢é‡æ•°æ®æ ¼å¼æœ‰<code>geojson,topojson,kml,czml</code>ï¼Œå› æ­¤å¯ä»¥å°†shpè½¬geojson</p>
<blockquote>
<p>geojson æ¦‚å¿µè¯¦è§£ <a href="https://zh.m.wikipedia.org/zh-sg/GeoJSON" target="_blank" rel="noopener">https://zh.m.wikipedia.org/zh-sg/GeoJSON</a>
<a href="https://zhuanlan.zhihu.com/p/344042884" target="_blank" rel="noopener">Cesiumå¼€å‘åŸºç¡€ç¯‡ | 03åŠ è½½çŸ¢é‡æ•°æ®</a></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">viewer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Viewer</span>(<span style="color:#e6db74">&#39;cesiumContainer&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">dataSources</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeoJsonDataSource</span>.<span style="color:#a6e22e">load</span>(<span style="color:#e6db74">&#39;../../SampleData/ne_10m_us_states.topojson&#39;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">stroke</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Color</span>.<span style="color:#a6e22e">HOTPINK</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Color</span>.<span style="color:#a6e22e">PINK</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">strokeWidth</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">markerSymbol</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;?&#39;</span>
</span></span><span style="display:flex;"><span>}));
</span></span></code></pre></div><p>é—®é¢˜å…³é”®åœ¨äºå¦‚ä½•è½¬æ¢ä¸ºgeojsonï¼Œè¿™é‡Œè°ƒç”¨æŸå¤§ä½¬å†™çš„shapefileè½¬geojsonè„šæœ¬ï¼Œå‚çœ‹ï¼š<!-- raw HTML omitted --><a href="https://github.com/calvinmetcalf/shapefile-js" target="_blank" rel="noopener">https://github.com/calvinmetcalf/shapefile-js</a><!-- raw HTML omitted -->ä½¿ç”¨è¿‡ç¨‹ã€‚</p>
<ol>
<li>å®‰è£…<code>npm i shpjs --save</code>ï¼Œä»ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åªé€‰æ‹©shp.jsæ–‡ä»¶ï¼Œå°†å…¶å¤åˆ¶åˆ°æˆ‘ä»¬çš„ä»£ç åº“å³å¯</li>
</ol>
<p>
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1670831494939-30245c7b-76e1-4b8f-94f1-1bc95abbd956.png#averageHue=%2324292d&amp;clientId=udcfe0234-9308-4&amp;from=paste&amp;height=405&amp;id=u2172dcda&amp;originHeight=506&amp;originWidth=384&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23752&amp;status=done&amp;style=none&amp;taskId=ua4d26c1e-1d66-47a9-89c0-84a2a821845&amp;title=&amp;width=307.2" alt="image.png" loading="lazy" /></p>
</p>
<ol start="2">
<li>åœ¨éœ€è¦ä½¿ç”¨çš„æ–‡ä»¶ä¸­ä»¥ç”¨è¯¥æ–‡ä»¶å³å¯ã€‚å¦‚</li>
</ol>
<p>
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1670831598783-036e9a79-1139-49d5-9399-e087e0029cb3.png#averageHue=%2327282a&amp;clientId=udcfe0234-9308-4&amp;from=paste&amp;height=342&amp;id=u0a5310b6&amp;originHeight=427&amp;originWidth=360&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=21375&amp;status=done&amp;style=none&amp;taskId=ucf523bb0-ad0c-4ee8-ab94-f85fa280a14&amp;title=&amp;width=288" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->åœ¨ä¸Šé¢è¿™ç§ç›®å½•æƒ…å†µä¸‹ï¼Œåœ¨app.jsxä¸­å¼•ç”¨å³å¯<!-- raw HTML omitted --><code>import './common/js/shp.js';</code></p>
<ol start="3">
<li>æ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«çš„è°ƒç”¨<code>shp</code>æ–¹æ³•æ¥è¿›è¡Œshapefileçš„è½¬æ¢äº†.</li>
</ol>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå°±æœ¬äººç›®å‰çš„è¸©å‘ç»å†ï¼Œå‘ç°åªéœ€<code>.**shp**</code>ï¼Œ.<code>**dbf**</code>ï¼Œ<code>.prj</code>å°±å¯ä»¥è½¬æ¢ä¸ºgeojson</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// ä»¥æ–‡ä»¶ä¸Šä¼ çš„å½¢å¼ä¸ºä¾‹ï¼Œè¿›è¡Œè½¬æ¢å¹¶åœ¨Cesiumä¸­æ˜¾ç¤º
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">splitFileName</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">fullname</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fullname</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;.&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">arr</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">return</span> [<span style="color:#a6e22e">fullname</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">extname</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">arr</span>.<span style="color:#a6e22e">pop</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">prename</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">arr</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;.&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> [<span style="color:#a6e22e">prename</span>, <span style="color:#a6e22e">extname</span>];
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">upload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">files</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é’ˆå¯¹ä¸Šä¼ çš„æ˜¯zipæ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> [<span style="color:#a6e22e">prename</span>, <span style="color:#a6e22e">extname</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">splitFileName</span>(<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">name</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">extname</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;zip&#39;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;è¯·æ£€æŸ¥é€‰æ‹©çš„æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼Œshpafile çš„zipæ ¼å¼å‹ç¼©åŒ…&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// è¯»å–zipæ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">buffer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">arrayBuffer</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// å°†äºŒè¿›åˆ¶æ•°æ®è½¬ä¸ºgeojson
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">geojson</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">shp</span>(<span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">geojson</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (Array.<span style="color:#a6e22e">isArray</span>(<span style="color:#a6e22e">geojson</span>)) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">item</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">geojson</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// å¤šä¸€ä¸ªfilenameå±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">dataSources</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeoJsonDataSource</span>.<span style="color:#a6e22e">load</span>(<span style="color:#a6e22e">item</span>));
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">dataSources</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeoJsonDataSource</span>.<span style="color:#a6e22e">load</span>(<span style="color:#a6e22e">geojson</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;zip æ•°æ®å‡ºé”™&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">shpBuffer</span>, <span style="color:#a6e22e">dbfBuffer</span>, <span style="color:#a6e22e">prj</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> [<span style="color:#a6e22e">prename</span>, <span style="color:#a6e22e">extname</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">splitFileName</span>(<span style="color:#a6e22e">files</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">name</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">extname</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;shp&#39;</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">shpBuffer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">files</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">arrayBuffer</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">extname</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;dbf&#39;</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">dbfBuffer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">files</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">arrayBuffer</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">extname</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;prj&#39;</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reader</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FileReader</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">prj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>          };
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">readAsText</span>(<span style="color:#a6e22e">files</span>[<span style="color:#a6e22e">i</span>]);
</span></span><span style="display:flex;"><span>        } 
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">shpBuffer</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">dbfBuffer</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">prj</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">geojson</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">shp</span>.<span style="color:#a6e22e">combine</span>([
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">shp</span>.<span style="color:#a6e22e">parseShp</span>(<span style="color:#a6e22e">shpBuffer</span>, <span style="color:#a6e22e">prj</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">shp</span>.<span style="color:#a6e22e">parseDbf</span>(<span style="color:#a6e22e">dbfBuffer</span>),
</span></span><span style="display:flex;"><span>          ]);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">dataSources</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeoJsonDataSource</span>.<span style="color:#a6e22e">load</span>(<span style="color:#a6e22e">geojson</span>));
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;åŠ è½½shapefileæ•°æ®å‡ºé”™&#39;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;è¯·æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  };
</span></span></code></pre></div><p>å…³äºä¸­æ–‡ä¹±ç é—®é¢˜<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1670853686826-b613da3e-fb3d-41d9-9d13-07688b252c48.png#averageHue=%23f1f0f0&amp;clientId=udcfe0234-9308-4&amp;from=paste&amp;id=u50192331&amp;originHeight=769&amp;originWidth=712&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=49315&amp;status=done&amp;style=none&amp;taskId=ud985057d-9447-4703-89b2-d60828e16a3&amp;title=" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->.dbf æ–‡ä»¶å¤´ä¸­ç¬¬29ä¸ªå­—èŠ‚ï¼ˆä»0å¼€å§‹ï¼‰è¡¨ç¤ºLanguage driver IDï¼Œå…¶ä»£è¡¨çš„ç¼–ç é¡µå‚ç…§ä»¥ä¸‹é“¾æ¥<!-- raw HTML omitted --><a href="http://shapelib.maptools.org/codepage.html?d=1563413688103" target="_blank" rel="noopener">http://shapelib.maptools.org/codepage.html?d=1563413688103</a><!-- raw HTML omitted -->åœ¨ç»†çœ‹shpjsçš„æºç æ—¶ï¼Œå‘ç°äº†<code>shp.parseDbf()</code>æœ‰ç¬¬äºŒä¸ªå¯é€‰å‚æ•°ç¼–ç æ ¼å¼cpgã€‚æ­£å¸¸åœ¨å¯¼å‡ºshapefileæ–‡ä»¶æ—¶ï¼Œarcgis10.2.1ä»¥å‰ç‰ˆæœ¬ï¼Œå›½å†…dbfæ ¼å¼ç¼–ç ä¸º<code>GBK</code>ï¼Œè€Œä»¥åç‰ˆæœ¬é»˜è®¤ä¸º<code>UTF-8</code>ã€‚å¦‚æœä½¿ç”¨QGISå¯¼å‡ºshapefileæ—¶ï¼Œæ˜¯å¯ä»¥é€‰æ‹©ç¼–ç æ ¼å¼çš„ï¼Œå¹¶ä¸”å¤šä¸€ä¸ª<code>.cpg</code>æ–‡ä»¶ã€‚å› æ­¤å¯¹äºä¸­æ–‡ä¹±ç çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯é€šè¿‡è®¾ç½®cpgå‚æ•°ï¼Œå’Œprjä¸€æ ·ï¼Œå­—ç¬¦ä¸²å½¢å¼ã€‚å¦‚<code>'GBK'</code>ï¼ŒåŸºæœ¬å¯ä»¥è§£å†³å›½å†…ä¸­æ–‡ä¹±ç é—®é¢˜ã€‚<!-- raw HTML omitted -->ä¾‹ï¼š<code>shp.parseDbf(dbf,cpg)</code><!-- raw HTML omitted --><strong>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸Šè¡¨çš„dbfæ–‡ä»¶çš„ç¬¬29ä¸ªå­—èŠ‚ï¼Œæ¥è¿›è¡ŒåŠ¨æ€åˆ¤æ–­å½“å‰dbfçš„ç¼–ç æ ¼å¼ã€‚</strong></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="2åœ¨æŒ‡å®šä½ç½®åŠ è½½ä¸€å¼ å›¾ç‰‡-img">2.åœ¨æŒ‡å®šä½ç½®åŠ è½½ä¸€å¼ å›¾ç‰‡ img</h1>
<p>å‚è€ƒapi</p>
<ul>
<li>ImageryLayer</li>
<li>ImageryProvider  å½±åƒå›¾å±‚çš„æ•°æ®æº</li>
</ul>
<p>åœ¨imagerProviderä¸­æœ‰ä¸€ä¸ªè´Ÿè´£åŠ è½½å•ä¸ªå›¾ç‰‡çš„api <code>**SingleTileImageryProvider**</code>ã€‚å…¶æ¥æ”¶çš„æ„é€ å‚æ•°å¦‚ä¸‹ï¼š<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1670920064426-ca22c6dc-33d3-4f5b-a856-747530180927.png#averageHue=%23f4f2f1&amp;clientId=u3dc7df94-d8d7-4&amp;from=paste&amp;height=359&amp;id=u5fe2f9d0&amp;originHeight=449&amp;originWidth=1301&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=74421&amp;status=done&amp;style=none&amp;taskId=u46cd8fd1-cfd1-4460-b10e-4b2325bc43a&amp;title=&amp;width=1040.8" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->ä¹Ÿå°±æ˜¯è¯´éœ€è¦åŠ è½½å›¾ç‰‡ï¼Œå°±å¿…é¡»è¦è·å¾—å›¾ç‰‡çš„urlã€‚å¦‚æœå›¾ç‰‡åœ¨æ‰“åŒ…çš„æ–‡ä»¶å¤¹ä¸­ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç½‘ç»œè·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„æ¥åŠ è½½ã€‚è€Œå¦‚ä½•è·å¾—ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡çš„urlï¼Œå°±æ˜¯è§£å†³é—®é¢˜å…³é”®æ‰€åœ¨ã€‚<!-- raw HTML omitted --><code>**URL.createObjectUrl()**</code><strong>åˆšå¥½å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</strong><!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1670920321046-d0382c05-ea51-4d83-af29-ba82df0799d0.png#averageHue=%23252424&amp;clientId=u3dc7df94-d8d7-4&amp;from=paste&amp;height=294&amp;id=u5e695b31&amp;originHeight=367&amp;originWidth=1008&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=48898&amp;status=done&amp;style=none&amp;taskId=u03b32caf-106b-464b-ac4a-9a323452b65&amp;title=&amp;width=806.4" alt="image.png" loading="lazy" /></p>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">uploadImage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgUrl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">createObjectURL</span>(<span style="color:#a6e22e">file</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">setUrl</span>(<span style="color:#a6e22e">imgUrl</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rectangle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Rectangle</span>.<span style="color:#a6e22e">fromDegrees</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">112.2588781098</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">39.5047262435</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">112.2981585251</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">39.5233702752</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">imageryLayers</span>.<span style="color:#a6e22e">addImageryProvider</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">SingleTileImageryProvider</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">imgUrl</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">rectangle</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">rectangle</span>,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">camera</span>.<span style="color:#a6e22e">setView</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">destination</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Rectangle</span>.<span style="color:#a6e22e">fromDegrees</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">112.2770508586</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">39.5050978677</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">112.2776657605</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">39.5193995362</span>
</span></span><span style="display:flex;"><span>    ), 
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">imageryLayer</span>.<span style="color:#a6e22e">getViewableRectangle</span>().<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">rectangle</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">camera</span>.<span style="color:#a6e22e">flyTo</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">destination</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">rectangle</span>
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>æ­¤æ—¶å¯ä»¥å®ç°çš„æ˜¯åœ¨æŒ‡å®šä½ç½®ä¸ŠåŠ è½½å›¾ç‰‡äº†ï¼Œä½†æ˜¯ï¼Œç”±äºRectangleæ˜¯æ°´å¹³å‚ç›´çš„ï¼Œå¾ˆæ˜æ˜¾ä¸ç¬¦åˆåŠ è½½çš„ç›®æ ‡ã€‚<!-- raw HTML omitted -->æ¢ä¸€ç§æ€è·¯ï¼Œèƒ½å¦åœ¨å®ä½“ä¸ŠåŠ è½½å›¾ç‰‡å‘¢ï¼Œå®ä½“æ˜¯å¯ä»¥è¿›è¡Œæ—‹è½¬å¹³ç§»ç­‰å˜æ¢çš„ã€‚<!-- raw HTML omitted -->å‚è€ƒapi</p>
<ul>
<li>Entity</li>
</ul>
<p>å‚è€ƒç¤ºä¾‹</p>
<ul>
<li><a href="https://sandcastle.cesium.com/?src=Rectangle.html&amp;label=Geometries" target="_blank" rel="noopener">https://sandcastle.cesium.com/?src=Rectangle.html&amp;label=Geometries</a></li>
<li><a href="https://sandcastle.cesium.com/?src=Plane.html&amp;label=Geometries" target="_blank" rel="noopener">https://sandcastle.cesium.com/?src=Plane.html&amp;label=Geometries</a></li>
<li><a href="https://sandcastle.cesium.com/index.html?src=Billboards.html" target="_blank" rel="noopener">https://sandcastle.cesium.com/index.html?src=Billboards.html</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">rotation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.Math.<span style="color:#a6e22e">toRadians</span>(<span style="color:#ae81ff">30</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// åŠ¨æ€æ—‹è½¬
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getRotationValue</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">rotation</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">0.005</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rotation</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rec</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">add</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">rectangle</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">coordinates</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Rectangle</span>.<span style="color:#a6e22e">fromDegrees</span>(<span style="color:#ae81ff">112</span>,<span style="color:#ae81ff">39</span>,<span style="color:#ae81ff">113</span>,<span style="color:#ae81ff">40</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å¡«å……ææ–™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">material</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">imgUrl</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// çŸ©å½¢æ—‹è½¬
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">rotation</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">CallbackProperty</span>(<span style="color:#a6e22e">getRotationValue</span>, <span style="color:#66d9ef">false</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//çŸ©å½¢çº¹ç†æ—‹è½¬ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">stRotation</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">CallbackProperty</span>(<span style="color:#a6e22e">getRotationValue</span>, <span style="color:#66d9ef">false</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">classificationType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ClassificationType</span>.<span style="color:#a6e22e">TERRAIN</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ç«‹æ–¹ä½“åº•éƒ¨é«˜åº¦ï¼Œèµ·å§‹é«˜åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">extrudedHeight</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ç«‹æ–¹ä½“çš„é«˜åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">100.0</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">plane</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">add</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Red plane with black outline&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// å¹³é¢ä¸­å¿ƒç‚¹çš„ä½ç½®åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian3</span>.<span style="color:#a6e22e">fromDegrees</span>(<span style="color:#ae81ff">112.2981585251</span>, <span style="color:#ae81ff">39.5233702752</span>, <span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plane</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å¹³é¢çš„ä½ç½® ax+by+cz+d=0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">plane</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Plane</span>(<span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian3</span>.<span style="color:#a6e22e">UNIT_Z</span>, <span style="color:#ae81ff">0.0</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¹³é¢çš„å®½é«˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">dimensions</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian2</span>(<span style="color:#ae81ff">4000.0</span>, <span style="color:#ae81ff">3000.0</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">material</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">imgUrl</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">outline</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">outlineColor</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Color</span>.<span style="color:#a6e22e">BLACK</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">entity</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">add</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// id: &#34;&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;billboard&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// show: true,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// description: &#34;&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// orientation: &#34;&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian3</span>.<span style="color:#a6e22e">fromDegrees</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">75.59777</span>, <span style="color:#ae81ff">40.03883</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">billboard</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">show</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#75715e">// default
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">image</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;./images/Cesium_Logo_overlay.png&#34;</span>, <span style="color:#75715e">// default: undefined
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">scale</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2.0</span>, <span style="color:#75715e">// default: 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//åƒç´ åç§»    type: Cartesian2    default:Cartesian2.ZERO
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">pixelOffset</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian2</span>(<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">50</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//çœ¼ç›åç§»    type: Cartesian3    default:Cartesian3.ZERO
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">eyeOffset</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian3</span>(<span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>),
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// æ°´å¹³å¯¹é½æ–¹å¼  type: HorizontalOrigin  default:HorizontalOrigin.CENTER
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// CENTER åŸç‚¹åœ¨å¯¹è±¡çš„æ°´å¹³ä¸­å¿ƒï¼›LEFT åŸç‚¹åœ¨å¯¹è±¡çš„å·¦ä¾§ï¼›RIGHT åŸç‚¹åœ¨å¯¹è±¡çš„å³ä¾§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">horizontalOrigin</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">HorizontalOrigin</span>.<span style="color:#a6e22e">CENTER</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å‚ç›´å¯¹é½æ–¹å¼  type: VerticalOrigin  default:VerticalOrigin.CENTER
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// CENTER åŸç‚¹ä½äº BASELINE å’Œ TOP ä¹‹é—´çš„å‚ç›´ä¸­å¿ƒï¼›BOTTOM åŸç‚¹åœ¨å¯¹è±¡çš„åº•éƒ¨ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// BASELINE å¦‚æœå¯¹è±¡åŒ…å«æ–‡æœ¬ï¼Œåˆ™åŸç‚¹ä½äºæ–‡æœ¬çš„åŸºçº¿ï¼Œå¦åˆ™åŸç‚¹ä½äºå¯¹è±¡çš„åº•éƒ¨ï¼›TOP åŸç‚¹åœ¨å¯¹è±¡çš„é¡¶éƒ¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">verticalOrigin</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">VerticalOrigin</span>.<span style="color:#a6e22e">BOTTOM</span>, <span style="color:#75715e">// default: CENTER å‚ç›´å¯¹é½ä½ç½® å‚è€ƒCesium.VerticalOrigin
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è·å–æˆ–è®¾ç½®æ­¤å¹¿å‘Šç‰Œçš„é«˜åº¦å‚è€ƒ    type: HeightReference    default:HeightReference.NONE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// NONE ä½ç½®ç»å¯¹ï¼›CLAMP_TO_GROUND ä½ç½®å›ºå®šåœ¨åœ°å½¢ä¸Šï¼›RELATIVE_TO_GROUND ä½ç½®é«˜åº¦æ˜¯æŒ‡åœ°å½¢ä¸Šæ–¹çš„é«˜åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">heightReference</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">HeightReference</span>.<span style="color:#a6e22e">CLAMP_TO_GROUND</span>,
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é¢œè‰²  type: Color  default:Color.WHITE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Color</span>.<span style="color:#a6e22e">LIME</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è·å–æˆ–è®¾ç½®ä»¥å¼§åº¦ä¸ºå•ä½çš„æ—‹è½¬è§’åº¦  type: number  default:0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">rotation</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.Math.<span style="color:#a6e22e">PI_OVER_FOUR</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è·å–æˆ–è®¾ç½®ä¸–ç•Œç©ºé—´ä¸­çš„å¯¹é½è½´  type:Cartesian3  default:Cartesian3.ZERO
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">alignedAxis</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian3</span>.<span style="color:#a6e22e">ZERO</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">100</span>, <span style="color:#75715e">// default: undefined
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">25</span>, <span style="color:#75715e">// default: undefined
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// æ ¹æ®å¹¿å‘Šç‰Œä¸ç›¸æœºçš„è·ç¦»è·å–æˆ–è®¾ç½®å¹¿å‘Šç‰Œçš„è¿‘å’Œè¿œç¼©æ”¾å±æ€§  type:NearFarScalar
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">scaleByDistance</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">NearFarScalar</span>(<span style="color:#ae81ff">1.0</span><span style="color:#a6e22e">e3</span>, <span style="color:#ae81ff">2.0</span>, <span style="color:#ae81ff">2.0</span><span style="color:#a6e22e">e3</span>, <span style="color:#ae81ff">1.0</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// æ ¹æ®å¹¿å‘Šç‰Œåˆ°ç›¸æœºçš„è·ç¦»ï¼Œè·å–æˆ–è®¾ç½®å¹¿å‘Šç‰Œçš„è¿‘å’Œè¿œåŠé€æ˜å±æ€§  type:NearFarScalar
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">translucencyByDistance</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">NearFarScalar</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">1.0</span><span style="color:#a6e22e">e3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">1.5</span><span style="color:#a6e22e">e6</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// æ ¹æ®å¹¿å‘Šç‰Œä¸æ‘„åƒå¤´çš„è·ç¦»ï¼Œè·å–æˆ–è®¾ç½®å¹¿å‘Šç‰Œçš„è¿‘åƒç´ åç§»é‡å’Œè¿œåƒç´ åç§»é‡ç¼©æ”¾å±æ€§  type:NearFarScalar
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">pixelOffsetScaleByDistance</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">NearFarScalar</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">1.0</span><span style="color:#a6e22e">e3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">1.5</span><span style="color:#a6e22e">e6</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è®¾ç½®1000ç±³å’Œ2000ç±³ä¹‹é—´å¯è§  type:DistanceDisplayCondition
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// distanceDisplayCondition: new Cesium.DistanceDisplayCondition(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//   1.0e3,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//   2.0e3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// ),
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// è·å–æˆ–è®¾ç½®ä¸ç›¸æœºçš„è·ç¦»ï¼Œåœ¨æ·±åº¦å¤„ç¦ç”¨æ·±åº¦æµ‹è¯•ï¼Œä¾‹å¦‚ï¼Œä»¥é˜²æ­¢å‰ªåˆ‡åœ°å½¢ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// è®¾ç½®ä¸ºé›¶æ—¶ï¼Œå°†å§‹ç»ˆåº”ç”¨æ·±åº¦æµ‹è¯•ã€‚è®¾ç½®ä¸ºNumber.POSITIVE_INFINITYæ—¶ï¼Œæ°¸è¿œä¸ä¼šåº”ç”¨æ·±åº¦æµ‹è¯•ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">disableDepthTestDistance</span><span style="color:#f92672">:</span> Number.<span style="color:#a6e22e">POSITIVE_INFINITY</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span> 
</span></span></code></pre></div><p>æ”¹å˜å›¾ç‰‡çš„å®½é«˜ï¼Œåªéœ€è¦è°ƒæ•´å…¶ä¸­çš„å‚æ•°å³å¯ã€‚æ”¹å˜å›¾ç‰‡çš„å§¿æ€ï¼Œç›®å‰å°è¯•åªèƒ½è°ƒæ•´å¹³é¢çš„ä½ç½®å‚æ•°ã€‚æ¨¡å‹çš„å§¿æ€å¯é€šè¿‡ orientationå®ç°ã€‚</p>
<p>
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1671003637111-06593d80-e29e-48fb-82a8-faa4fbff0211.png#averageHue=%23e2d8ca&amp;clientId=u2b0e6119-a506-4&amp;from=paste&amp;id=ud8bcd2de&amp;originHeight=600&amp;originWidth=800&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=231108&amp;status=done&amp;style=none&amp;taskId=ubdf0160f-1be3-4fab-a85b-caebf446615&amp;title=" alt="image.png" loading="lazy" /></p>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">orientation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Transforms</span>.<span style="color:#a6e22e">headingPitchRollQuaternion</span>(<span style="color:#a6e22e">position</span>,<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">HeadingPitchRoll</span>.<span style="color:#a6e22e">fromDegrees</span>(<span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">0</span>))
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="3åŠ è½½æ …æ ¼æ•°æ®å¦‚-ascii">3.åŠ è½½æ …æ ¼æ•°æ®å¦‚ ascii</h1>
<p><a href="https://blog.csdn.net/lovefengruoqing/article/details/115306876" target="_blank" rel="noopener">https://blog.csdn.net/lovefengruoqing/article/details/115306876</a><!-- raw HTML omitted -->å¯¹äºasciiç ï¼Œæ–‡ä»¶æ ¼å¼å¤§æ¦‚å¦‚ä¸‹</p>
<pre tabindex="0"><code>NCOLS xxx
NROWS xxx
XLLCORNER xxx
YLLCORNER xxx
CELLSIZE xxx
NODATA_VALUE xxx
row 1
row 2
.
.
row n
</code></pre><pre tabindex="0"><code>NCOLS 480
NROWS 450
XLLCORNER 378922
YLLCORNER 4072345
CELLSIZE 30
NODATA_VALUE -32768
43 2 45 7 3 56 2 5 23 65 34 6 32 54 57 34
35 45 65 34 2 6 78 4 2 6 89 3 2 7 45 23 5 ...
</code></pre><ul>
<li><strong>NCOLS</strong> å’Œ <strong>NROWS</strong> æ˜¯ç”± ASCII æ–‡ä»¶æ‰€å®šä¹‰çš„æ …æ ¼çš„åˆ—æ•°å’Œè¡Œæ•°ã€‚</li>
<li><strong>XLLCORNER</strong> å’Œ <strong>YLLCORNER</strong> æ˜¯å·¦ä¸‹è§’æ …æ ¼åƒå…ƒçš„å·¦ä¸‹è§’åæ ‡ã€‚ä¹Ÿå¯ä½¿ç”¨ <strong>XLLCENTER</strong> å’Œ <strong>YLLCENTER</strong> æ ¹æ®å·¦ä¸‹è§’æ …æ ¼åƒå…ƒçš„ä¸­å¿ƒåæ ‡æŒ‡å®šåŸç‚¹ã€‚</li>
<li><strong>CELLSIZE</strong> æ˜¯æ …æ ¼åƒå…ƒçš„å¤§å°ã€‚</li>
<li><strong>NODATA_VALUE</strong> æ˜¯ç”¨äºè¡¨ç¤º NoData åƒå…ƒçš„å€¼ã€‚</li>
<li>åƒå…ƒå€¼åº”ç”±ç©ºæ ¼åˆ†éš”ã€‚ASCII æ–‡ä»¶ä¸­æ¯è¡Œçš„æœ«å°¾ä¸å¿…ä½¿ç”¨å›è½¦ã€‚æ–‡ä»¶å¤´ä¸­çš„åˆ—æ•°ç”¨äºç¡®å®šä½•æ—¶å¼€å§‹æ–°çš„ä¸€è¡Œã€‚</li>
</ul>
<p>è§£ææ€è·¯ï¼š</p>
<ol>
<li>è§£æå¤´æ–‡ä»¶ï¼Œè·å–ç›¸åº”çš„å‚æ•°</li>
<li>æ ¹æ®cellsizeï¼Œå·¦ä¸‹è§’ç‚¹çš„åæ ‡è®¡ç®—å³ä¸Šè§’ç‚¹åæ ‡</li>
<li>ä¾æ®æŠ•å½±è¿›è¡Œè½¬æ¢ï¼Œè·å–WGS84æ ¼å¼çš„å·¦ä¸‹å³ä¸Šè§’ç‚¹åæ ‡</li>
<li>è¯»å–åƒå…ƒå€¼ï¼Œå­˜å‚¨åˆ°imageï¼Œä¾æ®æƒ…å†µå¯èƒ½éœ€è¦è¿›è¡Œçº¿æ€§æ‹‰ä¼¸</li>
<li>åœ¨cesiumä¸­åŠ è½½å•ä¸ªimage</li>
</ol>
<p>é’ˆå¯¹æŸäº›å¤§æ–‡ä»¶ï¼Œè¿›è¡Œé€è¡Œè¯»å–ï¼Œå‚è€ƒèµ„æ–™ï¼š<!-- raw HTML omitted --><a href="https://blog.csdn.net/WuLex/article/details/51924267" target="_blank" rel="noopener">https://blog.csdn.net/WuLex/article/details/51924267</a></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="çº¿æ€§æ‹‰ä¼¸">çº¿æ€§æ‹‰ä¼¸</h2>
<p>å…¬å¼<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1672568587320-6aec10e1-c735-4867-9878-7ab4af4e6567.png#averageHue=%23faf9f8&amp;clientId=u8ed7b3c5-e3e5-4&amp;from=paste&amp;height=70&amp;id=u3fb5b1f3&amp;originHeight=87&amp;originWidth=418&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7281&amp;status=done&amp;style=none&amp;taskId=ub2efe3e6-cf79-4b23-8fd9-d14dde71fb2&amp;title=&amp;width=334.4" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->å‚æ•°è¯´æ˜ï¼Œ<code>f(i,j)</code>ç¬¬iè¡Œç¬¬jåˆ—çš„åƒç´ å€¼(æ‹‰ä¼¸å‰)ï¼Œ<code>g(i,j)</code>æ‹‰ä¼¸åçš„åƒç´ å€¼ã€‚A,Båˆ†åˆ«ä¸ºæ‹‰ä¼¸å‰çš„æœ€å°å’Œæœ€å¤§å€¼ï¼ŒCï¼ŒDä¸ºæ‹‰ä¼¸åçš„æœ€å°æœ€å¤§å€¼ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stretch</span><span style="color:#f92672">=</span>(<span style="color:#a6e22e">value</span>,<span style="color:#a6e22e">sourceMax</span>,<span style="color:#a6e22e">sourceMin</span>,<span style="color:#a6e22e">targetMax</span>,<span style="color:#a6e22e">targetMin</span>)=&gt;{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">targetMax</span><span style="color:#f92672">-</span><span style="color:#a6e22e">targetMin</span>)<span style="color:#f92672">/</span>(<span style="color:#a6e22e">sourceMax</span><span style="color:#f92672">-</span><span style="color:#a6e22e">sourceMin</span>)<span style="color:#f92672">*</span>(<span style="color:#a6e22e">value</span><span style="color:#f92672">-</span><span style="color:#a6e22e">sourceMin</span>)<span style="color:#f92672">+</span><span style="color:#a6e22e">targetMin</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="è¯»å†™åƒç´ ">è¯»å†™åƒç´ </h2>
<p>åˆ©ç”¨canvasæ¥è¿›è¡Œåƒç´ çš„ç»˜åˆ¶ï¼Œä»è€Œç”Ÿæˆimageï¼Œæ¶‰åŠåˆ°çš„apiæœ‰ï¼Œ</p>
<ul>
<li>canvas.getContext</li>
<li>ctx.createImageData  åˆ›å»ºåƒç´ çš„ä¿¡æ¯</li>
<li>imageData.data</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createQueue</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">list</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">offset</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dequeue</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>[<span style="color:#a6e22e">offset</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">list</span>[<span style="color:#a6e22e">offset</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">undefined</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">offset</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">offset</span> <span style="color:#f92672">&gt;</span> (<span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">offset</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// åˆ é™¤å‰é¢çš„ç©ºæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">splice</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">offset</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">offset</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">enqueue</span> <span style="color:#f92672">=</span> (...<span style="color:#a6e22e">arr</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">arr</span>);
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pop</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">pop</span>();
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dequeue</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">enqueue</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pop</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ç”¨ä»£ç†æ¥å®ç°ç´¢å¼•å™¨çš„æ•ˆæœ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Proxy(<span style="color:#a6e22e">list</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">prop</span>, <span style="color:#a6e22e">receiver</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> Number(<span style="color:#a6e22e">prop</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">prop</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;length&#39;</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">offset</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (isNaN(<span style="color:#a6e22e">index</span>)) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">obj</span>[<span style="color:#a6e22e">prop</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">offset</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">index</span>];
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">prop</span>, <span style="color:#a6e22e">value</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> Number(<span style="color:#a6e22e">prop</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (isNaN(<span style="color:#a6e22e">index</span>)) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">offset</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">p</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * è‡ªå®šä¹‰äº‹ä»¶æœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *  line è·å–æ¯æ¬¡è¯»å–çš„ä¸€è¡Œçš„æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *  end è¯»å–ç»“æŸçš„äº‹ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *  progress è¯»å–è¿›åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *  error å‘ç”Ÿé”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LineReader</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {object} options
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *   @param {number} chunkSize æ¯æ¬¡è¯»å–çš„å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *   @param {string} encoding æ–‡ä»¶çš„ç¼–ç æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">options</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è¿›åº¦æ¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">loading</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internals</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">self</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">reader</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FileReader</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¦‚æœæœ‰å°±æŒ‰è‡ªå®šä¹‰çš„å¤§å°è¯»å–æ–‡ä»¶ï¼Œæ²¡æœ‰ï¼Œå°±ä¸€æ¬¡è¯»å–1024byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkSize</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">options</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">options</span>.<span style="color:#a6e22e">chunkSize</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">options</span>.<span style="color:#a6e22e">chunkSize</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1024</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// åˆ›å»ºä¸€ä¸ªå¯¹è±¡ è®©ç”¨æˆ·è‡ªå®šä¹‰äº‹ä»¶å›è°ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">events</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// åœ¨filereaderç»ˆæ­¢æ—¶ä¼šå°†canReadè®¾ç½®ä¸ºfalse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">canRead</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">encoding</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">options</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">encoding</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;UTF-8&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è¿›ç¨‹å›è°ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">onprogress</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkLoaded</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">loaded</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">proportion</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        ((<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">totalLoaded</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkLoaded</span>) <span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">fileLength</span>) <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;progress&#39;</span>, [<span style="color:#a6e22e">proportion</span>, <span style="color:#a6e22e">internals</span>]);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è¯»å–å®Œæˆçš„å›è°ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// progressè¿›ç¨‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">totalLoaded</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkLoaded</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// chunk å­˜å‚¨è¯»å–çš„å­—ç¬¦ä¸²ï¼Œä¸Šä¸€æ¬¡è¯»å–çš„å—å¯èƒ½ä¼šä¿ç•™æœ€åä¸€è¡Œï¼Œå¯¹äºå•å­—èŠ‚å­—ç¬¦éƒ½æ˜¯å­—ç¬¦ä¸²å°±å¯ä»¥ç›´æ¥ç›¸åŠ ï¼Œå› ä¸º1å­—èŠ‚(byte)ç­‰äº8ä½(bit)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span> <span style="color:#f92672">+=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¢è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">/\r|\n/</span>.<span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æ‹†åˆ†è¡Œæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">lines</span>.<span style="color:#a6e22e">enqueue</span>(...<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/[^\r\n]+/g</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// å¦‚æœä»æœ‰æ›´å¤šæ•°æ®è¯»å–ï¼Œä¿ç•™æœ€åä¸€è¡Œï¼Œå¯èƒ½ä¸å®Œæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_hasMoreData</span>()) {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// å¦‚æœå—ä»¥\næ¢è¡Œç»“å°¾ï¼Œæœ€åä¸€è¡Œå®Œæ•´ï¼Œä¸å†éœ€è¦å•ç‹¬ä¿ç•™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>[<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;\n&#39;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">:</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">lines</span>.<span style="color:#a6e22e">pop</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æŒ‰æ­¥éª¤è¿›è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_step</span>();
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æ–‡æœ¬ä¸åŒ…å«æ¢è¡Œç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æœ‰æ•°æ®å‰©ä¸‹ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_hasMoreData</span>()) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">read</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æ²¡æœ‰æ•°æ®å‰©ä¸‹äº†ï¼Œä½†ä»ç„¶æœ‰å­˜å‚¨åœ¨å—çš„æ•°æ®å‘å‡ºå®ƒä½œä¸ºä¸€è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>.<span style="color:#a6e22e">length</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;line&#39;</span>, [
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_emit</span>.<span style="color:#a6e22e">bind</span>(<span style="color:#a6e22e">self</span>, <span style="color:#e6db74">&#39;end&#39;</span>),
</span></span><span style="display:flex;"><span>          ]);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// å—å†…æ²¡æœ‰å­˜å‚¨çš„æ•°æ®ï¼Œå°±ç»“æŸ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;end&#39;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">onError</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;error&#39;</span>, [<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">error</span>]);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">on</span>(<span style="color:#a6e22e">eventName</span>, <span style="color:#a6e22e">cb</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>.<span style="color:#a6e22e">events</span>[<span style="color:#a6e22e">eventName</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">cb</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * æ˜¯å¦è¿˜æœ‰æ•°æ®æœªè¯»å–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns boolean
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">_hasMoreData</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">internals</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">readPos</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">fileLength</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * è§¦å‘è‡ªå®šä¹‰äº‹ä»¶çš„å›è°ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {string} event äº‹ä»¶å
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {arguments} args å›è°ƒå‡½æ•°çš„å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">_emit</span>(<span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">args</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">boundEvents</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>.<span style="color:#a6e22e">events</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">boundEvents</span>[<span style="color:#a6e22e">event</span>] <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;function&#39;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">boundEvents</span>[<span style="color:#a6e22e">event</span>].<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *  æŒ‰ç…§chuncksizeè¯»å–æ–‡ä»¶ï¼Œå¹¶è·å¾—ç›¸åº”çš„internalsåˆå§‹å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {File} file è¦è¯»å–çš„æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">read</span>(<span style="color:#a6e22e">file</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">internals</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¦‚æœæ–‡ä»¶æ˜¯æœ‰æ•ˆçš„ï¼Œè·å¾—å…¶ç›¸å…³ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">file</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">fileLength</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">size</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">readPos</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkLoaded</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">totalLoaded</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">lines</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createQueue</span>(); <span style="color:#75715e">//ä½¿ç”¨é˜Ÿåˆ—æ›¿ä»£æ•°ç»„ï¼Œä¼˜åŒ–æ€§èƒ½
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å°†æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æå–å‡ºæ¥ï¼Œè¿™é‡Œæ˜¯é€è¡Œè¯»å–çš„ç²¾åæ‰€åœ¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">slice</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">readPos</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">readPos</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkSize</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å°†å¼€å§‹è¯»å–çš„ä½ç½®ç§»åŠ¨åˆ°æœ¬æ¬¡è¯»å–çš„chunkå
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">readPos</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkSize</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¯¹äºå•å­—èŠ‚ç¼–ç çš„å­—ç¬¦çš„è¯»å–æ˜¯æ²¡é—®é¢˜çš„ï¼Œå¯¹äºå¤šå­—èŠ‚ç¼–ç çš„å­—ç¬¦ï¼Œå¦‚æ±‰å­—ï¼Œå¯èƒ½ä¼šå­˜åœ¨2ä¸ªå­—èŠ‚çš„å­—ç¬¦è¢«æˆªå–äº†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">readAsText</span>(<span style="color:#a6e22e">blob</span>, <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">encoding</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ç»ˆæ­¢è¯»å–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">abort</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>.<span style="color:#a6e22e">canRead</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * å°†internals.linesé‡Œçš„æ•°æ®é€è¡Œå‘é€å‡ºå»ï¼Œè§¦å‘ onç›‘å¬çš„ &#39;line&#39; äº‹ä»¶ï¼Œæ²¡æœ‰è¡Œå‰©ä¸‹æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ•°æ®ï¼Œæœ‰å°±ç»§ç»­è¯»å–ï¼Œè§¦å‘ read() æ²¡æœ‰è§¦å‘endäº‹ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">_step</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">internals</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¦‚æœæ²¡æœ‰è¡Œå‰©ä¸‹å‘é€ï¼Œä½†ä»æœ‰æ•°æ®å‰©ä¸‹è¢«è¯»å–ï¼Œå†æ¬¡å¯åŠ¨è¯»å–è¿›ç¨‹ï¼Œå¦åˆ™å‘é€ç»“æŸäº‹ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">lines</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_hasMoreData</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">read</span>();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;end&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å½“å‰è¯»å–åˆ°çš„è¡Œæ•°å¹¶ä¸ä¸º0ï¼Œå¹¶ä¸”æ²¡æœ‰è¢«åºŸå¼ƒï¼Œå°†linesé€è¡Œå‘é€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">canRead</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;line&#39;</span>, [<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">lines</span>.<span style="color:#a6e22e">dequeue</span>(), <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_step</span>.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">this</span>)]);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;end&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;canvas&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#39;2d&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">uploadRaster</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">files</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">LineReader</span>({ <span style="color:#a6e22e">chunkSize</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">max</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">9999</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">min</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">99999</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pixels</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">imageData</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">headParas</span> <span style="color:#f92672">=</span> []; <span style="color:#75715e">// cols, rows, xllCorner, yllCorner, cellsize, nodataValue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">rec</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;line&#39;</span>, <span style="color:#a6e22e">readHead</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;end&#39;</span>, <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è®¡ç®—å›¾ç‰‡èŒƒå›´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">rec</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">2</span>], <span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">3</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">rx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#a6e22e">rec</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">ry</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> <span style="color:#a6e22e">rec</span>[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rec</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">rx</span>, <span style="color:#a6e22e">ry</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">pixels</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">pixels</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">==</span> <span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">5</span>]) <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stretch</span>(<span style="color:#a6e22e">pixels</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">max</span>, <span style="color:#a6e22e">min</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">imageData</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">imageData</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">imageData</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">imageData</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">255</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">putImageData</span>(<span style="color:#a6e22e">imageData</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">toDataURL</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// var newWindow = window.open(&#39;&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// newWindow.document.body.innerHTML = &#39;&lt;img src=&#34;&#39; + url + &#39;&#34; alt=&#34;&#34;&gt;&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">add</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">rectangle</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">coordinates</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Rectangle</span>.<span style="color:#a6e22e">fromDegrees</span>(...<span style="color:#a6e22e">rec</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å¡«å……ææ–™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">material</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">url</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">classificationType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ClassificationType</span>.<span style="color:#a6e22e">TERRAIN</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;error&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;progress&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">proportion</span>, <span style="color:#a6e22e">internals</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">proportion</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">read</span>(<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">readHead</span>(<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">next</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39; &#39;</span>).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">count</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">6</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headParas</span>.<span style="color:#a6e22e">push</span>(Number(<span style="color:#a6e22e">arr</span>[<span style="color:#ae81ff">1</span>]));
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">count</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">count</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">6</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;line&#39;</span>, <span style="color:#a6e22e">readBody</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">imageData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">createImageData</span>(<span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setTimeout</span>(() =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">readBody</span>(<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">next</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// console.log(&#39;jj&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39; &#39;</span>).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å°†åƒç´ å€¼å†™å…¥imagedata æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œ è¿ç»­4ä¸ªå…ƒç´ è¡¨ç¤ºrgbaï¼Œ å°±ç°åº¦å›¾æ¥è¯´rgbåº”è¯¥ç­‰æ¯”ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">arr</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">item</span> <span style="color:#f92672">=</span> Number(<span style="color:#a6e22e">arr</span>[<span style="color:#a6e22e">i</span>]);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">pixels</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">item</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">item</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">headParas</span>[<span style="color:#ae81ff">5</span>]) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">max</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">item</span>, <span style="color:#a6e22e">max</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">min</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">item</span>, <span style="color:#a6e22e">min</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setTimeout</span>(() =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="4åŠ è½½ç­‰å€¼é¢ä¸‰è§’ç½‘">4.åŠ è½½ç­‰å€¼é¢ä¸‰è§’ç½‘</h1>
<p>å…ƒæ•°æ®ç±»å‹ä¸ºcsvæ–‡ä»¶ï¼Œæ•°æ®æ ¼å¼å¦‚ä¸‹<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1672122095469-f44f0862-82b7-4377-ac23-fa7412dbd163.png#averageHue=%23f7f4f4&amp;clientId=u85896181-579a-4&amp;from=paste&amp;height=583&amp;id=uc7f7cc79&amp;originHeight=729&amp;originWidth=920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=279493&amp;status=done&amp;style=none&amp;taskId=u0b51b0e8-02fe-4ef8-869e-82e33f3209d&amp;title=&amp;width=736" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->èƒ½çœ‹åˆ°è¿™é‡Œçš„ç­‰å€¼é¢ç”±è®¸å¤šåæ ‡å¯¹ç»„æˆçš„ä¸‰è§’å½¢æ„æˆã€‚å› æ­¤ï¼Œé—®é¢˜çš„å…³é”®åœ¨äºè§£å†³ä¸‹é¢ä¸¤ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>åœ¨cesiumä¸­ç”»ä¸‰è§’å½¢</li>
<li>ä»æ–‡ä»¶ä¸­è¯»å–é™¤åæ ‡å¯¹</li>
</ol>
<p>å…ˆæ¥è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºè¦ç»˜åˆ¶çš„ä¸‰è§’å½¢æ•°é‡å¾ˆå¤šï¼Œé‡‡ç”¨primitiveçš„æ–¹å¼æ¥ç»˜åˆ¶ã€‚</p>
<blockquote>
<p>è¿™ä¸€è·¯æ˜¯ç–¯ç‹‚è¸©å‘è¸©è¿‡æ¥çš„ã€‚/(ã„’oã„’)/~~</p>
</blockquote>
<p>ç®€å•è°ˆä¸€ä¸‹è¿™ä¸ªprimitive apiï¼Œæ˜¯ä¸€ä¸ªæ¥è¿‘åº•å±‚çš„ç»˜å›¾apiã€‚æ²¡æ¥è§¦è¿‡webglï¼Œopenglï¼Œå¯¹å…¶ä¸äº†è§£ã€‚<!-- raw HTML omitted -->primitiveç”±ä¸¤éƒ¨åˆ†ç»„æˆ</p>
<ul>
<li><code>**GeometryInstance **</code> å‡ ä½•å®ä¾‹
<ul>
<li>geometry  å‡ ä½•å½¢çŠ¶</li>
<li>attributes  å®ä¾‹çš„å±æ€§</li>
</ul>
</li>
<li><code>**Appearance**</code> å¤–è§‚</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼ŒgeometryInstanceå’Œappearanceè¦å¯¹åº”ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p>
</blockquote>
<p>ä½¿ç”¨primitiveçš„å¥½å¤„æœ‰</p>
<ol>
<li>æ€§èƒ½å¥½ï¼ŒGPUä»£æ›¿CPUï¼Œç›¸å¯¹äºå®ä½“entitiesï¼Œå¤§é‡å›¾å½¢(å®ä½“)ä¼šå¢åŠ CPUçš„è´Ÿæ‹…ï¼Œä½¿ç”¨primitiveå¯ä»¥å°†å¤šä¸ªå›¾å½¢åˆä¸ºä¸€ä¸ªgeometryã€‚</li>
<li>çµæ´»ï¼Œå‡ ä½•å’Œå¤–è§‚æ˜¯åˆ†ç¦»çš„</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>éš¾åº¦å¤§ï¼Œè¦æœ‰å›¾å½¢å­¦ç¼–ç¨‹çš„åŸºç¡€</li>
<li>ä»£ç é‡å¤š</li>
</ol>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="ç”»ä¸€ä¸ªä¸‰è§’å½¢">ç”»ä¸€ä¸ªä¸‰è§’å½¢</h2>
<p>è¦ç”»ä¸€ä¸ªä¸‰è§’å½¢ï¼Œéœ€è¦ç¡®å®šå…¶å‡ ä½•å½¢çŠ¶å’Œå¤–è§‚ã€‚ç”¨ä¸€ç³»åˆ—ç‚¹åæ ‡æ¥è¡¨ç¤ºå½¢çŠ¶ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼Œ</p>
<ol>
<li>ä½ç½®ä¸º1ç»´æ•°ç»„ï¼Œä¾æ¬¡ä¸ºxï¼Œyï¼Œzï¼Œ</li>
<li>åæ ‡ç³»ç»Ÿä¸ºç¬›å¡å°”ç©ºé—´ç›´è§’åæ ‡ï¼Œä¸æ˜¯ç»çº¬åº¦ï¼Œç»çº¬åº¦é€šè¿‡<code>**Cesium.Cartesian3.fromDegrees**</code><strong>è½¬æ¢</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positions</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float64Array</span>([
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">8000000.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">8000000.0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">8500000.0</span>, <span style="color:#ae81ff">8000000.0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">8000000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">8500000.0</span>,
</span></span><span style="display:flex;"><span>]);
</span></span></code></pre></div><p>ç”Ÿæˆgeometry</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">geometry</span> <span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Geometry</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryAttribute</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">componentDatatype</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ComponentDatatype</span>.<span style="color:#a6e22e">DOUBLE</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">componentsPerAttribute</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">positions</span>,
</span></span><span style="display:flex;"><span>    }),
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">primitiveType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">PrimitiveType</span>.<span style="color:#a6e22e">TRIANGLES</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">boundingSphere</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">BoundingSphere</span>.<span style="color:#a6e22e">fromVertices</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">positions</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// new Cesium.Cartesian3(0.0, 0.0, 0.0),
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  ),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">indices</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">indices</span>,
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">instance</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryInstance</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geometry</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">geometry</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;sanjiaoxing&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ColorGeometryInstanceAttribute</span>.<span style="color:#a6e22e">fromColor</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Color</span>.<span style="color:#a6e22e">AQUA</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>åˆ›å»ºå¤–è§‚ï¼Œæ³¨æ„è¿™é‡Œflatå¿…é¡»ä¸ºtrueï¼Œå¦åˆ™ä¼šæŠ¥é”™</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">appearance</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">PerInstanceColorAppearance</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">flat</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// translucent: true,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>});
</span></span></code></pre></div><p>åˆ›å»ºprimitiveå¹¶æ·»åŠ åˆ°sceneä¸­ã€‚æ³¨æ„ï¼Œå¦‚æœéœ€è¦å¼‚æ­¥åˆ›å»ºå›¾å½¢ï¼Œéœ€è¦æŒ‡å®šweb workerï¼Œå¦åˆ™è¯·è®¾ç½®ä¸º<code>asynchronous:false</code>ï¼Œä¸ç„¶æŠ¥é”™</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">primitive</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Primitive</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geometryInstances</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">instance</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">appearance</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">appearance</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">asynchronous</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">primitives</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">primitive</span>);
</span></span></code></pre></div><p>è¿™æ ·å°±å¯ä»¥ç”»å‡ºä¸‰è§’å½¢äº†<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1672220346157-9c81b5cc-04cc-4104-a0b4-3e75d18156c5.png#averageHue=%238f9d95&amp;clientId=u2bdc1bfc-a0c0-4&amp;from=paste&amp;height=532&amp;id=ub08e1592&amp;originHeight=665&amp;originWidth=914&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=543904&amp;status=done&amp;style=none&amp;taskId=u1c1afe8d-6a7f-4fc6-a435-f08ecc8cd8c&amp;title=&amp;width=731.2" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->æƒ³è¦çº¿æ¡†å›¾ï¼Œå¯ä»¥ä¿®æ”¹æˆè¿™æ ·</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// çœ‹è¿™é‡Œçœ‹è¿™é‡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">geometry</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryPipeline</span>.<span style="color:#a6e22e">toWireframe</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Geometry</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryAttribute</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">componentDatatype</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ComponentDatatype</span>.<span style="color:#a6e22e">DOUBLE</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">componentsPerAttribute</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">positions</span>,
</span></span><span style="display:flex;"><span>      }),
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">primitiveType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">PrimitiveType</span>.<span style="color:#a6e22e">TRIANGLES</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">boundingSphere</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">BoundingSphere</span>.<span style="color:#a6e22e">fromVertices</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">positions</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// new Cesium.Cartesian3(0.0, 0.0, 0.0),
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">indices</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">indices</span>,
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1672220590113-e58955e8-e5ea-4850-8f2d-1d9ce8299fda.png#averageHue=%23020202&amp;clientId=u2bdc1bfc-a0c0-4&amp;from=paste&amp;height=495&amp;id=u7387cc92&amp;originHeight=619&amp;originWidth=555&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=171726&amp;status=done&amp;style=none&amp;taskId=u7827e9ba-4a39-499d-985b-0cbc5a13ce2&amp;title=&amp;width=444" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->å¦‚æœæƒ³è¦ä¸åŒçš„é¢ä¹‹é—´æœ‰é˜´å½±æ•ˆæœï¼Œå¦‚ä¸‹<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1672231159695-5e0cbee4-82e4-4283-9256-b81af4f6e7aa.png#averageHue=%23899a8f&amp;clientId=u2bdc1bfc-a0c0-4&amp;from=paste&amp;height=421&amp;id=u4db2d3ad&amp;originHeight=526&amp;originWidth=972&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=267518&amp;status=done&amp;style=none&amp;taskId=u4440c73f-8bb0-451e-a3ab-2d4d73f1038&amp;title=&amp;width=777.6" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->éœ€è¦æ·»åŠ æ³•å‘é‡ï¼Œå¹¶è®¾ç½®å¼€å¯<code>**flat:false**</code><!-- raw HTML omitted -->æ³•å‘é‡ä½¿ç”¨<code>Cesium.GeometryPipeline.computeNormal</code>è¿›è¡Œè®¡ç®—ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå·±ç®—ğŸ˜€ï¼Œä½¿ç”¨computeNormalæ—¶ï¼Œéœ€è¦åŠ ä¸Šé¡¶ç‚¹ç´¢å¼•ï¼Œè¯·ç¡®ä¿æ¯ä¸ªé¡¶ç‚¹éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚ä»£ç å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positions</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float64Array</span>([
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">7500000.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">7500000.0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>]);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">positions</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">indices</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Array(<span style="color:#a6e22e">count</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">count</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">indices</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//é˜´å½±æ•ˆæœ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">geometry</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryPipeline</span>.<span style="color:#a6e22e">computeNormal</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Cesium.GeometryPipeline.toWireframe(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Geometry</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryAttribute</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">componentDatatype</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ComponentDatatype</span>.<span style="color:#a6e22e">DOUBLE</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">componentsPerAttribute</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">positions</span>,
</span></span><span style="display:flex;"><span>      }),
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">primitiveType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">PrimitiveType</span>.<span style="color:#a6e22e">TRIANGLES</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">boundingSphere</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">BoundingSphere</span>.<span style="color:#a6e22e">fromVertices</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">positions</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// new Cesium.Cartesian3(0.0, 0.0, 0.0),
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">indices</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">indices</span>,
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// );
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">instance</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryInstance</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geometry</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">geometry</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;sanjiaoxing&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ColorGeometryInstanceAttribute</span>.<span style="color:#a6e22e">fromColor</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Color</span>.<span style="color:#a6e22e">AQUA</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">appearance</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">PerInstanceColorAppearance</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// flat: true,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// translucent: true,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">primitive</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Primitive</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geometryInstances</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">instance</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">appearance</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">appearance</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">asynchronous</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">primitives</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">primitive</span>);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">instance</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryInstance</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geometry</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">geometry</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;sanjiaoxing&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ColorGeometryInstanceAttribute</span>(<span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">0.5</span>),
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="åŠ è½½ä¸åŒé¡¶ç‚¹é¢œè‰²çš„ä¸‰è§’å½¢">åŠ è½½ä¸åŒé¡¶ç‚¹é¢œè‰²çš„ä¸‰è§’å½¢</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">//å®šä¹‰ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹çš„åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">vertex1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian3</span>.<span style="color:#a6e22e">fromDegrees</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">115.0</span>, <span style="color:#ae81ff">37.0</span>, <span style="color:#ae81ff">100000.0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">vertex2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian3</span>.<span style="color:#a6e22e">fromDegrees</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">107.0</span>, <span style="color:#ae81ff">33.0</span>, <span style="color:#ae81ff">100000.0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">vertex3</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian3</span>.<span style="color:#a6e22e">fromDegrees</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">102.0</span>, <span style="color:#ae81ff">40.0</span>, <span style="color:#ae81ff">100000.0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å®šä¹‰ä¸‰ä¸ªé¡¶ç‚¹çš„é¢œè‰²
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Color</span>.<span style="color:#a6e22e">RED</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">green</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Color</span>.<span style="color:#a6e22e">GREEN</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">blue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Color</span>.<span style="color:#a6e22e">BLUE</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//ç»„è£…æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">positions</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float64Array</span>([
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertex1</span>.<span style="color:#a6e22e">x</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertex1</span>.<span style="color:#a6e22e">y</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertex1</span>.<span style="color:#a6e22e">z</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertex2</span>.<span style="color:#a6e22e">x</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertex2</span>.<span style="color:#a6e22e">y</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertex2</span>.<span style="color:#a6e22e">z</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertex3</span>.<span style="color:#a6e22e">x</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertex3</span>.<span style="color:#a6e22e">y</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertex3</span>.<span style="color:#a6e22e">z</span>,
</span></span><span style="display:flex;"><span>    ]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">colors</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">0.5</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å®šä¹‰é¡¶ç‚¹ç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">vs</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;attribute vec3 position3DHigh;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    attribute vec3 position3DLow;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    attribute vec4 color;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    varying vec4 v_color;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    attribute float batchId;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    void main()\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 p = czm_computePosition();\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_color = color;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        p = czm_modelViewProjectionRelativeToEye * p;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = p;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_PointSize = 10.0;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å®šä¹‰ç‰‡å…ƒç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fs</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;varying vec4 v_color;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    void main()\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         float d = distance(gl_PointCoord, vec2(0.5,0.5));\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         if(d &lt; 0.5){\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            gl_FragColor = v_color;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         }else{\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            discard;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         }\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">geometry</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Geometry</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryAttribute</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">componentDatatype</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ComponentDatatype</span>.<span style="color:#a6e22e">DOUBLE</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">componentsPerAttribute</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">positions</span>,
</span></span><span style="display:flex;"><span>        }),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryAttribute</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">componentDatatype</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ComponentDatatype</span>.<span style="color:#a6e22e">FLOAT</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">componentsPerAttribute</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">colors</span>,
</span></span><span style="display:flex;"><span>        }),
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// vertexFormat: Cesium.VertexFormat.POSITION_AND_COLOR,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">indices</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Uint32Array</span>([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">primitiveType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">PrimitiveType</span>.<span style="color:#a6e22e">TRIANGLES</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">boundingSphere</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">BoundingSphere</span>.<span style="color:#a6e22e">fromVertices</span>(<span style="color:#a6e22e">positions</span>),
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">appearance</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">MaterialAppearance</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertexShaderSource</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">vs</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fragmentShaderSource</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fs</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">renderState</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// blending: Cesium.BlendingState.PRE_MULTIPLIED_ALPHA_BLEND,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">depthTest</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">enabled</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      }, <span style="color:#75715e">//æŠ¥é”™ depthMask
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">primitive</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Primitive</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">geometryInstances</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryInstance</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">geometry</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">geometry</span>,
</span></span><span style="display:flex;"><span>      }),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">appearance</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">appearance</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">asynchronous</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">primitives</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">primitive</span>);
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="åŠ¨æ€ä¿®æ”¹ä¸‰è§’å½¢çš„é¢œè‰²">åŠ¨æ€ä¿®æ”¹ä¸‰è§’å½¢çš„é¢œè‰²</h2>
<p>å¾…ç»­
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="è¸©å‘ä¹‹è·¯">è¸©å‘ä¹‹è·¯</h2>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="é—®é¢˜1">é—®é¢˜1.</h3>
<p>
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1672152746205-128bea95-f1ae-497c-aa72-4c5ff051d885.png#averageHue=%23deb8b2&amp;clientId=u124a9a73-c27f-4&amp;from=paste&amp;height=185&amp;id=u122a1dee&amp;originHeight=231&amp;originWidth=623&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=20258&amp;status=done&amp;style=none&amp;taskId=u083f65d5-8529-4a88-8d2d-b309f464782&amp;title=&amp;width=498.4" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->äº§ç”ŸåŸå› ï¼Œæ²¡æœ‰ä»ï¼ˆ0ï¼Œ0ï¼Œ0ï¼‰åˆ°2Dçš„æŠ•å½±ï¼Œå¦‚æœä¸å…³å¿ƒ2Dï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼švar viewer = new Cesium.Viewer(&lsquo;cesiumContainer&rsquo;, { scene3DOnly: true });
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="é—®é¢˜2é¡¶ç‚¹ç´¢å¼•ç›¸å…³é—®é¢˜">é—®é¢˜2.é¡¶ç‚¹ç´¢å¼•ç›¸å…³é—®é¢˜</h3>
<ol>
<li>ä¸€ç»´æ•°ç»„</li>
<li>è¡¨ç¤ºè¿æ¥å„ç‚¹çš„é¡ºåº</li>
<li>é•¿åº¦ä¸€èˆ¬ä¸ºæ€»å…± positionsæ•°ç»„é•¿åº¦çš„ä¸‰åˆ†ä¹‹ä¸€ï¼Œå³æ€»å…±é¡¶ç‚¹çš„ä¸ªæ•°ã€‚</li>
</ol>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="è¯»å–csv">è¯»å–csv</h2>
<p>è¡Œè¯»å–å·¥å…·ç±»</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createQueue</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">list</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">offset</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dequeue</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>[<span style="color:#a6e22e">offset</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">list</span>[<span style="color:#a6e22e">offset</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">undefined</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">offset</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">offset</span> <span style="color:#f92672">&gt;</span> (<span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">offset</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// åˆ é™¤å‰é¢çš„ç©ºæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">splice</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">offset</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">offset</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">enqueue</span> <span style="color:#f92672">=</span> (...<span style="color:#a6e22e">arr</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">arr</span>);
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pop</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">pop</span>();
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dequeue</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">enqueue</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pop</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ç”¨ä»£ç†æ¥å®ç°ç´¢å¼•å™¨çš„æ•ˆæœ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Proxy(<span style="color:#a6e22e">list</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">prop</span>, <span style="color:#a6e22e">receiver</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> Number(<span style="color:#a6e22e">prop</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">prop</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;length&#39;</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">offset</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (isNaN(<span style="color:#a6e22e">index</span>)) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">obj</span>[<span style="color:#a6e22e">prop</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">offset</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">index</span>];
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">prop</span>, <span style="color:#a6e22e">value</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> Number(<span style="color:#a6e22e">prop</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (isNaN(<span style="color:#a6e22e">index</span>)) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">offset</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">p</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * è‡ªå®šä¹‰äº‹ä»¶æœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *  line è·å–æ¯æ¬¡è¯»å–çš„ä¸€è¡Œçš„æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *  end è¯»å–ç»“æŸçš„äº‹ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *  progress è¯»å–è¿›åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *  error å‘ç”Ÿé”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LineReader</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {object} options
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *   @param {number} chunkSize æ¯æ¬¡è¯»å–çš„å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *   @param {string} encoding æ–‡ä»¶çš„ç¼–ç æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">options</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è¿›åº¦æ¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">loading</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internals</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">self</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">reader</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FileReader</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¦‚æœæœ‰å°±æŒ‰è‡ªå®šä¹‰çš„å¤§å°è¯»å–æ–‡ä»¶ï¼Œæ²¡æœ‰ï¼Œå°±ä¸€æ¬¡è¯»å–1024byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkSize</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">options</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">options</span>.<span style="color:#a6e22e">chunkSize</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">options</span>.<span style="color:#a6e22e">chunkSize</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1024</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// åˆ›å»ºä¸€ä¸ªå¯¹è±¡ è®©ç”¨æˆ·è‡ªå®šä¹‰äº‹ä»¶å›è°ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">events</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// åœ¨filereaderç»ˆæ­¢æ—¶ä¼šå°†canReadè®¾ç½®ä¸ºfalse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">canRead</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">encoding</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">options</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">encoding</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;UTF-8&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è¿›ç¨‹å›è°ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">onprogress</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkLoaded</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">loaded</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">proportion</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        ((<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">totalLoaded</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkLoaded</span>) <span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">fileLength</span>) <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;progress&#39;</span>, [<span style="color:#a6e22e">proportion</span>, <span style="color:#a6e22e">internals</span>]);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è¯»å–å®Œæˆçš„å›è°ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// progressè¿›ç¨‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">totalLoaded</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkLoaded</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// chunk å­˜å‚¨è¯»å–çš„å­—ç¬¦ä¸²ï¼Œä¸Šä¸€æ¬¡è¯»å–çš„å—å¯èƒ½ä¼šä¿ç•™æœ€åä¸€è¡Œï¼Œå¯¹äºå•å­—èŠ‚å­—ç¬¦éƒ½æ˜¯å­—ç¬¦ä¸²å°±å¯ä»¥ç›´æ¥ç›¸åŠ ï¼Œå› ä¸º1å­—èŠ‚(byte)ç­‰äº8ä½(bit)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span> <span style="color:#f92672">+=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¢è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">/\r|\n/</span>.<span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æ‹†åˆ†è¡Œæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">lines</span>.<span style="color:#a6e22e">enqueue</span>(...<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/[^\r\n]+/g</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// å¦‚æœä»æœ‰æ›´å¤šæ•°æ®è¯»å–ï¼Œä¿ç•™æœ€åä¸€è¡Œï¼Œå¯èƒ½ä¸å®Œæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_hasMoreData</span>()) {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// å¦‚æœå—ä»¥\næ¢è¡Œç»“å°¾ï¼Œæœ€åä¸€è¡Œå®Œæ•´ï¼Œä¸å†éœ€è¦å•ç‹¬ä¿ç•™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>[<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;\n&#39;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">:</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">lines</span>.<span style="color:#a6e22e">pop</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æŒ‰æ­¥éª¤è¿›è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_step</span>();
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æ–‡æœ¬ä¸åŒ…å«æ¢è¡Œç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æœ‰æ•°æ®å‰©ä¸‹ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_hasMoreData</span>()) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">read</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æ²¡æœ‰æ•°æ®å‰©ä¸‹äº†ï¼Œä½†ä»ç„¶æœ‰å­˜å‚¨åœ¨å—çš„æ•°æ®å‘å‡ºå®ƒä½œä¸ºä¸€è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>.<span style="color:#a6e22e">length</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;line&#39;</span>, [
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_emit</span>.<span style="color:#a6e22e">bind</span>(<span style="color:#a6e22e">self</span>, <span style="color:#e6db74">&#39;end&#39;</span>),
</span></span><span style="display:flex;"><span>          ]);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// å—å†…æ²¡æœ‰å­˜å‚¨çš„æ•°æ®ï¼Œå°±ç»“æŸ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;end&#39;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">onError</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;error&#39;</span>, [<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">error</span>]);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">on</span>(<span style="color:#a6e22e">eventName</span>, <span style="color:#a6e22e">cb</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>.<span style="color:#a6e22e">events</span>[<span style="color:#a6e22e">eventName</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">cb</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * æ˜¯å¦è¿˜æœ‰æ•°æ®æœªè¯»å–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns boolean
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">_hasMoreData</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">internals</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">readPos</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">fileLength</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * è§¦å‘è‡ªå®šä¹‰äº‹ä»¶çš„å›è°ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {string} event äº‹ä»¶å
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {arguments} args å›è°ƒå‡½æ•°çš„å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">_emit</span>(<span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">args</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">boundEvents</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>.<span style="color:#a6e22e">events</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">boundEvents</span>[<span style="color:#a6e22e">event</span>] <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;function&#39;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">boundEvents</span>[<span style="color:#a6e22e">event</span>].<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *  æŒ‰ç…§chuncksizeè¯»å–æ–‡ä»¶ï¼Œå¹¶è·å¾—ç›¸åº”çš„internalsåˆå§‹å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {File} file è¦è¯»å–çš„æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">read</span>(<span style="color:#a6e22e">file</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">internals</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¦‚æœæ–‡ä»¶æ˜¯æœ‰æ•ˆçš„ï¼Œè·å¾—å…¶ç›¸å…³ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">file</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">fileLength</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">size</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">readPos</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunk</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkLoaded</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">totalLoaded</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">lines</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createQueue</span>(); <span style="color:#75715e">//ä½¿ç”¨é˜Ÿåˆ—æ›¿ä»£æ•°ç»„ï¼Œä¼˜åŒ–æ€§èƒ½
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å°†æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æå–å‡ºæ¥ï¼Œè¿™é‡Œæ˜¯é€è¡Œè¯»å–çš„ç²¾åæ‰€åœ¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">slice</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">readPos</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">readPos</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkSize</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å°†å¼€å§‹è¯»å–çš„ä½ç½®ç§»åŠ¨åˆ°æœ¬æ¬¡è¯»å–çš„chunkå
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">readPos</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">chunkSize</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¯¹äºå•å­—èŠ‚ç¼–ç çš„å­—ç¬¦çš„è¯»å–æ˜¯æ²¡é—®é¢˜çš„ï¼Œå¯¹äºå¤šå­—èŠ‚ç¼–ç çš„å­—ç¬¦ï¼Œå¦‚æ±‰å­—ï¼Œå¯èƒ½ä¼šå­˜åœ¨2ä¸ªå­—èŠ‚çš„å­—ç¬¦è¢«æˆªå–äº†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">readAsText</span>(<span style="color:#a6e22e">blob</span>, <span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">encoding</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ç»ˆæ­¢è¯»å–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">abort</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>.<span style="color:#a6e22e">canRead</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * å°†internals.linesé‡Œçš„æ•°æ®é€è¡Œå‘é€å‡ºå»ï¼Œè§¦å‘ onç›‘å¬çš„ &#39;line&#39; äº‹ä»¶ï¼Œæ²¡æœ‰è¡Œå‰©ä¸‹æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ•°æ®ï¼Œæœ‰å°±ç»§ç»­è¯»å–ï¼Œè§¦å‘ read() æ²¡æœ‰è§¦å‘endäº‹ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">_step</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">internals</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_internals</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¦‚æœæ²¡æœ‰è¡Œå‰©ä¸‹å‘é€ï¼Œä½†ä»æœ‰æ•°æ®å‰©ä¸‹è¢«è¯»å–ï¼Œå†æ¬¡å¯åŠ¨è¯»å–è¿›ç¨‹ï¼Œå¦åˆ™å‘é€ç»“æŸäº‹ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">lines</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_hasMoreData</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">read</span>();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;end&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å½“å‰è¯»å–åˆ°çš„è¡Œæ•°å¹¶ä¸ä¸º0ï¼Œå¹¶ä¸”æ²¡æœ‰è¢«åºŸå¼ƒï¼Œå°†linesé€è¡Œå‘é€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">canRead</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;line&#39;</span>, [<span style="color:#a6e22e">internals</span>.<span style="color:#a6e22e">lines</span>.<span style="color:#a6e22e">dequeue</span>(), <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_step</span>.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">this</span>)]);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_emit</span>(<span style="color:#e6db74">&#39;end&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å£°æ˜å­˜å‚¨è¯»å–ç»“æœçš„å˜é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> [<span style="color:#a6e22e">collection</span>, <span style="color:#a6e22e">setCollection</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>([]);
</span></span></code></pre></div><p>è·å–</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">LineReader</span>({});
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">isosurfaceCollection</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">row</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">readHead</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">row</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">row</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// å¦‚ æœ‰å¤šå°‘ä¸ªå€¼ å€¼åˆ†åˆ«ä¸º 5,25,30,40,50,60,,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;,&#39;</span>).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">arr</span>[<span style="color:#ae81ff">0</span>]; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">val</span> <span style="color:#f92672">=</span> Number(<span style="color:#a6e22e">arr</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">isosurfaceCollection</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;isosurface-&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">i</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">tins</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">val</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">getColorRgba</span>(<span style="color:#a6e22e">val</span>), <span style="color:#75715e">//è·å–valueå¯¹åº”çš„é¢œè‰²å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;line&#39;</span>, <span style="color:#a6e22e">readChunkHead</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">line</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">isosurfaceCollection</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// row ä¸º2 0è¡Œå¼€å§‹ï¼Œç¬¬2è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">targetRow</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">readChunkHead</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;,&#39;</span>).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// len = arr[2]; //è¿™ä¸€ä¸ªå€¼åŸŸçš„æ•°ç»„çš„é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">targetRow</span> <span style="color:#f92672">=</span> Number(<span style="color:#a6e22e">arr</span>[<span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span> <span style="color:#a6e22e">row</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// æŒ‡é’ˆåŠ 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">index</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;line&#39;</span>, <span style="color:#a6e22e">readChunk</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">readChunk</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// index ç­‰å€¼é¢æ•°ç»„ä¸­çš„ç¬¬å‡ ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//  targetRow è¦è¯»åˆ°ç¬¬å‡ è¡Œæ‰ç®—è¯»å®Œè¿™ä¸€å—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// row å½“å‰çš„è¡Œæ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">row</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">row</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">targetRow</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;line&#39;</span>, <span style="color:#a6e22e">readChunkHead</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">row</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">line</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;,&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; Number(<span style="color:#a6e22e">item</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// let [x, y, z] = arr;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> { <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>, <span style="color:#a6e22e">z</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian3</span>.<span style="color:#a6e22e">fromDegrees</span>(...<span style="color:#a6e22e">arr</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">isosurfaceCollection</span>[<span style="color:#a6e22e">index</span>].<span style="color:#a6e22e">tins</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>, <span style="color:#a6e22e">z</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;error&#39;</span>, (<span style="color:#a6e22e">err</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;progress&#39;</span>, (<span style="color:#a6e22e">proportion</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(Math.<span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">proportion</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;%&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;end&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;è¯»å–ç»“æŸ&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">isosurfaceCollection</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">setCollection</span>(<span style="color:#a6e22e">isosurfaceCollection</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;line&#39;</span>, <span style="color:#a6e22e">readHead</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">read</span>(<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>]);
</span></span></code></pre></div><p>è·å–å¯¹åº”çš„é¢œè‰²</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">colortoRgb</span>(<span style="color:#a6e22e">color</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 16è¿›åˆ¶é¢œè‰²å€¼çš„æ­£åˆ™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">reg</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// æŠŠé¢œè‰²å€¼å˜æˆå°å†™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">color</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">toLowerCase</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">reg</span>.<span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">color</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¦‚æœåªæœ‰ä¸‰ä½çš„å€¼ï¼Œéœ€å˜æˆå…­ä½ï¼Œå¦‚ï¼š#fff =&gt; #ffffff
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">4</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">colorNew</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#&#39;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">colorNew</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>).<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">color</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">colorNew</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¤„ç†å…­ä½çš„é¢œè‰²å€¼ï¼Œè½¬ä¸ºRGB
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">colorChange</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">7</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">colorChange</span>.<span style="color:#a6e22e">push</span>(parseInt(<span style="color:#e6db74">&#39;0x&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>))<span style="color:#f92672">/</span><span style="color:#ae81ff">255</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">colorChange</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">color</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">COLORVALUELIST</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#ad90f0&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">70</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#9600b4&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">65</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#ff00f0&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">60</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#c00000&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">55</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#d60000&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">50</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#ff0000&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">45</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#ff9000&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">40</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#e7c000&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">35</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#ffff00&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">30</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#019000&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">25</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#00d800&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">20</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#00ecec&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">15</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#01a0f6&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span> },
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {number} value å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getColorRgba</span>(<span style="color:#a6e22e">value</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">len</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">COLORVALUELIST</span>.<span style="color:#a6e22e">length</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">value</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">COLORVALUELIST</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">colortoRgb</span>(<span style="color:#a6e22e">COLORVALUELIST</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">color</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">value</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">COLORVALUELIST</span>[<span style="color:#a6e22e">len</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">colortoRgb</span>(<span style="color:#a6e22e">COLORVALUELIST</span>[<span style="color:#a6e22e">len</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">color</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">len</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">value</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">COLORVALUELIST</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">value</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">value</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">COLORVALUELIST</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>    ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">colortoRgb</span>(<span style="color:#a6e22e">COLORVALUELIST</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">color</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åŠ è½½ç­‰å€¼é¢</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getGeometryInstance</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">positions</span>, <span style="color:#a6e22e">color</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// const positions = new Float64Array(collection[0].tins);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">positions</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">indices</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Array(<span style="color:#a6e22e">count</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">count</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">indices</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">geometry</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryPipeline</span>.<span style="color:#a6e22e">computeNormal</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Cesium.GeometryPipeline.toWireframe(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Geometry</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryAttribute</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">componentDatatype</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ComponentDatatype</span>.<span style="color:#a6e22e">DOUBLE</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">componentsPerAttribute</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">positions</span>,
</span></span><span style="display:flex;"><span>        }),
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">primitiveType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">PrimitiveType</span>.<span style="color:#a6e22e">TRIANGLES</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">boundingSphere</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">BoundingSphere</span>.<span style="color:#a6e22e">fromVertices</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">positions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// new Cesium.Cartesian3(0.0, 0.0, 0.0),
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      ),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">indices</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">indices</span>,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryInstance</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geometry</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">geometry</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">color</span> <span style="color:#75715e">/* new Cesium.ColorGeometryInstanceAttribute(1.0, 1.0, 1.0, 0.5), */</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">instances</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">instances</span>.<span style="color:#a6e22e">push</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">getGeometryInstance</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float64Array</span>(<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">tins</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ColorGeometryInstanceAttribute</span>(...<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">color</span>, <span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">instances</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">appearance</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">PerInstanceColorAppearance</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// flat: true,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// translucent: true,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">primitive</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Primitive</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geometryInstances</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">instances</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">appearance</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">appearance</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">asynchronous</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">primitives</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">primitive</span>);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">Cesium</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;cesium&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">useState</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">LineReader</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;../common/utils/LineReader&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">getColorRgba</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;../constants&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">useTriangle</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> [<span style="color:#a6e22e">collection</span>, <span style="color:#a6e22e">setCollection</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>([]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">uploadTriangle</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">files</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">LineReader</span>({});
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">isosurfaceCollection</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">row</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">readHead</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">row</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">row</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// å¦‚ æœ‰å¤šå°‘ä¸ªå€¼ å€¼åˆ†åˆ«ä¸º 5,25,30,40,50,60,,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;,&#39;</span>).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">arr</span>[<span style="color:#ae81ff">0</span>]; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">val</span> <span style="color:#f92672">=</span> Number(<span style="color:#a6e22e">arr</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">isosurfaceCollection</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;isosurface-&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">i</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">tins</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">val</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">getColorRgba</span>(<span style="color:#a6e22e">val</span>), <span style="color:#75715e">//è·å–valueå¯¹åº”çš„é¢œè‰²å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;line&#39;</span>, <span style="color:#a6e22e">readChunkHead</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">line</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">isosurfaceCollection</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// row ä¸º2 0è¡Œå¼€å§‹ï¼Œç¬¬2è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">targetRow</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">readChunkHead</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;,&#39;</span>).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// len = arr[2]; //è¿™ä¸€ä¸ªå€¼åŸŸçš„æ•°ç»„çš„é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">targetRow</span> <span style="color:#f92672">=</span> Number(<span style="color:#a6e22e">arr</span>[<span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span> <span style="color:#a6e22e">row</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// æŒ‡é’ˆåŠ 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">index</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;line&#39;</span>, <span style="color:#a6e22e">readChunk</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">readChunk</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// index ç­‰å€¼é¢æ•°ç»„ä¸­çš„ç¬¬å‡ ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">//  targetRow è¦è¯»åˆ°ç¬¬å‡ è¡Œæ‰ç®—è¯»å®Œè¿™ä¸€å—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// row å½“å‰çš„è¡Œæ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">row</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">row</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">targetRow</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;line&#39;</span>, <span style="color:#a6e22e">readChunkHead</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">row</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">line</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;,&#39;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; Number(<span style="color:#a6e22e">item</span>));
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// let [x, y, z] = arr;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">let</span> { <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>, <span style="color:#a6e22e">z</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Cartesian3</span>.<span style="color:#a6e22e">fromDegrees</span>(...<span style="color:#a6e22e">arr</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">isosurfaceCollection</span>[<span style="color:#a6e22e">index</span>].<span style="color:#a6e22e">tins</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>, <span style="color:#a6e22e">z</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;error&#39;</span>, (<span style="color:#a6e22e">err</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;progress&#39;</span>, (<span style="color:#a6e22e">proportion</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(Math.<span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">proportion</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;%&#39;</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;end&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;è¯»å–ç»“æŸ&#39;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">isosurfaceCollection</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">setCollection</span>(<span style="color:#a6e22e">isosurfaceCollection</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;line&#39;</span>, <span style="color:#a6e22e">readHead</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lr</span>.<span style="color:#a6e22e">read</span>(<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getGeometryInstance</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">positions</span>, <span style="color:#a6e22e">color</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// const positions = new Float64Array(collection[0].tins);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">positions</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">indices</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Array(<span style="color:#a6e22e">count</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">count</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">indices</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">geometry</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryPipeline</span>.<span style="color:#a6e22e">computeNormal</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Cesium.GeometryPipeline.toWireframe(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Geometry</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryAttribute</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">componentDatatype</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ComponentDatatype</span>.<span style="color:#a6e22e">DOUBLE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">componentsPerAttribute</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">positions</span>,
</span></span><span style="display:flex;"><span>          }),
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">primitiveType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">PrimitiveType</span>.<span style="color:#a6e22e">TRIANGLES</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">boundingSphere</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">BoundingSphere</span>.<span style="color:#a6e22e">fromVertices</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">positions</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// new Cesium.Cartesian3(0.0, 0.0, 0.0),
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#75715e">// 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">indices</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">indices</span>,
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeometryInstance</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">geometry</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">geometry</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">color</span> <span style="color:#75715e">/* new Cesium.ColorGeometryInstanceAttribute(1.0, 1.0, 1.0, 0.5), */</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">onOkTriangle</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">collection</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">instances</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">collection</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">instances</span>.<span style="color:#a6e22e">push</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">getGeometryInstance</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float64Array</span>(<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">tins</span>),
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">ColorGeometryInstanceAttribute</span>(...<span style="color:#a6e22e">collection</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">color</span>, <span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">instances</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">appearance</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">PerInstanceColorAppearance</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// flat: true,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// translucent: true,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">primitive</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">Primitive</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">geometryInstances</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">instances</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">appearance</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">appearance</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">asynchronous</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">primitives</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">primitive</span>);
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">collection</span>, <span style="color:#a6e22e">uploadTriangle</span>, <span style="color:#a6e22e">onOkTriangle</span> };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åŠ è½½å‡ºçš„ç»“æœï¼š<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1672310143864-05f493f6-e6bd-41da-a466-ed49a4b7f8d6.png#averageHue=%230d3033&amp;clientId=u42c02e90-65ab-4&amp;from=paste&amp;height=619&amp;id=u95111c05&amp;originHeight=774&amp;originWidth=586&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=278873&amp;status=done&amp;style=none&amp;taskId=u778e4d94-b8d8-4baa-995b-e08bbe923f8&amp;title=&amp;width=468.8" alt="image.png" loading="lazy" /></p>

<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="5åŠ è½½ç­‰å€¼çº¿">5.åŠ è½½ç­‰å€¼çº¿</h1>
<p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1679221438750-45ef14ec-8286-4d4e-bde6-41a1343a9bbc.png#averageHue=%23f3efeb&amp;clientId=u994f0e81-2b24-4&amp;from=paste&amp;height=595&amp;id=u8be7c01d&amp;originHeight=744&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=148955&amp;status=done&amp;style=none&amp;taskId=u2ecae715-00ad-44b0-8886-d91791e1911&amp;title=&amp;width=1536" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->æ€è·¯ï¼š<!-- raw HTML omitted -->é€è¡Œè¯»å–</p>
<ol>
<li>è¯»å–æ–‡ä»¶ç±»åˆ«ï¼šContourPolylines</li>
<li>è¯»å–ç­‰å€¼ç»„æ•°ï¼Œä¸€å…±ç»„å°‘ä¸ªç­‰å€¼çº¿ï¼Œæ¯ç»„æœ‰å‡ ä¸ª</li>
<li>è¯»å–ä¸€ç»„ç­‰å€¼çº¿çš„å€¼å’Œä¸ªæ•°</li>
<li>è¯»å–è¯¥ç»„æ•°æ®</li>
</ol>
<p>ç»˜åˆ¶</p>
<ol>
<li>é‡‡ç”¨instancesï¼ŒprimitiveType.Lines</li>
<li>ç”±äºæ¯ä¸ªç­‰å€¼é¢å…·æœ‰å¤šæ¡çº¿ï¼Œæ¯æ¡çº¿åˆæˆ–è€…é—­åˆæˆ–ä¸é—­åˆï¼Œé‡‡ç”¨ä»£ç ç”Ÿæˆé¡¶ç‚¹ç´¢å¼•æ¥è§£å†³
<ol>
<li>æ¯ä¸€è¡Œ(æ¯æ¡çº¿)çš„é¡¶ç‚¹ç´¢å¼•ä¸º [0,1,1,2,2,3,3,4&hellip;]</li>
<li>å‡è®¾å½“å‰ä¸ºç¬¬iè¡Œï¼Œå‰i-1è¡Œå…±æœ‰nä¸ªé¡¶ç‚¹ï¼Œç¬¬iè¡Œå…±æœ‰ m ä¸ªé¡¶ç‚¹ ï¼Œåˆ™å½“å‰è¡Œçš„é¡¶ç‚¹ç´¢å¼•ä¸º [n+1,n+2,n+2,n+3&hellip;n+m-1,n+m] é¡¶ç‚¹ç´¢å¼•å¿…æ˜¯2çš„å€æ•°</li>
</ol>
</li>
</ol>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="å®ç°å›¾å±‚æ§åˆ¶">å®ç°å›¾å±‚æ§åˆ¶</h1>
<p>è¦å®ç°å›¾å±‚æ§åˆ¶ï¼Œæœ‰ä¸¤ç‚¹å¿…é¡»å®ç°çš„ç‚¹ã€‚</p>
<ol>
<li>æ§åˆ¶å›¾å±‚æ˜¾ç¤ºå’Œéšè—</li>
<li>å®šä¹‰å›¾å±‚</li>
</ol>
<p>ç¬¬ä¸€ç‚¹å¾ˆå®¹æ˜“ç†è§£ï¼Œè¦èƒ½å¤Ÿå®ç°æˆ‘ä»¬ä¸Šé¢åŠ è½½çš„è¿™äº›ç§ç±»æ•°æ®çš„æ˜¾ç¤ºå’Œéšè—ï¼Œå¤§ä½“å¦‚ä¸‹</p>
<ul>
<li>geojson</li>
<li>entity</li>
<li>primitive
<!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
<h2 id="geojson">geojson</h2>
<p>å›é¡¾ä¸€ä¸‹cesiumåŠ è½½geojsonçš„è¿‡ç¨‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">dataSources</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeoJsonDataSource</span>.<span style="color:#a6e22e">load</span>(<span style="color:#a6e22e">geojson</span>));
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡dataSourcesè¿›è¡ŒåŠ è½½çš„ã€‚æˆ‘ä»¬å°†dataSourcesæ‰“å°å‡ºæ¥çœ‹ä¸‹<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1672914301853-a45e4225-fca7-4b3c-9e7c-1cb8e22712aa.png#averageHue=%23fdfdfd&amp;clientId=u275a6796-01ab-4&amp;from=paste&amp;height=684&amp;id=ud63abdbb&amp;originHeight=855&amp;originWidth=1373&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=149198&amp;status=done&amp;style=none&amp;taskId=uc260fe5d-7c52-44b0-8708-449e0000e41&amp;title=&amp;width=1098.4" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->å¯ä»¥çœ‹åˆ°å…¶æ˜¯ä¸€ä¸ª<code>**dataSource**</code>çš„é›†åˆï¼Œå¯ä»¥é€šè¿‡<code>**get(index)**</code>çš„æ–¹å¼æ¥è·å–æ‰€æœ‰çš„<code>**dataSource**</code>ã€‚</p>
<blockquote>
<p>æ›´å¤šdataSourceCollectionçš„ç”¨æ³•è§å®˜ç½‘api <a href="https://cesium.com/learn/cesiumjs/ref-doc/DataSourceCollection.html" target="_blank" rel="noopener">https://cesium.com/learn/cesiumjs/ref-doc/DataSourceCollection.html</a></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">dataSources</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">dataSources</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">dataSources</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">dataSources</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">i</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å†é€šè¿‡å…¶showå±æ€§å°±å¯ä»¥æ§åˆ¶å¯¹åº”dataSourceçš„æ˜¾ç¤ºå’Œéšè—äº†</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">dataSource</span>.<span style="color:#a6e22e">show</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;<span style="color:#75715e">//true ä¸ºæ˜¾ç¤º
</span></span></span></code></pre></div><p>æ­¤å¤–è¦è¿›è¡Œå›¾å±‚æ§åˆ¶ï¼Œå¾—çŸ¥é“æ¯ä¸ªå›¾å±‚çš„åå­—ï¼Œè¿™æ ·æ‰èƒ½ç›´è§‚çš„å¯¹å¯¹åº”çš„å›¾å±‚è¿›è¡Œæ“ä½œã€‚<!-- raw HTML omitted -->dataSourceæä¾›ä¸€ä¸ªnameå±æ€§ï¼ŒDataSourceCollectionæä¾›äº†é€šè¿‡nameè·å¾—dataSourceçš„æ–¹æ³•<code>getByName</code>ã€‚å› æ­¤åªéœ€åœ¨åˆ›å»ºdataSourceçš„æ—¶å€™ç»™å®ƒä¸€ä¸ªnameå³å¯ã€‚å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">dataSource</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Cesium</span>.<span style="color:#a6e22e">GeoJsonDataSource</span>(<span style="color:#e6db74">&#39;boua_bianma&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dataSource</span>.<span style="color:#a6e22e">load</span>(<span style="color:#a6e22e">geojson</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">dataSources</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">dataSource</span>);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">dataSources</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">dataSources</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">dataSources</span>.<span style="color:#a6e22e">getByName</span>(<span style="color:#e6db74">&#39;boua_bianma&#39;</span>));<span style="color:#75715e">//æ³¨æ„è¿™é‡Œæ˜¯ä¸€ä¸ªdataSourceæ•°ç»„
</span></span></span></code></pre></div><p>åˆ°è¿™é‡Œgeojsonéƒ¨åˆ†çš„å°±å¯ä»¥å®ç°æ ¹æ®åç§°æ¥å®ç°å…¶å›¾å±‚æ˜¾ç¤ºå’Œéšè—ã€‚ <!-- raw HTML omitted -->åŠ è½½dataSourceå¯èƒ½ä¼šç”±äºå¼‚æ­¥çš„å…³ç³»æœ‰å»¶è¿Ÿï¼Œå¯ä»¥ç»‘å®šä¸€ä¸ªåŠ è½½äº‹ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">dataSources</span>.<span style="color:#a6e22e">dataSourceAdded</span>.<span style="color:#a6e22e">addEventListener</span>(
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">dataSources</span>, <span style="color:#a6e22e">dataSource</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">dataSources</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">dataSource</span>);
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">dataSources</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="entity">entity</h2>
<p>æœ‰äº†å‰é¢dataSourceçš„ç»éªŒï¼Œentityçš„æ˜¾ç¤ºå’Œéšè—ä¹Ÿæ˜¯ç±»ä¼¼ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">viewr</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">add</span>()<span style="color:#75715e">//åŠ è½½
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">_entities</span>.<span style="color:#a6e22e">_array</span> <span style="color:#75715e">//è·å–ä¸€ä¸ªåŒ…å«æ‰€æœ‰entityçš„æ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">entity</span>.<span style="color:#a6e22e">show</span><span style="color:#f92672">=</span><span style="color:#66d9ef">false</span> <span style="color:#75715e">//æ˜¾ç¤ºéšè—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">getById</span>(<span style="color:#a6e22e">id</span>)<span style="color:#75715e">//æ ¹æ®idè·å–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">removeById</span>(<span style="color:#a6e22e">id</span>) <span style="color:#75715e">//æ ¹æ®idç§»é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">entity</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">removeAll</span>() <span style="color:#75715e">//ç§»é™¤æ‰€æœ‰
</span></span></span></code></pre></div><p>æ³¨æ„éœ€è¦åœ¨åŠ è½½å®ä½“çš„æ—¶å€™ç»™å®š<strong>å”¯ä¸€çš„i</strong>då€¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getUniqueId</span>(<span style="color:#a6e22e">viewer</span>, <span style="color:#a6e22e">id</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">sufixId</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">entities</span>.<span style="color:#a6e22e">getById</span>(<span style="color:#a6e22e">res</span>) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">sufixId</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sufixId</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="primitive">primitive</h2>
<p>è€ƒè™‘åˆ°entityæ˜¯å°è£…äº†çš„primitiveï¼Œå› æ­¤åœ¨è¿›è¡Œç»Ÿè®¡çš„æ—¶å€™,è¦å»é™¤ä¸€ä¸ªåŒ…å«æ‰€æœ‰entityçš„primitive</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">//æ–¹ä¾¿æ˜¾ç¤ºå¯¹primitiveå¢åŠ ä¸€ä¸ªnameå±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">primitive</span>.<span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;filename&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">primitives</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">primitive</span>);<span style="color:#75715e">//æ·»åŠ primitive
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">primitives</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">index</span>) <span style="color:#75715e">//ä¾æ®ç´¢å¼•è·å–å¯¹åº”çš„primitive
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">primitives</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">primitive</span>) <span style="color:#75715e">//ç§»é™¤æŒ‡å®šçš„primitive
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">primitives</span>.<span style="color:#a6e22e">removeAll</span>()<span style="color:#75715e">//ç§»é™¤æ‰€æœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">viewer</span>.<span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">primitives</span>.<span style="color:#a6e22e">show</span><span style="color:#f92672">=</span><span style="color:#66d9ef">false</span><span style="color:#75715e">//æ•´ä¸ªé›†åˆæ˜¾ç¤ºæˆ–éšè—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">primitive</span>.<span style="color:#a6e22e">show</span><span style="color:#f92672">=</span><span style="color:#66d9ef">false</span> <span style="color:#75715e">//æ•´ä¸ªé›†åˆçš„æ˜¾ç¤ºå’Œéšè—
</span></span></span></code></pre></div><p>
  <figure class="figure-image">
    <img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1673076082177-e7d537d1-175a-44b4-86c8-4c9a68c2745a.png#averageHue=%23fefefe&amp;clientId=ud995dbe3-8320-4&amp;from=paste&amp;height=498&amp;id=uee9396ed&amp;originHeight=622&amp;originWidth=1327&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=95116&amp;status=done&amp;style=none&amp;taskId=u7ec3b814-5c51-409b-a902-a935b8cfdb5&amp;title=primitiveCollection&amp;width=1061.6" title="primitiveCollection" alt="primitiveCollection" loading="lazy" />
    <figcaption>primitiveCollection</figcaption>
  </figure>
</p>

          </div>
        </div>
                 
      
  
  
  
  

  

  <div class="article-paging">
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" background-image-lazy data-img="https://cdn.nlark.com/yuque/0/2022/png/29064333/1670747736347-1c7e2143-efbd-451e-835c-2ac2c6142dc6.png"></div>
  <div class="card-text">
    <a href="/docs/yizhiny0989zgxag/"><h4 class="card-text--title text-ellipsis">è·å–é¼ æ ‡ä½ç½®åæ ‡</h4></a>
    <p class="card-text--row">2022-12-11 08:35</p>
  </div>
</section>
    
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" background-image-lazy data-img="https://cdn.nlark.com/yuque/0/2022/png/29064333/1670729289748-1914327a-547b-410e-b28f-23e12b9bb914.png"></div>
  <div class="card-text">
    <a href="/docs/gb6gb3cwgbt5y190/"><h4 class="card-text--title text-ellipsis">å»é™¤cesiumé»˜è®¤æ§ä»¶</h4></a>
    <p class="card-text--row">2022-12-11 02:54</p>
  </div>
</section>
    
  </div>
</div>
  <aside class="widget-info">
    
<section class="aside-widget widget-author content-padding-large soft-size--large soft-style--box">
  <div class="widget-body">
    <div class="author-box avatar">
      
      <img class="author-avatar soft-size--round soft-style--box" src="https://cdn.jsdelivr.net/gh/Sentisfate/wanhuatong@main/img/cdai.jfif" alt="gisculibur">
      
      <h2 class="author-name text-ellipsis">gisculibur</h2>
      
      <p class="author-desc text-ellipsis">æ–°æ‰‹WebGISæ”»åŸç‹®</p>
      
    </div>
  </div>
</section>


    

<section class="aside-widget widget-toc content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>ç›®å½•</span>
    </div>
  </h2>
  <div class="widget-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1shapefile">1.shapefile</a></li>
    <li><a href="#2åœ¨æŒ‡å®šä½ç½®åŠ è½½ä¸€å¼ å›¾ç‰‡-img">2.åœ¨æŒ‡å®šä½ç½®åŠ è½½ä¸€å¼ å›¾ç‰‡ img</a></li>
    <li><a href="#3åŠ è½½æ …æ ¼æ•°æ®å¦‚-ascii">3.åŠ è½½æ …æ ¼æ•°æ®å¦‚ ascii</a>
      <ul>
        <li><a href="#çº¿æ€§æ‹‰ä¼¸">çº¿æ€§æ‹‰ä¼¸</a></li>
        <li><a href="#è¯»å†™åƒç´ ">è¯»å†™åƒç´ </a></li>
      </ul>
    </li>
    <li><a href="#4åŠ è½½ç­‰å€¼é¢ä¸‰è§’ç½‘">4.åŠ è½½ç­‰å€¼é¢ä¸‰è§’ç½‘</a>
      <ul>
        <li><a href="#ç”»ä¸€ä¸ªä¸‰è§’å½¢">ç”»ä¸€ä¸ªä¸‰è§’å½¢</a></li>
        <li><a href="#åŠ è½½ä¸åŒé¡¶ç‚¹é¢œè‰²çš„ä¸‰è§’å½¢">åŠ è½½ä¸åŒé¡¶ç‚¹é¢œè‰²çš„ä¸‰è§’å½¢</a></li>
        <li><a href="#åŠ¨æ€ä¿®æ”¹ä¸‰è§’å½¢çš„é¢œè‰²">åŠ¨æ€ä¿®æ”¹ä¸‰è§’å½¢çš„é¢œè‰²</a></li>
        <li><a href="#è¸©å‘ä¹‹è·¯">è¸©å‘ä¹‹è·¯</a>
          <ul>
            <li><a href="#é—®é¢˜1">é—®é¢˜1.</a></li>
            <li><a href="#é—®é¢˜2é¡¶ç‚¹ç´¢å¼•ç›¸å…³é—®é¢˜">é—®é¢˜2.é¡¶ç‚¹ç´¢å¼•ç›¸å…³é—®é¢˜</a></li>
          </ul>
        </li>
        <li><a href="#è¯»å–csv">è¯»å–csv</a></li>
      </ul>
    </li>
    <li><a href="#5åŠ è½½ç­‰å€¼çº¿">5.åŠ è½½ç­‰å€¼çº¿</a></li>
    <li><a href="#å®ç°å›¾å±‚æ§åˆ¶">å®ç°å›¾å±‚æ§åˆ¶</a>
      <ul>
        <li><a href="#geojson">geojson</a></li>
        <li><a href="#entity">entity</a></li>
        <li><a href="#primitive">primitive</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</section>


    










<section class="aside-widget widget-articles content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>ç›¸å…³æ–‡ç« </span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="post-list">
      
      
        <li class="post-item"><a href="/docs/ix726493ddpi6i3q/">3dTiles</a></li>
      
        <li class="post-item"><a href="/posts/qa4vydlw37pbsi3v/">WebGL å›¾åƒå¤„ç†</a></li>
      
        <li class="post-item"><a href="/docs/goz05uyu3i5v92c9/">Cesium æ¨¡å‹å‹å¹³</a></li>
      
        <li class="post-item"><a href="/docs/cl6l0mww8kkkizwb/">ä¸‰è§’å‰–åˆ†</a></li>
      
        <li class="post-item"><a href="/docs/prgrgit7lss8vggf/">GISç†è®ºåŸºç¡€</a></li>
      
        <li class="post-item"><a href="/docs/vzxnspucb4agb00w/">é—®é¢˜</a></li>
      
    </ul>
  </div>
</section>


    




<section class="aside-widget widget-categories content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>åˆ†ç±»</span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="categories-list">
      
        <li>
          <a href="https://Sentisfate.github.io/categories/webgl/">WebGL</a>
          <span>1</span>
        </li>
      
        <li>
          <a href="https://Sentisfate.github.io/categories/%E5%9B%BE%E5%BA%8A/">å›¾åºŠ</a>
          <span>1</span>
        </li>
      
    </ul>
  </div>

  
</section>


    




<section class="aside-widget widget-tags content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>æ ‡ç­¾</span>
    </div>
  </h2>
  <div class="widget-body">
    <div class="tags-list">
      
        <a href="https://Sentisfate.github.io/tags/github/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">github</a>
      
        <a href="https://Sentisfate.github.io/tags/picgo/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">picgo</a>
      
        <a href="https://Sentisfate.github.io/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">å›¾åƒå¤„ç†</a>
      
    </div>
  </div>

  
</section>

  </aside>
</div>
  </main><footer class="footer-container layout-block">
  
  <div class="social-icons">
    
      <a class="soft-size--primary soft-style--box" href="https://github.com/Sentisfate" target="_blank" rel="noopener noreferrer">
          
        <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
        </svg>
        

        

        

        

        
      </a>
    
  </div>
  

  <div class="colour-bar"></div>
  
  

  

  <p>
    Powered by
    <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a>
    Theme - 
    <a href="https://github.com/miiiku/hugo-theme-kagome" target="_blank" rel="noopener noreferrer author">kagome</a>
  </p>

  <p>
    <a href="javascript:;" id="theme-light">ğŸŒ æµ…è‰²</a>
    <a href="javascript:;" id="theme-dark">ğŸŒ› æ·±è‰²</a>
    <a href="javascript:;" id="theme-auto">ğŸ¤–ï¸ è‡ªåŠ¨</a>
  </p>
</footer>



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>






</body>

</html>