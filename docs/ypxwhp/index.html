<!DOCTYPE html>
<html><head>
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer" />
   
  <meta name="author" content="gisculibur">
  

   
  
  
  
  
  
  
  <meta name="keywords"
    content="theme,kagome">
  

  

  <meta name="generator" content="Hugo 0.115.2">


  
  
  
  
  <title>OpenLayers 🌟 GIS咖喱棒</title>

  <meta property="og:title" content="OpenLayers" />
<meta property="og:description" content="官网：OpenLayers - Documentation中地封装的apiOpenLayers5示例中地的服务:http://develop.s" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Sentisfate.github.io/docs/ypxwhp/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2022-07-20T02:02:20+00:00" />
<meta property="article:modified_time" content="2022-08-23T06:17:14+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="OpenLayers"/>
<meta name="twitter:description" content="官网：OpenLayers - Documentation中地封装的apiOpenLayers5示例中地的服务:http://develop.s"/>


  
  
  
  
  <link rel="stylesheet" href="https://Sentisfate.github.io/assets/css/style.min.a9eba8a87a1f5444669cfe92317af83504187100f2529f484b2eeaff89777b86.css" integrity="sha256-qeuoqHofVERmnP6SMXr4NQQYcQDyUp9ISy7q/4l3e4Y=">

  <script src="https://Sentisfate.github.io/assets/js/main.min.182da266209851bc7c828aa7377f98f914e1e76c8decdd53a6cbe9bffea92cde.js" integrity="sha256-GC2iZiCYUbx8goqnN3&#43;Y&#43;RTh52yN7N1Tpsvpv/6pLN4="></script>

  </head><body><header class="header-container layout-block layout-padding">
  <div class="header-inner content-padding-large soft-size--large soft-style--box">
    <div class="header-logo">
      <a href="https://Sentisfate.github.io"><h1>GIS咖喱棒</h1></a>
    </div>
    <nav class="header-nav">
      <div class="header-nav--btn">
        <div class="btn-item"></div>
        <div class="btn-item"></div>
        <div class="btn-item"></div>
      </div>
      <div class="header-nav--list">
        <div>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/" title="GIS咖喱棒">主页</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/docs/" title="Docs">笔记</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/categories/" title="Categories">分类</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/tags/" title="Tags">标签</a>
          
        </div>
      </div>
    </nav>
  </div>
</header><main id="content">
    

    <div class="single-container layout-block">
      <div class="article-info">
        <div class="article-header layout-padding">
          <div class="article-cover card-container content-padding-large soft-size--large soft-style--box img">

  <div class="card-cover">
    
      <img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1658718036083-fe7c89ba-7662-4b1e-a80c-798c33b63bb9.png" alt="https://cdn.nlark.com/yuque/0/2022/png/29064333/1658718036083-fe7c89ba-7662-4b1e-a80c-798c33b63bb9.png" />
    
  </div>

  <div class="card-text">
    <h1 class="card-text--title">OpenLayers</h1>
    
      <p class="card-text--row">2022-07-20 02:02</p>
      
      
      

      
      
    
  </div>

</div>
        </div>

        <div class="article-content">
          <div class="markdown-body content-padding-large soft-size--large soft-style--box">
            <p>官网：<!-- raw HTML omitted --><a href="https://openlayers.org/en/v5.3.0/doc/" target="_blank" rel="noopener">OpenLayers - Documentation</a><!-- raw HTML omitted -->中地封装的api<!-- raw HTML omitted --><a href="http://develop.smaryun.com:81/API/JS/OL5InterfaceDemo/index.htm" target="_blank" rel="noopener">OpenLayers5示例</a><!-- raw HTML omitted -->中地的服务:<!-- raw HTML omitted --><a href="http://develop.smaryun.com:81/API/JS/IGS%20JavaScript%20API%20v02/index.htm#a0" target="_blank" rel="noopener">http://develop.smaryun.com:81/API/JS/IGS%20JavaScript%20API%20v02/index.htm#a0</a><!-- raw HTML omitted -->笔记：<!-- raw HTML omitted --><a href="https://www.yuque.com/kcyfzx/znhnkg/akyu8q?view=doc_embed" target="_blank" rel="noopener">👨‍💻 二次开发</a>
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="一openlayer如何加载ig-server的地图文档">一、openlayer如何加载ig server的地图文档</h2>
<blockquote>
<ol>
<li>��入openlayer</li>
<li>调用中地的接口加载地图文档</li>
<li>实例化地图容器加载地图文档图层</li>
</ol>
</blockquote>
<p>实现的代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#f92672">&lt;!</span><span style="color:#a6e22e">DOCTYPE</span> <span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">http</span><span style="color:#960050;background-color:#1e0010">-</span><span style="color:#a6e22e">equiv</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;X-UA-Compatible&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;IE=edge&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;<span style="color:#a6e22e">Document</span>&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!--</span> <span style="color:#a6e22e">导入ol的依赖</span> <span style="color:#f92672">--&gt;</span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./dist/include-openlayers-local.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!--</span> <span style="color:#a6e22e">设置map的挂载点</span> <span style="color:#f92672">--&gt;</span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;map&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 实例化地图容器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 1.加载zd地图文档
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">docLayer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Map</span>.<span style="color:#a6e22e">Doc</span>(<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;test02&#39;</span>, {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">ip</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;localhost&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">6163</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 实例化地图容器，装载地图文档图层
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">map</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">Map</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 设置地图容器的挂载点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">target</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;map&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 设置图层
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">layers</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">docLayer</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 设置地图以什么样的视角进行呈现
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">view</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">View</span>({
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">center</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">30</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">zoom</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">projection</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;EPSG:4326&#39;</span>,
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><blockquote>
<p>前端的openlayer要和ig server 发布的地图文档进行通信，是通过中地的接口 <code>Zondy.Map.Doc</code></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">docLayer</span><span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Map</span>.<span style="color:#a6e22e">Doc</span>(<span style="color:#e6db74">&#39;&#39;</span>,<span style="color:#a6e22e">docName</span>,{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ip</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;localhost&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6163</span>
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="二vue3集成openlayer">二、vue3集成openlayer</h2>
<ol>
<li>安装</li>
</ol>
<p><code>**npm install ol**</code></p>
<ol start="2">
<li>main.js导入ol样式</li>
</ol>
<p><code>**import 'ol/ol.css';**</code></p>
<ol start="3">
<li>创建map容器</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">template</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;map&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">template</span>&gt;
</span></span></code></pre></div><ol start="4">
<li>实例化地图对象</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">setup</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Map</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;ol/Map&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">import</span> <span style="color:#a6e22e">View</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;ol/View&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">import</span> <span style="color:#a6e22e">TileLayer</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;ol/layer/Tile&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">import</span> <span style="color:#a6e22e">OSM</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;ol/source/OSM&#39;</span>;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">onMounted</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;vue&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">onMounted</span>(() =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">map</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">view</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">View</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">center</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">zoom</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      }),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">layers</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TileLayer</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">source</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">OSM</span>(),
</span></span><span style="display:flex;"><span>        }),
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">target</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;map&#39;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="三react集成openlayer">三、React集成openlayer</h2>
<ol>
<li>安装</li>
<li>导入样式</li>
</ol>
<p><code>**import 'ol/ol.css';**</code></p>
<ol start="3">
<li>创建map容器</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">App</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;map&#34;</span><span style="color:#f92672">&gt;&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="4">
<li>实例化map对象</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">useState</span>, <span style="color:#a6e22e">useEffect</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;./App.css&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Map</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;ol/Map&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">View</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;ol/View&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">TileLayer</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;ol/layer/Tile&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">OSM</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;ol/source/OSM&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">App</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">setCount</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//   useEffect 会在页面渲染时执行回调函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">useEffect</span>(() =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">map</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">view</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">View</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">center</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">zoom</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      }),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">layers</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TileLayer</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">source</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">OSM</span>(),
</span></span><span style="display:flex;"><span>        }),
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">target</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;map&#39;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;map&#34;</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() =&gt; <span style="color:#a6e22e">setCount</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)}<span style="color:#f92672">&gt;&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">App</span>;
</span></span></code></pre></div><blockquote>
<p>关于<code>**ol.source.XYZ**</code>** 中的X,Y,Z是什么意思**
💡 x是瓦片的列号，y是瓦片的行号，z是放大级别，如果出现瓦片颠倒错乱现象，多是xy顺序不对的原因</p>
</blockquote>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="四常用api">四、常用api</h2>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="1操作图层">1.操作图层</h3>
<ul>
<li>map.addLayer(layerName) 添加图层</li>
<li>map.removeLayer(layerName) 删除图层</li>
<li>map.getLayers().getArray()获取图层</li>
<li>获取视图 map.getView()</li>
<li>访问放大级别 <code>**view.getZoom()**</code>  <code>**view.setZoom()**</code></li>
<li>设置中心点 <code>**view.setCenter()**``**view.getCenter()**</code>
<!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
<h3 id="2事件的绑定和移除">2.事件的绑定和移除</h3>
<ul>
<li>map.on()</li>
<li>map.un()
<!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
<h3 id="3控件">3.控件</h3>
<ul>
<li>比例尺控件</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">scaleLineControl</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">control</span>.<span style="color:#a6e22e">ScaleLine</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置比例尺单位，degrees、imperial、us、nautical、metric（度量单位）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">units</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;metric&#34;</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">addControl</span>(<span style="color:#a6e22e">scaleLineControl</span>)
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="五绘图原理">五、绘图原理</h2>
<blockquote>
<p>在map上加载layer，在layer上设置source，map以一定的视角进行显示</p>
</blockquote>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="1绘制点">1.绘制点</h3>
<ol>
<li>构建要素的几何信息</li>
<li>构建要素的样式信息</li>
<li>将要素添加到数据源  <code>**source.addFeature**</code></li>
<li>将数据源添加到图层</li>
<li>将图层添加到map</li>
</ol>
<p>
  <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29064333/1658718036083-fe7c89ba-7662-4b1e-a80c-798c33b63bb9.png#clientId=u6dead4c0-55a1-4&amp;from=paste&amp;height=409&amp;id=u8b6b7c17&amp;originHeight=511&amp;originWidth=468&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25068&amp;status=done&amp;style=none&amp;taskId=u2e96f4b6-1c66-48b2-8409-fb2933f8581&amp;title=&amp;width=374.4" alt="image.png" loading="lazy" /></p>

:::info
Point,Line,Circle,Square,Rectangle,Polygon,
:::
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="2交互式的绘制">2.交互式的绘制</h3>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h4 id="基本概念">基本概念</h4>
<p>交互式绘制的两个概念，<strong>画布和画笔</strong>。<!-- raw HTML omitted -->画布是包含一个<code>**source**</code>和<code>**layer **</code> <code>**source.clear()**</code><strong>清空数据源</strong><!-- raw HTML omitted -->画笔是交互的操作：<code>**ol.interaction.Draw()**``**map.addInteraction(**draw**)**</code>，<code>**map.removeInteraction(**draw**)**</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// 添加画笔
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">draw</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">interaction</span>.<span style="color:#a6e22e">Draw</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">source</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Point&#39;</span>,
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#75715e">//将画笔添加到地图上   
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">addInteraction</span>(<span style="color:#a6e22e">draw</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">//将画笔从交互中移除
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">removeInteraction</span>(<span style="color:#a6e22e">draw</span>)
</span></span></code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Document&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./dist/include-openlayers-local.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./config/map/gao.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./config/css/map.css&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;map&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">map</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">Map</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">target</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;map&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">layers</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">gaodeMapLayer</span>, <span style="color:#a6e22e">gaodeImage</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">view</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">View</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">projection</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;EPSG:4326&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">center</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">114.30</span>, <span style="color:#ae81ff">30.50</span>],
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">zoom</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 通过交互式的画笔实现点要素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// 创建画布
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// 添加画笔
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 1.创建数据源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">source</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">Vector</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">wrapX</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">layer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">Vector</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">source</span>,
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">addLayer</span>(<span style="color:#a6e22e">layer</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 添加画笔
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">draw</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">interaction</span>.<span style="color:#a6e22e">Draw</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">source</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Point&#39;</span>,
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">addInteraction</span>(<span style="color:#a6e22e">draw</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;drawend&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// console.log(&#39;draw&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// console.log(e.feature.getGeometry())
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">geometry</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">feature</span>.<span style="color:#a6e22e">getGeometry</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">geometry</span>.<span style="color:#a6e22e">getCoordinates</span>())
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>绘制线，设置画笔<code>**type**</code>为<code>**LineString**</code>  <code>**getCoordinates**</code><!-- raw HTML omitted -->绘制⚪ ，type 为 Circle <code>**getCenter**</code>  <code>**getRadius**</code>** **<!-- raw HTML omitted --><strong>绘制正方形  5个坐标点</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">draw</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">interaction</span>.<span style="color:#a6e22e">Draw</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">source</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Circle&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geometryFunction</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">interaction</span>.<span style="color:#a6e22e">Draw</span>.<span style="color:#a6e22e">createRegularPolygon</span>(<span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">addInteraction</span>(<span style="color:#a6e22e">draw</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;drawend&#39;</span>, (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">e</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">feature</span>.<span style="color:#a6e22e">getGeometry</span>().<span style="color:#a6e22e">getCoordinates</span>())
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>** 交互式画笔实现封装**</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/* Point, LineString , Polygon, Circle */</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* Square|Box */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createDraw</span>({ <span style="color:#a6e22e">type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Point&#39;</span>, <span style="color:#a6e22e">source</span> }, <span style="color:#a6e22e">callback</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">maxPoints</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">geometryFunction</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Square&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Circle&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geometryFunction</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">interaction</span>.<span style="color:#a6e22e">Draw</span>.<span style="color:#a6e22e">createRegularPolygon</span>(<span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Box&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;LineString&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geometryFunction</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">coordinates</span>, <span style="color:#a6e22e">geometry</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">geometry</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//多边形
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">geometry</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">geom</span>.<span style="color:#a6e22e">Polygon</span>(<span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">coordinates</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">end</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">coordinates</span>[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">geometry</span>.<span style="color:#a6e22e">setCoordinates</span>([
</span></span><span style="display:flex;"><span>        [<span style="color:#a6e22e">start</span>, [<span style="color:#a6e22e">start</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">end</span>[<span style="color:#ae81ff">1</span>]], <span style="color:#a6e22e">end</span>, [<span style="color:#a6e22e">end</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">start</span>[<span style="color:#ae81ff">1</span>]], <span style="color:#a6e22e">start</span>],
</span></span><span style="display:flex;"><span>      ]);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">geometry</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">draw</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">interaction</span>.<span style="color:#a6e22e">Draw</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">source</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geometryFunction</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">callback</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;drawend&#39;</span>, <span style="color:#a6e22e">callback</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">draw</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="点线面的封装">点线面的封装</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pntColor</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">POINT_STYLE</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">CPointInfo</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Angle</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Color</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Space</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SymHeight</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SymID</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">114</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SymWidth</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Point</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">query</span>({ <span style="color:#a6e22e">position</span>, <span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">radius</span>, <span style="color:#a6e22e">onSuccess</span>, <span style="color:#a6e22e">map</span> }) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">queryStruct</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Service</span>.<span style="color:#a6e22e">QueryFeatureStruct</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">queryStruct</span>.<span style="color:#a6e22e">IncludeGeometry</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">queryStruct</span>.<span style="color:#a6e22e">IncludeWebGraphic</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建一个用于查询的点形状
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pointObj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">Point2D</span>(...<span style="color:#a6e22e">position</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置点容差半径
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">pointObj</span>.<span style="color:#a6e22e">nearDis</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">radius</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//定义查询规则
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rule</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Service</span>.<span style="color:#a6e22e">QueryFeatureRule</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//是否将要素的可见性计算在内
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">EnableDisplayCondition</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//是否完全包含
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">MustInside</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//是否仅比较要素的外包矩形
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">CompareRectOnly</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//是否相交
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">Intersect</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 实例化查询参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">queryParam</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Service</span>.<span style="color:#a6e22e">QueryParameter</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">geometry</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pointObj</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">resultFormat</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;json&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">struct</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">queryStruct</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">rule</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ip</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">6163</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">queryService</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Service</span>.<span style="color:#a6e22e">QueryDocFeature</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">queryParam</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">docName</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">layerID</span>,
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ip</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">port</span>, <span style="color:#75715e">//访问IGServer的端口号，.net版为6163，Java版为8089
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">onSuccess</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">queryService</span>.<span style="color:#a6e22e">query</span>(<span style="color:#a6e22e">onSuccess</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">queryService</span>.<span style="color:#a6e22e">query</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">querySuccess</span>(<span style="color:#a6e22e">map</span>));
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;参数有误，无法查询&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">querySuccess</span>(<span style="color:#a6e22e">map</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">result</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">format</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Format</span>.<span style="color:#a6e22e">PolygonJSON</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 将MapGIS要素JSON反序列化为ol对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">features</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">format</span>.<span style="color:#a6e22e">read</span>(<span style="color:#a6e22e">result</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//定义数据源来接收查询到的要素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">drawSource</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">Vector</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">wrapX</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//添加到数据源里
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">drawSource</span>.<span style="color:#a6e22e">addFeatures</span>(<span style="color:#a6e22e">features</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">drawLayer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">Vector</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">source</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">drawSource</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">style</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">Style</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//填充色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">Fill</span>({
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;rgba(23, 159, 219, 0.5)&#39;</span>,
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//边线样式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">stroke</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">Stroke</span>({
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;rgba(23, 159, 219, 1)&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">Circle</span>({
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">radius</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">12</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">Fill</span>({
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;rgba(23, 159, 219, 0.5)&#39;</span>,
</span></span><span style="display:flex;"><span>              }),
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>          }),
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">addLayer</span>(<span style="color:#a6e22e">drawLayer</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {}
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {array} position
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {array} attr [{key:&#39;name&#39;,type:&#39;string&#39;,value:&#39;武汉&#39;}]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {object} service {docName,layerID,docLayer,ip(optional),port(optional)}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {object} pointStyle new Zondy.Object.CPointInfo optional
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">add</span>({ <span style="color:#a6e22e">position</span>, <span style="color:#a6e22e">attr</span>, <span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">pointStyle</span> }) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建一个点形状，描述点形状的几何信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gpoint</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">GPoint</span>(...<span style="color:#a6e22e">position</span>); <span style="color:#75715e">//createPoint();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//设置当前点要素的几何信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fGeom</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">FeatureGeometry</span>({ <span style="color:#a6e22e">PntGeom</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">gpoint</span>] });
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//随机输出1~8之间的整数,作为新添加的要素的颜色号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//描述点要素的符号参数信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pointInfo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">POINT_STYLE</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">pointStyle</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">pointInfo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">pointStyle</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置当前点要素的图形参数信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">webGraphicInfo</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">WebGraphicsInfo</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">InfoType</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">PntInfo</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pointInfo</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置添加点要素的属性信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">attValue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建一个要素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">feature</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">Feature</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fGeom</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fGeom</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">GraphicInfo</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">webGraphicInfo</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">AttValue</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">attValue</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置要素为点要素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">feature</span>.<span style="color:#a6e22e">setFType</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建一个要素数据集
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">featureSet</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">FeatureSet</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">featureSet</span>.<span style="color:#a6e22e">clear</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置属性结构
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cAttStruct</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">CAttStruct</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">FldName</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">key</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">FldNumber</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">length</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">FldType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">type</span>),
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">featureSet</span>.<span style="color:#a6e22e">AttStruct</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cAttStruct</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//添加要素到要素数据集
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">featureSet</span>.<span style="color:#a6e22e">addFeature</span>(<span style="color:#a6e22e">feature</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建一个编辑服务类
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">ip</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">ip</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">ip</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">port</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">port</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;6163&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">editService</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Service</span>.<span style="color:#a6e22e">EditDocFeature</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">docName</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">layerID</span>,
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ip</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">port</span>, <span style="color:#75715e">//访问IGServer的端口号，.net版为6163，Java版为8089
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//执行添加点要素功能
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">editService</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">featureSet</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onAddSuccess</span>(<span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">docLayer</span>));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">onAddSuccess</span>(<span style="color:#a6e22e">docLayer</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">data</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">succeed</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;添加点要素成功！&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">docLayer</span>.<span style="color:#a6e22e">refresh</span>();
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;添加点要素失败！&#39;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// let lineColor = Math.floor(Math.random() * 8 + 1);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">LINE_STYLE</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">CLineInfo</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Color</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">LinStyleID</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">LinStyleID2</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">LinWidth</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0.1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Xscale</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Yscale</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Line</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {array} position [[],[],]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {array} attr   [{key:,value:,type:}]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} service {layerID,docName,docLayer[,ip,port,]}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} lineStyle {样式信息可选}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">add</span>({ <span style="color:#a6e22e">position</span>, <span style="color:#a6e22e">attr</span>, <span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">lineStyle</span> }) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pointObj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">position</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">Point2D</span>(...<span style="color:#a6e22e">item</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gArc</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">Arc</span>(<span style="color:#a6e22e">pointObj</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//构成线的折线
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gAnyLine</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">AnyLine</span>([<span style="color:#a6e22e">gArc</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置线要素的几何信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gline</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">GLine</span>(<span style="color:#a6e22e">gAnyLine</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置要素的几何信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fGeom</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">FeatureGeometry</span>({ <span style="color:#a6e22e">LinGeom</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">gline</span>] });
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//随机输出1~8之间的整数,作为新添加的要素的颜色号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">lineInfo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">LINE_STYLE</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">lineStyle</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">lineInfo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">lineStyle</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">graphicInfo</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">WebGraphicsInfo</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">InfoType</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">LinInfo</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">lineInfo</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置添加线要素的属性信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">attValue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建一个线要素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">newFeature</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">Feature</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fGeom</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fGeom</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">GraphicInfo</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">graphicInfo</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">AttValue</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">attValue</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置要素为线要素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">newFeature</span>.<span style="color:#a6e22e">setFType</span>(<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建一个要素数据集
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">featureSet</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">FeatureSet</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fldNumber</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">length</span>; <span style="color:#75715e">//属性个数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fldName</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">key</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fldType</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建属性结构设置对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cAttStruct</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">CAttStruct</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">FldName</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fldName</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">FldNumber</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fldNumber</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">FldType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fldType</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置要素数据集的树形结构
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">featureSet</span>.<span style="color:#a6e22e">AttStruct</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cAttStruct</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//将添加的线要素添加到属性数据集中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">featureSet</span>.<span style="color:#a6e22e">addFeature</span>(<span style="color:#a6e22e">newFeature</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">ip</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">6163</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">editDocFeature</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Service</span>.<span style="color:#a6e22e">EditDocFeature</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">docName</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">layerID</span>,
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ip</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">port</span>, <span style="color:#75715e">//访问IGServer的端口号，.net版为6163，Java版为8089
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">editDocFeature</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">featureSet</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onAddSuccess</span>(<span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">docLayer</span>));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">onAddSuccess</span>(<span style="color:#a6e22e">docLayer</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">rlt</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">rlt</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">result</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;添加线要素成功！&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">docLayer</span>.<span style="color:#a6e22e">refresh</span>();
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;添加线要素失败！&#39;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>面，注意⚪不在其中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">AREA_STYLE</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">CRegionInfo</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">EndColor</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">FillColor</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">FillMode</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">OutPenWidth</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">OverMethod</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">PatAngle</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">PatColor</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">PatHeight</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">PatID</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">27</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">PatWidth</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Area</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {array} position [[],[],]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {array} attr   [{key:,value:,type:}]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} service {layerID,docName,docLayer[,ip,port,]}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} areaStyle {样式信息可选}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">add</span>({ <span style="color:#a6e22e">position</span>, <span style="color:#a6e22e">attr</span>, <span style="color:#a6e22e">service</span>, <span style="color:#a6e22e">areaStyle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">AREA_STYLE</span> }) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pointObj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">position</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">Point2D</span>(...<span style="color:#a6e22e">item</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置区要素的几何信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gArc</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">Arc</span>(<span style="color:#a6e22e">pointObj</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//构成区要素折线
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gAnyLine</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">AnyLine</span>([<span style="color:#a6e22e">gArc</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//构成区要素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gRegion</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">GRegion</span>([<span style="color:#a6e22e">gAnyLine</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//构成区要素的几何信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fGeom</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">FeatureGeometry</span>({ <span style="color:#a6e22e">RegGeom</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">gRegion</span>] });
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//随机输出1~1502之间的整数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fillColor</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#ae81ff">1502</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//设置区要素的图形参数信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cRegionInfo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">areaStyle</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//要素图形参数信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">graphicInfo</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">WebGraphicsInfo</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">InfoType</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">RegInfo</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cRegionInfo</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">attValue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建一个新的区要素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">newFeature</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">Feature</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">AttValue</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">attValue</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fGeom</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fGeom</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">GraphicInfo</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">graphicInfo</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">newFeature</span>.<span style="color:#a6e22e">setFType</span>(<span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//创建一个要素数据集
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">featureSet</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">FeatureSet</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fldNumber</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">length</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fldType</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fldName</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">key</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cAttValue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.Object.<span style="color:#a6e22e">CAttStruct</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">FldNumber</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fldNumber</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">FldType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fldType</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">FldName</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fldName</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">featureSet</span>.<span style="color:#a6e22e">AttStruct</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cAttValue</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">featureSet</span>.<span style="color:#a6e22e">addFeature</span>(<span style="color:#a6e22e">newFeature</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">ip</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">6163</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">editDocFeature</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Service</span>.<span style="color:#a6e22e">EditDocFeature</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">docName</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">layerID</span>,
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ip</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">port</span>, <span style="color:#75715e">//访问IGServer的端口号，.net版为6163，Java版为8089
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#ae81ff">11</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">editDocFeature</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">featureSet</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onAddSuccess</span>(<span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">docLayer</span>));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// addArea()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">onAddSuccess</span>(<span style="color:#a6e22e">docLayer</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">data</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">succeed</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;添加区要素成功！&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">docLayer</span>.<span style="color:#a6e22e">refresh</span>();
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;添加区要素失败！&#39;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="实现标注--本质上是画点">实现标注  本质上是画点</h3>
<ol>
<li>ol.style.Style  创建标注样式</li>
<li>创建点要素  new ol.Feature</li>
<li>创建点数据源</li>
<li>创建点图层</li>
<li>添加图层至map</li>
<li>给数据源里添加点</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Document&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./dist/include-openlayers-local.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./config/map/gao.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./config/css/map.css&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;map&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">map</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">Map</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">target</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;map&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">layers</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">gaodeMapLayer</span>, <span style="color:#a6e22e">gaodeImage</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">view</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">View</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">projection</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;EPSG:4326&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">center</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">114.30</span>, <span style="color:#ae81ff">30.50</span>],
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">zoom</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">createLabelStyle</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">feature</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">Style</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">image</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">Icon</span>(
</span></span><span style="display:flex;"><span>            ({
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">anchor</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">60</span>],
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">anchorOrigin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;top-right&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">anchorXUnits</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;fraction&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">anchorYUnits</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;pixels&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">offsetOrigin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;top-right&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#75715e">// offset:[0,10],
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#75715e">//图标缩放比例
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#75715e">// scale:0.5,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#75715e">//透明度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#a6e22e">opacity</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0.75</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#75715e">//图标的url
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#a6e22e">src</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;./img/blueIcon.png&#39;</span>
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>          ),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">Text</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">textAlign</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;center&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//基准线
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">textBaseline</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;middle&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//文字样式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">font</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;normal 14px 微软雅黑&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//文本内容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">feature</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;name&#39;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//文本填充样式（即文字颜色）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">fill</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">Fill</span>({ <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#aa3300&#39;</span> }),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">stroke</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">Stroke</span>({ <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#ffcc33&#39;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span> })
</span></span><span style="display:flex;"><span>          })
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">iconFeature</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">Feature</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">geometry</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">geom</span>.<span style="color:#a6e22e">Point</span>([<span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">30</span>]),
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//名称属性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;北京市&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//大概人口数（万）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">population</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2115</span>
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">iconFeature</span>.<span style="color:#a6e22e">setStyle</span>(<span style="color:#a6e22e">createLabelStyle</span>(<span style="color:#a6e22e">iconFeature</span>));
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//矢量标注的数据源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">vectorSource</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">Vector</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">features</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">iconFeature</span>]
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//矢量标注图层
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">vectorLayer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">Vector</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">source</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">vectorSource</span>
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">addLayer</span>(<span style="color:#a6e22e">vectorLayer</span>);
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//为地图容器添加单击事件监听
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Addmarker</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;click&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">evt</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//鼠标单击点坐标
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">point</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>.<span style="color:#a6e22e">coordinate</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">label</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">prompt</span>(<span style="color:#e6db74">&#39;请输入标注&#39;</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//添加一个新的标注（矢量要素）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">addVectorLabel</span>(<span style="color:#a6e22e">point</span>, <span style="color:#a6e22e">label</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Addmarker</span>()
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">      * 添加一个新的标注（矢量要素）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">      * @param {ol.Coordinate} coordinate 坐标点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">      */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addVectorLabel</span>(<span style="color:#a6e22e">coordinate</span>, <span style="color:#a6e22e">label</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//新建一个要素 ol.Feature
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">newFeature</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">Feature</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//几何信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">geometry</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ol</span>.<span style="color:#a6e22e">geom</span>.<span style="color:#a6e22e">Point</span>(<span style="color:#a6e22e">coordinate</span>),
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//名称属性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">label</span>
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//设置要素的样式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">newFeature</span>.<span style="color:#a6e22e">setStyle</span>(<span style="color:#a6e22e">createLabelStyle</span>(<span style="color:#a6e22e">newFeature</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//将新要素添加到数据源中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">vectorSource</span>.<span style="color:#a6e22e">addFeature</span>(<span style="color:#a6e22e">newFeature</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="地图屏幕坐标互转">地图屏幕坐标互转</h3>
<p><code>getPixelFromCoordinate</code> 地图坐标转屏幕<!-- raw HTML omitted --><code>getCoordinateFromPixel</code> 屏幕转地图
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="实现弹框">实现弹框</h3>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="删除服务">删除服务</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {array} fids
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {number} layerID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {function} onSuccess
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deleteFeature</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">docName</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fids</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">layerID</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">docLayer</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ip</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;localhost&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">6163</span>,
</span></span><span style="display:flex;"><span>}) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//获取当前选择的要素编号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">deleteService</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zondy</span>.<span style="color:#a6e22e">Service</span>.<span style="color:#a6e22e">EditDocFeature</span>(<span style="color:#a6e22e">docName</span>, <span style="color:#a6e22e">layerID</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ip</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">port</span>, <span style="color:#75715e">//访问IGServer的端口号，.net版为6163，Java版为8089
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">deleteService</span>.<span style="color:#a6e22e">deletes</span>(<span style="color:#a6e22e">fids</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;,&#39;</span>), <span style="color:#a6e22e">onSuccess</span>(<span style="color:#a6e22e">docLayer</span>));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// deleteLine()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//删除线要素回调函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onSuccess</span>(<span style="color:#a6e22e">docLayer</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">data</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">succeed</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">`删除要素成功！`</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">docLayer</span>.<span style="color:#a6e22e">refresh</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// docLayer.refresh();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;删除要素失败！&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="更新">更新</h3>
<p>service.update()</p>

          </div>
        </div>
                 
      
  
  
  
  

  

  <div class="article-paging">
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" background-image-lazy data-img="https://cdn.nlark.com/yuque/0/2022/gif/327963/1645669614806-3180680a-1ac4-4160-886b-c0af63971f96.gif"></div>
  <div class="card-text">
    <a href="/docs/qatz4f/"><h4 class="card-text--title text-ellipsis">Vue3</h4></a>
    <p class="card-text--row">2022-07-20 08:41</p>
  </div>
</section>
    
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" background-image-lazy data-img="https://cdn.nlark.com/yuque/0/2022/png/29064333/1658279795799-be23abaa-7bb5-41e9-b9dd-7b4c272481bf.png"></div>
  <div class="card-text">
    <a href="/docs/patw5f/"><h4 class="card-text--title text-ellipsis">MapGIS</h4></a>
    <p class="card-text--row">2022-07-20 01:13</p>
  </div>
</section>
    
  </div>
</div>
  <aside class="widget-info">
    
<section class="aside-widget widget-author content-padding-large soft-size--large soft-style--box">
  <div class="widget-body">
    <div class="author-box avatar">
      
      <img class="author-avatar soft-size--round soft-style--box" src="https://cdn.jsdelivr.net/gh/Sentisfate/wanhuatong@main/img/cdai.jfif" alt="gisculibur">
      
      <h2 class="author-name text-ellipsis">gisculibur</h2>
      
      <p class="author-desc text-ellipsis">新手WebGIS攻城狮</p>
      
    </div>
  </div>
</section>


    

<section class="aside-widget widget-toc content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>目录</span>
    </div>
  </h2>
  <div class="widget-body">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#一openlayer如何加载ig-server的地图文档">一、openlayer如何加载ig server的地图文档</a></li>
        <li><a href="#二vue3集成openlayer">二、vue3集成openlayer</a></li>
        <li><a href="#三react集成openlayer">三、React集成openlayer</a></li>
        <li><a href="#四常用api">四、常用api</a>
          <ul>
            <li><a href="#1操作图层">1.操作图层</a></li>
            <li><a href="#2事件的绑定和移除">2.事件的绑定和移除</a></li>
            <li><a href="#3控件">3.控件</a></li>
          </ul>
        </li>
        <li><a href="#五绘图原理">五、绘图原理</a>
          <ul>
            <li><a href="#1绘制点">1.绘制点</a></li>
            <li><a href="#2交互式的绘制">2.交互式的绘制</a>
              <ul>
                <li><a href="#基本概念">基本概念</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#点线面的封装">点线面的封装</a>
          <ul>
            <li><a href="#实现标注--本质上是画点">实现标注  本质上是画点</a></li>
            <li><a href="#地图屏幕坐标互转">地图屏幕坐标互转</a></li>
            <li><a href="#实现弹框">实现弹框</a></li>
            <li><a href="#删除服务">删除服务</a></li>
            <li><a href="#更新">更新</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</section>


    










<section class="aside-widget widget-articles content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>相关文章</span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="post-list">
      
      
        <li class="post-item"><a href="/docs/ix726493ddpi6i3q/">3dTiles</a></li>
      
        <li class="post-item"><a href="/posts/qa4vydlw37pbsi3v/">WebGL 图像处理</a></li>
      
        <li class="post-item"><a href="/docs/goz05uyu3i5v92c9/">Cesium 模型压平</a></li>
      
        <li class="post-item"><a href="/docs/cl6l0mww8kkkizwb/">三角剖分</a></li>
      
        <li class="post-item"><a href="/docs/prgrgit7lss8vggf/">GIS理论基础</a></li>
      
        <li class="post-item"><a href="/docs/vzxnspucb4agb00w/">问题</a></li>
      
    </ul>
  </div>
</section>


    




<section class="aside-widget widget-categories content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>分类</span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="categories-list">
      
        <li>
          <a href="https://Sentisfate.github.io/categories/webgl/">WebGL</a>
          <span>1</span>
        </li>
      
        <li>
          <a href="https://Sentisfate.github.io/categories/%E5%9B%BE%E5%BA%8A/">图床</a>
          <span>1</span>
        </li>
      
    </ul>
  </div>

  
</section>


    




<section class="aside-widget widget-tags content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>标签</span>
    </div>
  </h2>
  <div class="widget-body">
    <div class="tags-list">
      
        <a href="https://Sentisfate.github.io/tags/github/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">github</a>
      
        <a href="https://Sentisfate.github.io/tags/picgo/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">picgo</a>
      
        <a href="https://Sentisfate.github.io/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">图像处理</a>
      
    </div>
  </div>

  
</section>

  </aside>
</div>
  </main><footer class="footer-container layout-block">
  
  <div class="social-icons">
    
      <a class="soft-size--primary soft-style--box" href="https://github.com/Sentisfate" target="_blank" rel="noopener noreferrer">
          
        <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
        </svg>
        

        

        

        

        
      </a>
    
  </div>
  

  <div class="colour-bar"></div>
  
  

  

  <p>
    Powered by
    <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a>
    Theme - 
    <a href="https://github.com/miiiku/hugo-theme-kagome" target="_blank" rel="noopener noreferrer author">kagome</a>
  </p>

  <p>
    <a href="javascript:;" id="theme-light">🌞 浅色</a>
    <a href="javascript:;" id="theme-dark">🌛 深色</a>
    <a href="javascript:;" id="theme-auto">🤖️ 自动</a>
  </p>
</footer>



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>






</body>

</html>