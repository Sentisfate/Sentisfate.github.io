<!DOCTYPE html>
<html><head>
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer" />
   
  <meta name="author" content="gisculibur">
  

   
  
  
  
  
  
  
  <meta name="keywords"
    content="theme,kagome">
  

  

  <meta name="generator" content="Hugo 0.115.2">


  
  
  
  
  <title>图像处理 🌟 GIS咖喱棒</title>

  <meta property="og:title" content="图像处理" />
<meta property="og:description" content="webgl通过纹理来操作图像。 渲染图像流程 编写着色器 attribute vec2 a_position; // 接收纹理坐标 attribute vec2 a_texCoord; // 传递顶点纹理坐标，用于插值; varying vec2 v_texCoord; uniform mat3 u_m; void main() { vec3 position=vec3(a_position.x,a_position.y,1.0); vec3 result=u_m*position; gl_Position = vec4(result.x,result.y,0,1);" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Sentisfate.github.io/docs/nkcflytt029fsnh0/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2023-07-06T03:04:33+00:00" />
<meta property="article:modified_time" content="2023-07-17T02:46:39+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="图像处理"/>
<meta name="twitter:description" content="webgl通过纹理来操作图像。 渲染图像流程 编写着色器 attribute vec2 a_position; // 接收纹理坐标 attribute vec2 a_texCoord; // 传递顶点纹理坐标，用于插值; varying vec2 v_texCoord; uniform mat3 u_m; void main() { vec3 position=vec3(a_position.x,a_position.y,1.0); vec3 result=u_m*position; gl_Position = vec4(result.x,result.y,0,1);"/>


  
  
  
  
  <link rel="stylesheet" href="https://Sentisfate.github.io/assets/css/style.min.a9eba8a87a1f5444669cfe92317af83504187100f2529f484b2eeaff89777b86.css" integrity="sha256-qeuoqHofVERmnP6SMXr4NQQYcQDyUp9ISy7q/4l3e4Y=">

  <script src="https://Sentisfate.github.io/assets/js/main.min.182da266209851bc7c828aa7377f98f914e1e76c8decdd53a6cbe9bffea92cde.js" integrity="sha256-GC2iZiCYUbx8goqnN3&#43;Y&#43;RTh52yN7N1Tpsvpv/6pLN4="></script>

  </head><body><header class="header-container layout-block layout-padding">
  <div class="header-inner content-padding-large soft-size--large soft-style--box">
    <div class="header-logo">
      <a href="https://Sentisfate.github.io"><h1>GIS咖喱棒</h1></a>
    </div>
    <nav class="header-nav">
      <div class="header-nav--btn">
        <div class="btn-item"></div>
        <div class="btn-item"></div>
        <div class="btn-item"></div>
      </div>
      <div class="header-nav--list">
        <div>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/" title="GIS咖喱棒">主页</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/docs/" title="Docs">笔记</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/categories/" title="Categories">分类</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/tags/" title="Tags">标签</a>
          
        </div>
      </div>
    </nav>
  </div>
</header><main id="content">
    

    <div class="single-container layout-block">
      <div class="article-info">
        <div class="article-header layout-padding">
          <div class="article-cover card-container content-padding-large soft-size--large soft-style--box img">

  <div class="card-cover">
    
      <img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689056030651-91f36600-90e2-4980-bde4-ebe65963d632.png" alt="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689056030651-91f36600-90e2-4980-bde4-ebe65963d632.png" />
    
  </div>

  <div class="card-text">
    <h1 class="card-text--title">图像处理</h1>
    
      <p class="card-text--row">2023-07-06 03:04</p>
      
      
      

      
      
    
  </div>

</div>
        </div>

        <div class="article-content">
          <div class="markdown-body content-padding-large soft-size--large soft-style--box">
            <p>webgl通过纹理来操作图像。
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="渲染图像流程">渲染图像流程</h1>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="编写着色器">编写着色器</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">attribute</span> <span style="color:#66d9ef">vec2</span> a_position;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 接收纹理坐标</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">attribute</span> <span style="color:#66d9ef">vec2</span> a_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 传递顶点纹理坐标，用于插值;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">varying</span> <span style="color:#66d9ef">vec2</span> v_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> mat3 u_m;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec3</span> position<span style="color:#f92672">=</span><span style="color:#66d9ef">vec3</span>(a_position.x,a_position.y,<span style="color:#ae81ff">1.0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec3</span> result<span style="color:#f92672">=</span>u_m<span style="color:#f92672">*</span>position;
</span></span><span style="display:flex;"><span>  gl_Position <span style="color:#f92672">=</span> <span style="color:#66d9ef">vec4</span>(result.x,result.y,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  v_texCoord<span style="color:#f92672">=</span>a_texCoord;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">precision</span> <span style="color:#66d9ef">mediump</span> <span style="color:#66d9ef">float</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 定义一个纹理采样器</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">sampler2D</span> u_image;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">varying</span> <span style="color:#66d9ef">vec2</span> v_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main(){
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 从纹理上寻找对应坐标的颜色值</span>
</span></span><span style="display:flex;"><span>  gl_FragColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="设定数据源">设定数据源</h2>
<p>这里用图像作为数据源，使用<code>Image</code>来获取图像</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;../../../public/img/wenli.jpg&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//渲染图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">image</span>);
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="渲染图像">渲染图像</h2>
<p>这里跳过创建着色器程序等操作，直接从属性与全局变量的设置开始，先是配置顶点坐标属性，用两个三角形填充满整个画布（我的画布大小是250X250）。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// 顶点坐标属性相关配置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionAttributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">program</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;a_position&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">positionAttributeLocation</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">positionBuffer</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">positionAttributeLocation</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>接着是初始化纹理坐标属性，需要注意，纹理空间范围是0-1，此外纹理坐标要和顶点坐标对应，否则可能会出现反转，镜像等。<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689056030651-91f36600-90e2-4980-bde4-ebe65963d632.png#averageHue=%23f9f9f9&amp;clientId=u532e7da7-085c-4&amp;from=paste&amp;height=367&amp;id=ud68b7d42&amp;originHeight=367&amp;originWidth=363&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12797&amp;status=done&amp;style=none&amp;taskId=u49fa5bb1-334c-4c5b-9965-c321f63a4f2&amp;title=&amp;width=363" alt="image.png" loading="lazy" /></p>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">texLocation</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 初始化纹理坐标,并配置顶点属性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texCoordBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">texCoordBuffer</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 纹理坐标范围是0-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([...<span style="color:#a6e22e">one</span>,...<span style="color:#a6e22e">three</span>,...<span style="color:#a6e22e">four</span>,...<span style="color:#a6e22e">one</span>,...<span style="color:#a6e22e">three</span>,...<span style="color:#a6e22e">two</span>]),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">texLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span></code></pre></div><p>初始化纹理数据这是一种默认使用纹理单元0的写法，</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// 创建纹理对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 默认当前活动的纹理单元是gl.TEXTURE0,因此这里是绑定了纹理单元0和纹理对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//指定纹理的详细级别，0是基本图像，n是第n个金字塔简化级
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//指定纹理中的颜色组件，这里是RGBA，每个像素有四个字节，每个字节表示其中一个颜色通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//填充纹理 gl.TEXTURE_2D 表示是二维纹理贴图
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">image</span> <span style="color:#75715e">//图像可以作为纹理的像素源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 设置参数，以便绘制任何尺寸的图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 设置纹理在S(水平)方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 设置纹理在T垂直方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 设置纹理缩小和放大的滤波器,都是用gl.NEAREST,即,当纹理需要缩小或放大时,使用接近纹理坐标的像素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span></code></pre></div><p>如果需要另指定纹理单元需要显示的去激活该纹理单元。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">unit</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e">//挑选一个纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 激活纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">activeTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE0</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 将该纹理单元与纹理对象绑定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//指定纹理的详细级别，0是基本图像，n是第n个金字塔简化级
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//指定纹理中的颜色组件，这里是RGBA，每个像素有四个字节，每个字节表示其中一个颜色通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//填充纹理 gl.TEXTURE_2D 二维纹理贴图
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">image</span> <span style="color:#75715e">//图像可以作为纹理的像素源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 设置参数，让我们可以绘制任何尺寸的图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 设置纹理在S(水平)方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 设置纹理在T垂直方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 设置纹理缩小和放大的滤波器,都是用gl.NEAREST,即,当纹理需要缩小或放大时,使用接近纹理坐标的像素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 设置纹理采样器所使用的纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_image&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 将纹理采样器与纹理单元相绑定,不绑定默认与纹理单元0绑定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1i</span>(<span style="color:#a6e22e">imgLocation</span>, <span style="color:#a6e22e">unit</span>);
</span></span></code></pre></div><p>然后就是进行绘制操作，完整代码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Document&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      #glcanvas {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">black</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;glcanvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      你的浏览器似乎不支持或者禁用了 HTML5 &lt;<span style="color:#f92672">code</span>&gt;&amp;lt;canvas&amp;gt;&lt;/<span style="color:#f92672">code</span>&gt; 元素。
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">canvas</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;glcanvas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 确认 WebGL 支持性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;无法初始化 WebGL，你的浏览器、操作系统或硬件等可能不支持 WebGL。&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;不支持gl&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 创建着色器的方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">shaderSource</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">source</span>); <span style="color:#75715e">//为着色器对象提供数据源，即我们写的着色器代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">compileShader</span>(<span style="color:#a6e22e">shader</span>); <span style="color:#75715e">//编译着色器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getShaderParameter</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COMPILE_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 成功编译后返回着色器对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shader</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 计算变换矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#f92672">-</span><span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">y</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>        ];
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createProgram</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">vertexShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">linkProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getProgramParameter</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">LINK_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">deleteProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 接收纹理坐标
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 传递顶点纹理坐标，用于插值;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform mat3 u_m;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec3 position=vec3(a_position.x,a_position.y,1.0);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec3 result=u_m*position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = vec4(result.x,result.y,0,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_texCoord=a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      precision mediump float;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义一个纹理采样器
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform sampler2D u_image;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // 从纹理上寻找对应坐标的颜色值
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_FragColor=texture2D(u_image,v_texCoord).rgba;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;../../../public/img/apple.jpg&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// canvas.width = image.width;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// canvas.height = image.height;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">image</span>);
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">image</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 创建着色器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vertexShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">VERTEX_SHADER</span>, <span style="color:#a6e22e">vsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fragmentShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAGMENT_SHADER</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 将着色器链接到一个program着色程序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">useProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 顶点坐标属性相关配置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionAttributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">program</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;a_position&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">positionAttributeLocation</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">positionBuffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">positionAttributeLocation</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 纹理坐标相关配置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">texLocation</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化纹理坐标,并配置顶点属性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texCoordBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">texCoordBuffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 纹理坐标范围是0-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">four</span>,
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">two</span>,
</span></span><span style="display:flex;"><span>          ]),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">texLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 创建纹理对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 默认当前活动的纹理单元是gl.TEXTURE0,因此这里是绑定了纹理单元0和纹理对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//指定纹理的详细级别，0是基本图像，n是第n个金字塔简化级
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//指定纹理中的颜色组件，这里是RGBA，每个像素有四个字节，每个字节表示其中一个颜色通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//填充纹理 gl.TEXTURE_2D 二维纹理贴图
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">image</span> <span style="color:#75715e">//图像可以作为纹理的像素源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 设置参数，让我们可以绘制任何尺寸的图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 设置纹理在S(水平)方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 设置纹理在T垂直方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 设置纹理缩小和放大的滤波器,都是用gl.NEAREST,即,当纹理需要缩小或放大时,使用接近纹理坐标的像素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//  将纹理采样器绑定一个纹理单元 没有绑定纹理单元,默认是gl.TEXTURE0这个单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">bindTextureUnit</span>() {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">unit</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e">//挑选一个纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#75715e">// 激活纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">activeTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE0</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 将该纹理单元与纹理对象绑定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//指定纹理的详细级别，0是基本图像，n是第n个金字塔简化级
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//指定纹理中的颜色组件，这里是RGBA，每个像素有四个字节，每个字节表示其中一个颜色通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//填充纹理 gl.TEXTURE_2D 二维纹理贴图
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span> <span style="color:#75715e">//图像可以作为纹理的像素源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          );
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 设置参数，让我们可以绘制任何尺寸的图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#75715e">// 设置纹理在S(水平)方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 设置纹理在T垂直方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 设置纹理缩小和放大的滤波器,都是用gl.NEAREST,即,当纹理需要缩小或放大时,使用接近纹理坐标的像素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// // 设置纹理采样器所使用的纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_image&#34;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 将纹理采样器与纹理单元相绑定,不绑定默认与纹理单元0绑定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1i</span>(<span style="color:#a6e22e">imgLocation</span>, <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// bindTextureUnit();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 全局变量相关配置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_m</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_m&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">bottom</span>, <span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">left</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getBoundingClientRect</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 计算 canvas的中心点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">center</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">left</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">right</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">bottom</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniformMatrix3fv</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">u_m</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>, <span style="color:#a6e22e">center</span>.<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">center</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>          )
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">viewport</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clearColor</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>); <span style="color:#75715e">//设置清空颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_BUFFER_BIT</span>); <span style="color:#75715e">//清空画布
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">drawArrays</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689068167852-e7d309af-92b1-4b9e-8800-476209773c8e.png#averageHue=%23f9fdfc&amp;clientId=u710d0586-5b16-4&amp;from=paste&amp;height=232&amp;id=uc7cf5582&amp;originHeight=232&amp;originWidth=266&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=47856&amp;status=done&amp;style=none&amp;taskId=u3fc5782a-afe1-48c6-956e-bf00deab074&amp;title=&amp;width=266" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->发现了一个问题，图像上下颠倒了。明明是按照顶点坐标和纹理坐标一一对应，但仍然出现了颠倒问题。后面发现webgl在渲染纹理时，使用的仍然是图片坐标系。</p>
<blockquote>
<p>纹理坐标系是理想状态，实际渲染纹理时 webgl 使用的图片坐标系。因此在向缓冲区对象中传递几何图形的点位和纹理图像的点位时，应该使用图片坐标系作为参考。</p>
</blockquote>
<p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689068414088-a1abab0a-86c1-4ae0-8f7a-7bc17a1d4333.png#averageHue=%23fbfbfb&amp;clientId=u710d0586-5b16-4&amp;from=paste&amp;height=365&amp;id=u58450721&amp;originHeight=365&amp;originWidth=359&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=44420&amp;status=done&amp;style=none&amp;taskId=u85ac45e6-3ef6-4271-a093-2a2575e6d71&amp;title=&amp;width=359" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->也就是将纹理坐标进行稍微改动一下即可</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689068683539-3f013e4e-fe91-41b7-a985-2f0a34b10b4b.png#averageHue=%23f9fdfc&amp;clientId=u710d0586-5b16-4&amp;from=paste&amp;height=235&amp;id=u69b1cb33&amp;originHeight=235&amp;originWidth=269&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=47745&amp;status=done&amp;style=none&amp;taskId=ue363cfef-fc50-4beb-9896-98495c3fee9&amp;title=&amp;width=269" alt="image.png" loading="lazy" /></p>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#f92672">&lt;!</span><span style="color:#a6e22e">DOCTYPE</span> <span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">head</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">title</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Document</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/title&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">style</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">margin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">padding</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">glcanvas</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">border</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span><span style="color:#a6e22e">px</span> <span style="color:#a6e22e">solid</span> <span style="color:#a6e22e">black</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/style&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/head&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">body</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;glcanvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">你的浏览器似乎不支持或者禁用了</span> <span style="color:#a6e22e">HTML5</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">code</span><span style="color:#f92672">&gt;&amp;</span><span style="color:#a6e22e">lt</span>;<span style="color:#a6e22e">canvas</span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gt</span>;<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/code&gt; 元素。</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/canvas&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;glcanvas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 确认 WebGL 支持性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">alert</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;无法初始化 WebGL，你的浏览器、操作系统或硬件等可能不支持 WebGL。&#34;</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;不支持gl&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 创建着色器的方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">shaderSource</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">source</span>); <span style="color:#75715e">//为着色器对象提供数据源，即我们写的着色器代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">compileShader</span>(<span style="color:#a6e22e">shader</span>); <span style="color:#75715e">//编译着色器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getShaderParameter</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COMPILE_STATUS</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 成功编译后返回着色器对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shader</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 计算变换矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">-</span><span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>    (<span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">y</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createProgram</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">vertexShader</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">linkProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getProgramParameter</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">LINK_STATUS</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">deleteProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 接收纹理坐标
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 传递顶点纹理坐标，用于插值;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform mat3 u_m;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec3 position=vec3(a_position.x,a_position.y,1.0);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec3 result=u_m*position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = vec4(result.x,result.y,0,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_texCoord=a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      precision mediump float;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义一个纹理采样器
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform sampler2D u_image;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // 从纹理上寻找对应坐标的颜色值
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_FragColor=texture2D(u_image,v_texCoord).rgba;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;../../../public/img/apple.jpg&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// canvas.width = image.width;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// canvas.height = image.height;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">image</span>);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">image</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 创建着色器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vertexShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">VERTEX_SHADER</span>, <span style="color:#a6e22e">vsSource</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fragmentShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAGMENT_SHADER</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 将着色器链接到一个program着色程序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">useProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 顶点坐标属性相关配置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionAttributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">program</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;a_position&#34;</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">positionAttributeLocation</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">positionBuffer</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">positionAttributeLocation</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 纹理坐标相关配置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">texLocation</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 初始化纹理坐标,并配置顶点属性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texCoordBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">texCoordBuffer</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 纹理坐标范围是0-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">four</span>,
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">two</span>,
</span></span><span style="display:flex;"><span>    ]),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">texLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 创建纹理对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 默认当前活动的纹理单元是gl.TEXTURE0,因此这里是绑定了纹理单元0和纹理对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//指定纹理的详细级别，0是基本图像，n是第n个金字塔简化级
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//指定纹理中的颜色组件，这里是RGBA，每个像素有四个字节，每个字节表示其中一个颜色通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//填充纹理 gl.TEXTURE_2D 二维纹理贴图
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">image</span> <span style="color:#75715e">//图像可以作为纹理的像素源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 设置参数，让我们可以绘制任何尺寸的图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// 设置纹理在S(水平)方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 设置纹理在T垂直方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 设置纹理缩小和放大的滤波器,都是用gl.NEAREST,即,当纹理需要缩小或放大时,使用接近纹理坐标的像素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//  将纹理采样器绑定一个纹理单元 没有绑定纹理单元,默认是gl.TEXTURE0这个单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">bindTextureUnit</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">unit</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e">//挑选一个纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 激活纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">activeTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE0</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 将该纹理单元与纹理对象绑定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//指定纹理的详细级别，0是基本图像，n是第n个金字塔简化级
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//指定纹理中的颜色组件，这里是RGBA，每个像素有四个字节，每个字节表示其中一个颜色通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//填充纹理 gl.TEXTURE_2D 二维纹理贴图
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">image</span> <span style="color:#75715e">//图像可以作为纹理的像素源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 设置参数，让我们可以绘制任何尺寸的图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 设置纹理在S(水平)方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 设置纹理在T垂直方向上的环绕模式,纹理坐标超出范围[0,1]时,夹在纹理的边缘处
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 设置纹理缩小和放大的滤波器,都是用gl.NEAREST,即,当纹理需要缩小或放大时,使用接近纹理坐标的像素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// // 设置纹理采样器所使用的纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_image&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 将纹理采样器与纹理单元相绑定,不绑定默认与纹理单元0绑定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1i</span>(<span style="color:#a6e22e">imgLocation</span>, <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// bindTextureUnit();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// 全局变量相关配置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_m</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_m&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">bottom</span>, <span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">left</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getBoundingClientRect</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 计算 canvas的中心点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">center</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">left</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">right</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">bottom</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniformMatrix3fv</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">u_m</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>, <span style="color:#a6e22e">center</span>.<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">center</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">viewport</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clearColor</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>); <span style="color:#75715e">//设置清空颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_BUFFER_BIT</span>); <span style="color:#75715e">//清空画布
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">drawArrays</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/body&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/html&gt;</span>
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="简单图像操作">简单图像操作</h2>
<p>可以通过修改片段着色器，来做一些简单的操作，如改变颜色分量通道。得到一个漂亮的蓝苹果。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span>gl_FragColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord).bgra;<span style="color:#75715e">//将红蓝对调</span>
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689068795297-d8fd7b37-017a-4285-806f-4299f56e00f6.png#averageHue=%23fafdfa&amp;clientId=u710d0586-5b16-4&amp;from=paste&amp;height=259&amp;id=u0db2913b&amp;originHeight=259&amp;originWidth=250&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=48352&amp;status=done&amp;style=none&amp;taskId=u8d1d4998-71d8-43de-83e7-dc527223586&amp;title=&amp;width=250" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->如果要更细节的去操作图像，需要至少能获取到任意像素在纹理空间中的坐标。<code>1/image.width``1/image.height</code>就是图片1个像素在裁剪空间的坐标长度。<!-- raw HTML omitted -->操作每一个像素则可以通过下面这种形式</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">vec2</span> texCoord<span style="color:#f92672">=</span>v_texCoord<span style="color:#f92672">+</span><span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>image.width<span style="color:#f92672">*</span>m,<span style="color:#ae81ff">1.</span>image.height<span style="color:#f92672">*</span>n)
</span></span></code></pre></div><p>下面写一个简单的均值滤波十字形窗口来进行图像模糊，将图像的每个像素，用其上下左右相邻的像素的均值替代。简单修改下片段着色器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">precision</span> <span style="color:#66d9ef">mediump</span> <span style="color:#66d9ef">float</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 定义一个纹理采样器</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">sampler2D</span> u_image;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 一个图像像素对应的裁剪空间坐标,而不是canvas的宽高,因为可能存在缩放的情况</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">vec2</span> u_onePixel;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">varying</span> <span style="color:#66d9ef">vec2</span> v_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main(){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> leftColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord<span style="color:#f92672">-</span><span style="color:#66d9ef">vec2</span>(u_onePixel.x,<span style="color:#ae81ff">0.0</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> rightColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord<span style="color:#f92672">+</span><span style="color:#66d9ef">vec2</span>(u_onePixel.x,<span style="color:#ae81ff">0.0</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> topColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord<span style="color:#f92672">-</span><span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">0.0</span>,u_onePixel.y));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> bottomColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord<span style="color:#f92672">+</span><span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">0.0</span>,u_onePixel.y));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> centerColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 进行了模糊操作</span>
</span></span><span style="display:flex;"><span>  gl_FragColor<span style="color:#f92672">=</span>(leftColor<span style="color:#f92672">+</span>rightColor<span style="color:#f92672">+</span>topColor<span style="color:#f92672">+</span>bottomColor<span style="color:#f92672">+</span>centerColor)<span style="color:#f92672">/</span><span style="color:#ae81ff">5.0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// gl_FragColor=centerColor; //没有进行模糊操作</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>设置onePixel全局变量</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_OnePixel</span><span style="color:#f92672">=</span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>,<span style="color:#e6db74">&#39;u_onePixel&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform2f</span>(<span style="color:#a6e22e">u_OnePixel</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>)
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689124550290-7158cf06-faae-4604-84b7-98ea06c916d3.png#averageHue=%23fafcfd&amp;clientId=u688450fe-eea9-4&amp;from=paste&amp;height=213&amp;id=u59adcc1a&amp;originHeight=213&amp;originWidth=236&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=40761&amp;status=done&amp;style=none&amp;taskId=ua1f6aec4-7a24-4646-b6e5-a837f03c4cc&amp;title=&amp;width=236" alt="image.png" loading="lazy" /></p>

  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689124567407-7b954666-66f5-49b6-ad24-caccb1eeab92.png#averageHue=%23fafdfe&amp;clientId=u688450fe-eea9-4&amp;from=paste&amp;height=217&amp;id=uf526a48c&amp;originHeight=217&amp;originWidth=228&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46669&amp;status=done&amp;style=none&amp;taskId=ub29b04ca-a972-4c7f-a44f-12d5841f20d&amp;title=&amp;width=228" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->能清晰看到图片的变化。</p>
<blockquote>
<p>这里有个细节,十字窗口在超出图像边界范围时，上下左右像素是如何取的？根据前面设置的<code>texParameteri</code>，超出时用边界像素替代，如下图（由于苹果周围都是空白，效果不明显，因此换了个纹理图）</p>
</blockquote>
<p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689125450745-232f8362-389e-44b1-b163-b8f053df4415.png#averageHue=%23a97345&amp;clientId=u688450fe-eea9-4&amp;from=paste&amp;height=257&amp;id=ue4ac0974&amp;originHeight=257&amp;originWidth=260&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=24044&amp;status=done&amp;style=none&amp;taskId=ue3a3b52e-6215-413b-a2c1-16855cb309a&amp;title=&amp;width=260" alt="image.png" loading="lazy" /></p>

<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="图像处理">图像处理</h1>
<blockquote>
<p>学的遥感数字图像处理总算派上用场了，虽然已经忘得差不多了。。。</p>
</blockquote>
<p>不同的图像处理方法往往对应着不同的用途，如模糊图像，增强图像，去除噪声，增强噪声等。</p>
<blockquote>
<p>滤波和卷积核是图像平滑中的两个重要概念。滤波是指将一个卷积核应用于图像的每个像素，通过计算卷积核与图像局部区域的加权和来得到新的像素值。卷积核是一个小的矩阵，其中的元素表示了在计算加权和时每个像素的权重。
滤波和卷积核的区别在于它们的概念和应用方式。滤波是一种图像处理技术，用于平滑图像或提取图像特征。而卷积核是滤波过程中的一种数学工具，用于计算每个像素的新值。滤波可以使用不同类型的卷积核来实现不同的平滑效果，例如均值滤波、高斯滤波等。</p>
</blockquote>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="图像滤波器">图像滤波器</h2>
<p>简单写了一个用3X3卷积核对原始图像处理的demo。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Document&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      #glcanvas {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">black</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;glcanvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      你的浏览器似乎不支持或者禁用了 HTML5 &lt;<span style="color:#f92672">code</span>&gt;&amp;lt;canvas&amp;gt;&lt;/<span style="color:#f92672">code</span>&gt; 元素。
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">canvas</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upload&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span>&gt;3x3卷积核：&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>      /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">br</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>      /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">br</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>      /&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deal-image-btn&#34;</span>&gt;图像处理&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 创建着色器的方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">shaderSource</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">source</span>); <span style="color:#75715e">//为着色器对象提供数据源，即我们写的着色器代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">compileShader</span>(<span style="color:#a6e22e">shader</span>); <span style="color:#75715e">//编译着色器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getShaderParameter</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COMPILE_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 成功编译后返回着色器对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shader</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 计算变换矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#f92672">-</span><span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">y</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>        ];
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createProgram</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">vertexShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">linkProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getProgramParameter</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">LINK_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">deleteProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      precision mediump float;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义一个纹理采样器
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform sampler2D u_image;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 一个图像像素对应的裁剪空间坐标长度
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform vec2 u_onePixel;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义一个3*3卷积核
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernel[9];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义权重之和，便于归一化处理
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernelWeight;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topLeft=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 top=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topRight=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 left=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 center=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 right=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 leftBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 bottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 rightBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 colorSum=topLeft*u_kernel[0]+top*u_kernel[1]+topRight*u_kernel[2]+left*u_kernel[3]+center*u_kernel[4]+right*u_kernel[5]+leftBottom*u_kernel[6]+bottom*u_kernel[7]+rightBottom*u_kernel[8];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // 进行卷积运算 不计算透明度通道
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_FragColor=vec4(colorSum.rgb/u_kernelWeight,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // gl_FragColor=center; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 图片铺满整个canvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vsSource2</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = vec4(a_position,0,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_texCoord=a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource</span>, <span style="color:#a6e22e">fsSource</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 创建着色器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vertexShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">VERTEX_SHADER</span>, <span style="color:#a6e22e">vsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fragmentShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAGMENT_SHADER</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 将着色器链接到一个program着色程序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">useProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>, <span style="color:#a6e22e">dataArr</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">attributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">attributeLocation</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(<span style="color:#a6e22e">dataArr</span>),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">attributeLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initTexture2D</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">image</span>, <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">uniformName</span>, <span style="color:#a6e22e">unit</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 激活纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">activeTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE0</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//指定纹理的详细级别，0是基本图像，n是第n个金字塔简化级
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//指定纹理中的颜色组件，这里是RGBA，每个像素有四个字节，每个字节表示其中一个颜色通道
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">image</span> <span style="color:#75715e">//图像可以作为纹理的像素源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 设置纹理采样器所使用的纹理单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">uniformName</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1i</span>(<span style="color:#a6e22e">imgLocation</span>, <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">viewport</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clearColor</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>); <span style="color:#75715e">//设置清空颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_BUFFER_BIT</span>); <span style="color:#75715e">//清空画布
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">drawArrays</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">count</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getKernel</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">inputs</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#39;input[type=&#34;number&#34;]&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">inputs</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">input</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputs</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">kernel</span>.<span style="color:#a6e22e">push</span>(Number(<span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">kernel</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernel</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">prev</span>, <span style="color:#a6e22e">curr</span>) =&gt; <span style="color:#a6e22e">prev</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">curr</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">weight</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;glcanvas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>, { <span style="color:#a6e22e">preserveDrawingBuffer</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> });
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 确认 WebGL 支持性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;无法初始化 WebGL，你的浏览器、操作系统或硬件等可能不支持 WebGL。&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;不支持gl&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">image</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;upload&#34;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">createObjectURL</span>(<span style="color:#a6e22e">file</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">url</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">program</span><span style="color:#f92672">=</span><span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">renderImage</span>(<span style="color:#a6e22e">image</span>,<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">revokeObjectURL</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>      document
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;deal-image-btn&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;click&#34;</span>, (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">renderImage</span>(<span style="color:#a6e22e">image</span>,<span style="color:#a6e22e">program</span>,<span style="color:#a6e22e">getKernel</span>());
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource2</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化顶点坐标
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v1</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v2</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v3</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v4</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_position&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v2</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v4</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化纹理坐标
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">two</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">four</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 图像处理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">renderImage</span>(<span style="color:#a6e22e">image</span>,<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>]) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化纹理采样器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">initTexture2D</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">image</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_image&#34;</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化图片上一个像素的单位长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_OnePixel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_onePixel&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform2f</span>(<span style="color:#a6e22e">u_OnePixel</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化卷积核
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernel[0]&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1fv</span>(<span style="color:#a6e22e">u_kernel</span>, <span style="color:#a6e22e">kernel</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 计算权重之和，以便归一化处理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernelWeight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernelWeight&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 权重之和小于等于0时，让其为1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1f</span>(<span style="color:#a6e22e">u_kernelWeight</span>, <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689148718561-8a1cdd9e-a80e-4fd7-9cb0-82935eb489fc.png#averageHue=%23d9d8d8&amp;clientId=uab67cc43-4e29-4&amp;from=paste&amp;height=300&amp;id=utWb6&amp;originHeight=300&amp;originWidth=537&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=45066&amp;status=done&amp;style=none&amp;taskId=u75052460-6ebf-49c9-83f6-08c21929bde&amp;title=&amp;width=537" alt="image.png" loading="lazy" /></p>

<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="平滑滤波">平滑滤波</h3>
<p>图像平滑是一种图像处理技术，用于减少图像中的细节和高频信息，使图像变得模糊或柔化，通常有以下几种方法：</p>
<ol>
<li>均值滤波</li>
<li>中值滤波</li>
<li>高斯滤波
<!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ol>
<h4 id="均值滤波">均值滤波</h4>
<p>选用3X3的卷积核进行计算，新的像素为邻域范围内所有的像素与矩阵对应相乘<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689127623433-4b554fbc-f003-422e-b2bb-5e1cd1c4e7bf.png#averageHue=%23c8c8c8&amp;clientId=u688450fe-eea9-4&amp;from=paste&amp;id=u0deca1e9&amp;originHeight=100&amp;originWidth=100&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=3132&amp;status=done&amp;style=none&amp;taskId=ufb7f2f6e-1cec-42cd-99f3-df99d96836b&amp;title=" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->修改一下片段着色器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">precision</span> <span style="color:#66d9ef">mediump</span> <span style="color:#66d9ef">float</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 定义一个纹理采样器</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">sampler2D</span> u_image;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 一个图像像素对应的裁剪空间坐标长度</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">vec2</span> u_onePixel;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 定义一个3*3卷积核</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">float</span> u_kernel[<span style="color:#ae81ff">9</span>];
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 定义权重之和，便于归一化处理</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">float</span> u_kernelWeight;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">varying</span> <span style="color:#66d9ef">vec2</span> v_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main(){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> topLeft<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> top<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> topRight<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">1</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> left<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> center<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> right<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> leftBottom<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> bottom<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> rightBottom<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> colorSum<span style="color:#f92672">=</span>topLeft<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">+</span>top<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">+</span>topRight<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">+</span>left<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">+</span>center<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">4</span>]<span style="color:#f92672">+</span>right<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">5</span>]<span style="color:#f92672">+</span>leftBottom<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">6</span>]<span style="color:#f92672">+</span>bottom<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">7</span>]<span style="color:#f92672">+</span>rightBottom<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">8</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 进行卷积运算 不计算透明度通道</span>
</span></span><span style="display:flex;"><span>  gl_FragColor<span style="color:#f92672">=</span><span style="color:#66d9ef">vec4</span>(colorSum.rgb<span style="color:#f92672">/</span>u_kernelWeight,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// gl_FragColor=center; </span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>设置卷积核以及权重归一化</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// 初始化卷积核
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernel</span><span style="color:#f92672">=</span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>,<span style="color:#e6db74">&#39;u_kernel[0]&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernel</span><span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1fv</span>(<span style="color:#a6e22e">u_kernel</span>,<span style="color:#a6e22e">kernel</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 计算权重之和，以便归一化处理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernelWeight</span><span style="color:#f92672">=</span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>,<span style="color:#e6db74">&#39;u_kernelWeight&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 权重之和小于等于0时，让其为1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span><span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>]){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">weight</span><span style="color:#f92672">=</span><span style="color:#a6e22e">kernel</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">prev</span>,<span style="color:#a6e22e">curr</span>)=&gt;<span style="color:#a6e22e">prev</span><span style="color:#f92672">+</span><span style="color:#a6e22e">curr</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">weight</span><span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">?</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">weight</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1f</span>(<span style="color:#a6e22e">u_kernelWeight</span>,<span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span>))
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689131566484-19ae0241-8859-4bed-b096-fd7fe13b6239.png#averageHue=%23fafdfd&amp;clientId=u688450fe-eea9-4&amp;from=paste&amp;height=227&amp;id=uffcda12b&amp;originHeight=227&amp;originWidth=230&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=37122&amp;status=done&amp;style=none&amp;taskId=ua493d68c-a4fc-4968-a7e6-bf2c5961fd4&amp;title=&amp;width=230" alt="image.png" loading="lazy" /></p>

<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h4 id="中值滤波">中值滤波</h4>
<p>中值滤波能有效去除噪声的同时，能保留原图像的细节
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="累加图像处理">累加图像处理</h2>
<p>有时候需要对图像用多个滤波器进行处理，可以看下面这个例子（仿写的webglfundamentals的例子）。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Document&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      #glcanvas {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">black</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;glcanvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      你的浏览器似乎不支持或者禁用了 HTML5 &lt;<span style="color:#f92672">code</span>&gt;&amp;lt;canvas&amp;gt;&lt;/<span style="color:#f92672">code</span>&gt; 元素。
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">canvas</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upload&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox-container&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deal-image-btn&#34;</span>&gt;图像处理&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 创建着色器的方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">shaderSource</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">source</span>); <span style="color:#75715e">//为着色器对象提供数据源，即我们写的着色器代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">compileShader</span>(<span style="color:#a6e22e">shader</span>); <span style="color:#75715e">//编译着色器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getShaderParameter</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COMPILE_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 成功编译后返回着色器对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shader</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 计算变换矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#f92672">-</span><span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">y</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>        ];
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createProgram</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">vertexShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">linkProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getProgramParameter</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">LINK_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">deleteProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      precision mediump float;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义一个纹理采样器
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform sampler2D u_image;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 一个图像像素对应的裁剪空间坐标长度
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform vec2 u_onePixel;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义一个3*3卷积核
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernel[9];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义权重之和，便于归一化处理
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernelWeight;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topLeft=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 top=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topRight=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 left=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 center=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 right=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 leftBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 bottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 rightBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 colorSum=topLeft*u_kernel[0]+top*u_kernel[1]+topRight*u_kernel[2]+left*u_kernel[3]+center*u_kernel[4]+right*u_kernel[5]+leftBottom*u_kernel[6]+bottom*u_kernel[7]+rightBottom*u_kernel[8];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // 进行卷积运算 不计算透明度通道
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_FragColor=vec4(colorSum.rgb/u_kernelWeight,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // gl_FragColor=center; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 图片铺满整个canvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vsSource2</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = vec4(a_position,0,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_texCoord=a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource</span>, <span style="color:#a6e22e">fsSource</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 创建着色器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vertexShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">VERTEX_SHADER</span>, <span style="color:#a6e22e">vsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fragmentShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAGMENT_SHADER</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 将着色器链接到一个program着色程序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">useProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>, <span style="color:#a6e22e">dataArr</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">attributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">attributeLocation</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(<span style="color:#a6e22e">dataArr</span>),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">attributeLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">viewport</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clearColor</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>); <span style="color:#75715e">//设置清空颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_BUFFER_BIT</span>); <span style="color:#75715e">//清空画布
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">drawArrays</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">count</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernel</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">prev</span>, <span style="color:#a6e22e">curr</span>) =&gt; <span style="color:#a6e22e">prev</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">curr</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">weight</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;glcanvas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>, { <span style="color:#a6e22e">preserveDrawingBuffer</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> });
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 确认 WebGL 支持性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;无法初始化 WebGL，你的浏览器、操作系统或硬件等可能不支持 WebGL。&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;不支持gl&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 纹理单元0只是对纹理对象的引用，每次创建其引用都会指向最新的纹理对象，而不是纹理对象发生变化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">tex</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 定义一些卷积核
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernels</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">normal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.332</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur2</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur3</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">unsharpen</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">9</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sharpness</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sharpen</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">16</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect2</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect3</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect4</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect5</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect6</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">39</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sobelHorizontal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sobelVertical</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">previtHorizontal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">previtVertical</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">boxBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">triangleBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">emboss</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 要使用的效果列表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">effectsToApply</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">kernels</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 初始化各种效果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">template</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">effectsToApply</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">map</span>(
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;label&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;input type=&#34;checkbox&#34; value=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">item</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">item</span><span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/label&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;checkbox-container&#34;</span>).<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">template</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">originalTexture</span>, <span style="color:#a6e22e">image</span>;
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;upload&#34;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">createObjectURL</span>(<span style="color:#a6e22e">file</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">url</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 初始化程序并设置纹理坐标，顶点坐标等属性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 创建一个纹理用于存放原始图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">originalTexture</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_OnePixel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_onePixel&#34;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform2f</span>(<span style="color:#a6e22e">u_OnePixel</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernels</span>[<span style="color:#e6db74">&#34;normal&#34;</span>]);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">getCheckedValues</span>());
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">revokeObjectURL</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernel</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernel[0]&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1fv</span>(<span style="color:#a6e22e">u_kernel</span>, <span style="color:#a6e22e">kernel</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernelWeight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernelWeight&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1f</span>(<span style="color:#a6e22e">u_kernelWeight</span>, <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span>));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">kernelNames</span> <span style="color:#f92672">=</span> []) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 创建两个空纹理对象用于对同一个图像进行叠加处理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">textures</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 两个帧缓冲，用于存储绘制的结果，帧缓冲不存储颜色信息，深度信息，需要靠纹理等来存储，其只引用到它们
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">framebuffers</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texture</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">textures</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">texture</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 创建空的帧缓冲区
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fbo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createFramebuffer</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">framebuffers</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 将fbo关联到GPU的texture对象上，绘制时直接绘制颜色信息到纹理上
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">framebufferTexture2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_ATTACHMENT0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">texture</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 绑定纹理单元0与初始图像的纹理,即第一次绘制原始图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">originalTexture</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">kernelNames</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">fbo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">framebuffers</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernels</span>[<span style="color:#a6e22e">kernelNames</span>[<span style="color:#a6e22e">i</span>]];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernel</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 绘制到帧缓冲
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 将当前的绘制结果作为下一次绘制的纹理源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">textures</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 绘制最终结果到canvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getCheckedValues</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">checkdboxes</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;#checkbox-container input&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">checkdboxes</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">checkdboxes</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">checked</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">checkdboxes</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">checked</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">checked</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">values</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      document
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;checkbox-container&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">getCheckedValues</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 每一次画之前，清除上一次的卷积核，防止没有勾选内容时，仍使用上一个卷积核
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernels</span>[<span style="color:#e6db74">&#39;normal&#39;</span>])
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">values</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource2</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化顶点坐标
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v1</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v2</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v3</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v4</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_position&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v2</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v4</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化纹理坐标
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">two</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">four</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>对需要累加处理的图像，需要记录其每次的结果作为后一次的数据源。这里使用<code>Framebuffer</code>帧缓冲来记录中间结果（帧缓冲本身不能直接存储颜色、深度信息，需要和纹理等配合使用，实际是渲染到纹理）。否则可能就像前面写的3X3滤波器的例子中一样，通过获取canvas的url来记录每次的信息。<!-- raw HTML omitted -->帧缓冲器的使用流程大致如下：</p>
<ol>
<li>创建一个帧缓冲对象<code>gl.createFramebuffer()</code></li>
<li>将帧缓冲对象与绑定目标相关联<code>gl.bindFramebuffer(target,fbo)</code>
<ul>
<li>target 绑定目标
<ul>
<li><code>gl.FRAMEBUFFER</code>绑定帧缓冲对象</li>
<li><code>gl.DRAW_FRAMEBUFFER</code>绑定帧缓冲对象作为绘制目标</li>
</ul>
</li>
</ul>
</li>
<li>将帧缓冲对象和纹理对象相关联<code>gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0)</code></li>
<li>绘制图像到帧缓冲区对应的纹理中，<code>gl.drawArrays()</code></li>
</ol>
<p>这里会出现一个问题，即使用帧缓冲对象的纹理绘制出的图像会颠倒，使用原始图像为纹理则不会。<!-- raw HTML omitted -->
  <figure class="figure-image">
    <img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689323436286-fb2086f6-7d08-4155-ab56-1cd8e35d0e8f.png#averageHue=%23f9f7f6&amp;clientId=ud8e797fa-61d1-4&amp;from=paste&amp;height=609&amp;id=ub01b7b2c&amp;originHeight=609&amp;originWidth=331&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=56278&amp;status=done&amp;style=none&amp;taskId=u60f6434d-7cdc-4656-b785-285f2c3567f&amp;title=%E5%8E%9F%E5%A7%8B%E5%9B%BE%E5%83%8F&amp;width=331" title="原始图像" alt="原始图像" loading="lazy" />
    <figcaption>原始图像</figcaption>
  </figure>

  <figure class="figure-image">
    <img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689323506039-c6a58685-c420-4159-ac24-bd56496764e1.png#averageHue=%23f9f8f6&amp;clientId=ud8e797fa-61d1-4&amp;from=paste&amp;height=617&amp;id=u0c0df7aa&amp;originHeight=617&amp;originWidth=357&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=56342&amp;status=done&amp;style=none&amp;taskId=u79f3b92a-3761-41e8-8802-7b98a3d0f15&amp;title=%E5%B8%A7%E7%BC%93%E5%86%B2%E4%B8%BA%E7%BA%B9%E7%90%86%E6%95%B0%E6%8D%AE%E6%BA%90&amp;width=357" title="帧缓冲为纹理数据源" alt="帧缓冲为纹理数据源" loading="lazy" />
    <figcaption>帧缓冲为纹理数据源</figcaption>
  </figure>
<!-- raw HTML omitted -->推测这多半是由于绘制纹理空间的坐标系不一致引起的，帧缓冲对象的纹理坐标系是正常纹理空间坐标系，坐标系原点在左下角，而使用图像数据生成的初始纹理的坐标系是和图像坐标系一致的原点在左上角，因此才会导致在选中奇数个的滤波器时，图像翻转了（选中偶数个刚好负负得正）。<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689324721210-722af6db-ec61-4937-ad63-e2fd85c5b1bc.png#averageHue=%23fdfdfd&amp;clientId=ud8e797fa-61d1-4&amp;from=paste&amp;height=603&amp;id=u008c54a2&amp;originHeight=603&amp;originWidth=515&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=15656&amp;status=done&amp;style=none&amp;taskId=u5c96c399-7f4f-48ab-a2fd-6802496afe7&amp;title=&amp;width=515" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->因此在使用帧缓冲绘制图像的时候，需要进行一个坐标转换将图像坐标转为纹理空间坐标（因为前面使用的是图像坐标），简单的平移再翻转，用一个矩阵来表达就是：<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/__latex/6bab1461a7e46c36a793b6fe4d529c70.svg#card=math&amp;code=%5Cbegin%7Bbmatrix%7Ds%5C%5Ct%5C%5C1%5Cend%7Bbmatrix%7D%3D%0A%5Cbegin%7Bbmatrix%7D1%260%260%5C%5C0%26-1%261%5C%5C0%260%261%5Cend%7Bbmatrix%7D%0A%2A%5Cbegin%7Bbmatrix%7Dx%5C%5Cy%5C%5C1%5Cend%7Bbmatrix%7D%3D%0A%5Cbegin%7Bbmatrix%7Dx%5C%5C1-y%5C%5C1%5Cend%7Bbmatrix%7D&amp;id=l14ks" alt="" loading="lazy" /></p>
<!-- raw HTML omitted -->因此只需要在顶点着色器中加一个转换矩阵就可以了，将纹理坐标转换一下。小小修改下顶点着色器：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">attribute</span> <span style="color:#66d9ef">vec2</span> a_position;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">attribute</span> <span style="color:#66d9ef">vec2</span> a_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> mat3 u_picToTex;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">varying</span> <span style="color:#66d9ef">vec2</span> v_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main(){
</span></span><span style="display:flex;"><span>  gl_Position <span style="color:#f92672">=</span> <span style="color:#66d9ef">vec4</span>(a_position,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec3</span> texCoord<span style="color:#f92672">=</span>u_picToTex<span style="color:#f92672">*</span><span style="color:#66d9ef">vec3</span>(a_texCoord,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  v_texCoord<span style="color:#f92672">=</span>texCoord.xy;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>简单写一个用于设置变换矩阵的函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// 图像坐标系到纹理坐标系的转换矩阵 注意列优先
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">picToTexMat</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 不发生任何变换的单位矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mat3Unit</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">mat</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_picToTex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_picToTex&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniformMatrix3fv</span>(<span style="color:#a6e22e">u_picToTex</span>, <span style="color:#66d9ef">false</span>, <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(<span style="color:#a6e22e">mat</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>在处理图像的方法里使用该函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// 绑定纹理单元0与初始图像的纹理,即第一次绘制原始图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">originalTexture</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 绘制原始图像时，用标准矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">mat3Unit</span>)<span style="color:#75715e">//*******************
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">kernelNames</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">fbo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">framebuffers</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernels</span>[<span style="color:#a6e22e">kernelNames</span>[<span style="color:#a6e22e">i</span>]];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernel</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 绘制到帧缓冲
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 将当前的绘制结果作为下一次绘制的纹理源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">textures</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 后续每次绘制使用翻转矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">picToTexMat</span>)<span style="color:#75715e">//*********************
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 绘制最终结果到canvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span></code></pre></div><p>这样就不会发生翻转了，也证实前面的推测是正确的。<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689327237048-2457ca1c-065a-44f7-915f-b8df0990aa62.png#averageHue=%23dbd8d7&amp;clientId=u3b9209fa-a3fa-4&amp;from=paste&amp;height=615&amp;id=u13117d9d&amp;originHeight=615&amp;originWidth=315&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=26503&amp;status=done&amp;style=none&amp;taskId=u260436d4-24b3-4c07-899a-fba3b862724&amp;title=&amp;width=315" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->下面是新的完整代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#f92672">&lt;!</span><span style="color:#a6e22e">DOCTYPE</span> <span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">head</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">title</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Document</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/title&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">style</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">margin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">padding</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">glcanvas</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">border</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span><span style="color:#a6e22e">px</span> <span style="color:#a6e22e">solid</span> <span style="color:#a6e22e">black</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/style&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/head&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">body</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;glcanvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">你的浏览器似乎不支持或者禁用了</span> <span style="color:#a6e22e">HTML5</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">code</span><span style="color:#f92672">&gt;&amp;</span><span style="color:#a6e22e">lt</span>;<span style="color:#a6e22e">canvas</span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gt</span>;<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/code&gt; 元素。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/canvas&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upload&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox-container&#34;</span><span style="color:#f92672">&gt;&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 创建着色器的方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">shaderSource</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">source</span>); <span style="color:#75715e">//为着色器对象提供数据源，即我们写的着色器代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">compileShader</span>(<span style="color:#a6e22e">shader</span>); <span style="color:#75715e">//编译着色器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getShaderParameter</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COMPILE_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 成功编译后返回着色器对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shader</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createProgram</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">vertexShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">linkProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getProgramParameter</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">LINK_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">deleteProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      precision mediump float;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义一个纹理采样器
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform sampler2D u_image;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 一个图像像素对应的裁剪空间坐标长度
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform vec2 u_onePixel;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义一个3*3卷积核
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernel[9];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // 定义权重之和，便于归一化处理
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernelWeight;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topLeft=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 top=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topRight=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 left=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 center=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 right=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 leftBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 bottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 rightBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 colorSum=topLeft*u_kernel[0]+top*u_kernel[1]+topRight*u_kernel[2]+left*u_kernel[3]+center*u_kernel[4]+right*u_kernel[5]+leftBottom*u_kernel[6]+bottom*u_kernel[7]+rightBottom*u_kernel[8];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // 进行卷积运算 不计算透明度通道
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_FragColor=vec4(colorSum.rgb/u_kernelWeight,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // gl_FragColor=center; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 图片铺满整个canvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vsSource2</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform mat3 u_picToTex;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = vec4(a_position,0,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec3 texCoord=u_picToTex*vec3(a_texCoord,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_texCoord=texCoord.xy;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource</span>, <span style="color:#a6e22e">fsSource</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 创建着色器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vertexShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">VERTEX_SHADER</span>, <span style="color:#a6e22e">vsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fragmentShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAGMENT_SHADER</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 将着色器链接到一个program着色程序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">useProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>, <span style="color:#a6e22e">dataArr</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">attributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">attributeLocation</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(<span style="color:#a6e22e">dataArr</span>),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">attributeLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">viewport</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clearColor</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>); <span style="color:#75715e">//设置清空颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_BUFFER_BIT</span>); <span style="color:#75715e">//清空画布
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">drawArrays</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">count</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernel</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">prev</span>, <span style="color:#a6e22e">curr</span>) =&gt; <span style="color:#a6e22e">prev</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">curr</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">weight</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;glcanvas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>, { <span style="color:#a6e22e">preserveDrawingBuffer</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> });
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 确认 WebGL 支持性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;无法初始化 WebGL，你的浏览器、操作系统或硬件等可能不支持 WebGL。&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;不支持gl&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 纹理单元0只是对纹理对象的引用，每次创建其引用都会指向最新的纹理对象，而不是纹理对象发生变化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">tex</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 定义一些卷积核
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernels</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">normal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.332</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur2</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur3</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">unsharpen</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">9</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sharpness</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sharpen</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">16</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect2</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect3</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect4</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect5</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect6</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">39</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sobelHorizontal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sobelVertical</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">previtHorizontal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">previtVertical</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">boxBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">triangleBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">emboss</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 要使用的效果列表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">effectsToApply</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">kernels</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 初始化各种效果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">template</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">effectsToApply</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">map</span>(
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;label&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;input type=&#34;checkbox&#34; value=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">item</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">item</span><span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/label&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;checkbox-container&#34;</span>).<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">template</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">originalTexture</span>, <span style="color:#a6e22e">image</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;upload&#34;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">createObjectURL</span>(<span style="color:#a6e22e">file</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">url</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 初始化程序并设置纹理坐标，顶点坐标等属性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 创建一个纹理用于存放原始图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">originalTexture</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_OnePixel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_onePixel&#34;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform2f</span>(<span style="color:#a6e22e">u_OnePixel</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernels</span>[<span style="color:#e6db74">&#34;normal&#34;</span>]);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">getCheckedValues</span>());
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">revokeObjectURL</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernel</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernel[0]&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1fv</span>(<span style="color:#a6e22e">u_kernel</span>, <span style="color:#a6e22e">kernel</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernelWeight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernelWeight&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1f</span>(<span style="color:#a6e22e">u_kernelWeight</span>, <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span>));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 图像坐标系到纹理坐标系的转换矩阵 注意列优先
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">picToTexMat</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 不发生任何变换的单位矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mat3Unit</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">mat</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_picToTex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_picToTex&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniformMatrix3fv</span>(<span style="color:#a6e22e">u_picToTex</span>, <span style="color:#66d9ef">false</span>, <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(<span style="color:#a6e22e">mat</span>));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">kernelNames</span> <span style="color:#f92672">=</span> []) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 创建两个空纹理对象用于对同一个图像进行叠加处理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">textures</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 两个帧缓冲，用于存储绘制的结果，帧缓冲不存储颜色信息，深度信息，需要靠纹理等来存储，其只引用到它们
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">framebuffers</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texture</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">textures</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">texture</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 创建空的帧缓冲区
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fbo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createFramebuffer</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">framebuffers</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 将fbo关联到GPU的texture对象上，绘制时直接绘制颜色信息到纹理上
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">framebufferTexture2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_ATTACHMENT0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">texture</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 绑定纹理单元0与初始图像的纹理,即第一次绘制原始图像
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">originalTexture</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 绘制原始图像时，用标准矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">mat3Unit</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">kernelNames</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">fbo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">framebuffers</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernels</span>[<span style="color:#a6e22e">kernelNames</span>[<span style="color:#a6e22e">i</span>]];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernel</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 绘制到帧缓冲
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 将当前的绘制结果作为下一次绘制的纹理源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">textures</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 后续每次绘制使用翻转矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">picToTexMat</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 绘制最终结果到canvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getCheckedValues</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">checkdboxes</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;#checkbox-container input&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">checkdboxes</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">checkdboxes</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">checked</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">checkdboxes</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">checked</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">checked</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">values</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      document
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;checkbox-container&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">getCheckedValues</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// 每一次画之前，清除上一次的卷积核，防止没有勾选内容时，仍使用上一个卷积核
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernels</span>[<span style="color:#e6db74">&#34;normal&#34;</span>]);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">values</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource2</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化顶点坐标
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v1</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v2</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v3</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v4</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_position&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v2</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v4</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 初始化纹理坐标
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">two</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">four</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/body&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/html&gt;</span>
</span></span></code></pre></div><blockquote>
<p>代码好多，随便一个示例都得有几百行库😭</p>
</blockquote>

          </div>
        </div>
                 
      
  
  
  
  

  

  <div class="article-paging">
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" ></div>
  <div class="card-text">
    <a href="/docs/en0rkylr58ns9y67/"><h4 class="card-text--title text-ellipsis">文件上传</h4></a>
    <p class="card-text--row">2023-07-06 07:36</p>
  </div>
</section>
    
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" background-image-lazy data-img="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689063686800-83121075-329f-4e55-9442-1248a574fa4e.png"></div>
  <div class="card-text">
    <a href="/docs/hoi4g5unhcu8uf5d/"><h4 class="card-text--title text-ellipsis">纹理</h4></a>
    <p class="card-text--row">2023-07-06 02:11</p>
  </div>
</section>
    
  </div>
</div>
  <aside class="widget-info">
    
<section class="aside-widget widget-author content-padding-large soft-size--large soft-style--box">
  <div class="widget-body">
    <div class="author-box avatar">
      
      <img class="author-avatar soft-size--round soft-style--box" src="https://cdn.jsdelivr.net/gh/Sentisfate/wanhuatong@main/img/cdai.jfif" alt="gisculibur">
      
      <h2 class="author-name text-ellipsis">gisculibur</h2>
      
      <p class="author-desc text-ellipsis">新手WebGIS攻城狮</p>
      
    </div>
  </div>
</section>


    

<section class="aside-widget widget-toc content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>目录</span>
    </div>
  </h2>
  <div class="widget-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#渲染图像流程">渲染图像流程</a>
      <ul>
        <li><a href="#编写着色器">编写着色器</a></li>
        <li><a href="#设定数据源">设定数据源</a></li>
        <li><a href="#渲染图像">渲染图像</a></li>
        <li><a href="#简单图像操作">简单图像操作</a></li>
      </ul>
    </li>
    <li><a href="#图像处理">图像处理</a>
      <ul>
        <li><a href="#图像滤波器">图像滤波器</a>
          <ul>
            <li><a href="#平滑滤波">平滑滤波</a>
              <ul>
                <li><a href="#均值滤波">均值滤波</a></li>
                <li><a href="#中值滤波">中值滤波</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#累加图像处理">累加图像处理</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</section>


    










<section class="aside-widget widget-articles content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>相关文章</span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="post-list">
      
      
        <li class="post-item"><a href="/docs/ix726493ddpi6i3q/">3dTiles</a></li>
      
        <li class="post-item"><a href="/posts/qa4vydlw37pbsi3v/">WebGL 图像处理</a></li>
      
        <li class="post-item"><a href="/docs/goz05uyu3i5v92c9/">Cesium 模型压平</a></li>
      
        <li class="post-item"><a href="/docs/cl6l0mww8kkkizwb/">三角剖分</a></li>
      
        <li class="post-item"><a href="/docs/prgrgit7lss8vggf/">GIS理论基础</a></li>
      
        <li class="post-item"><a href="/docs/vzxnspucb4agb00w/">问题</a></li>
      
    </ul>
  </div>
</section>


    




<section class="aside-widget widget-categories content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>分类</span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="categories-list">
      
        <li>
          <a href="https://Sentisfate.github.io/categories/webgl/">WebGL</a>
          <span>1</span>
        </li>
      
        <li>
          <a href="https://Sentisfate.github.io/categories/%E5%9B%BE%E5%BA%8A/">图床</a>
          <span>1</span>
        </li>
      
    </ul>
  </div>

  
</section>


    




<section class="aside-widget widget-tags content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>标签</span>
    </div>
  </h2>
  <div class="widget-body">
    <div class="tags-list">
      
        <a href="https://Sentisfate.github.io/tags/github/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">github</a>
      
        <a href="https://Sentisfate.github.io/tags/picgo/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">picgo</a>
      
        <a href="https://Sentisfate.github.io/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">图像处理</a>
      
    </div>
  </div>

  
</section>

  </aside>
</div>
  </main><footer class="footer-container layout-block">
  
  <div class="social-icons">
    
      <a class="soft-size--primary soft-style--box" href="https://github.com/Sentisfate" target="_blank" rel="noopener noreferrer">
          
        <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
        </svg>
        

        

        

        

        
      </a>
    
  </div>
  

  <div class="colour-bar"></div>
  
  

  

  <p>
    Powered by
    <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a>
    Theme - 
    <a href="https://github.com/miiiku/hugo-theme-kagome" target="_blank" rel="noopener noreferrer author">kagome</a>
  </p>

  <p>
    <a href="javascript:;" id="theme-light">🌞 浅色</a>
    <a href="javascript:;" id="theme-dark">🌛 深色</a>
    <a href="javascript:;" id="theme-auto">🤖️ 自动</a>
  </p>
</footer>



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>






</body>

</html>