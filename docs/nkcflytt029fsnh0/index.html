<!DOCTYPE html>
<html><head>
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer" />
   
  <meta name="author" content="gisculibur">
  

   
  
  
  
  
  
  
  <meta name="keywords"
    content="theme,kagome">
  

  

  <meta name="generator" content="Hugo 0.115.2">


  
  
  
  
  <title>å›¾åƒå¤„ç† ğŸŒŸ GISå’–å–±æ£’</title>

  <meta property="og:title" content="å›¾åƒå¤„ç†" />
<meta property="og:description" content="webglé€šè¿‡çº¹ç†æ¥æ“ä½œå›¾åƒã€‚ æ¸²æŸ“å›¾åƒæµç¨‹ ç¼–å†™ç€è‰²å™¨ attribute vec2 a_position; // æ¥æ”¶çº¹ç†åæ ‡ attribute vec2 a_texCoord; // ä¼ é€’é¡¶ç‚¹çº¹ç†åæ ‡ï¼Œç”¨äºæ’å€¼; varying vec2 v_texCoord; uniform mat3 u_m; void main() { vec3 position=vec3(a_position.x,a_position.y,1.0); vec3 result=u_m*position; gl_Position = vec4(result.x,result.y,0,1);" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Sentisfate.github.io/docs/nkcflytt029fsnh0/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2023-07-06T03:04:33+00:00" />
<meta property="article:modified_time" content="2023-07-17T02:46:39+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="å›¾åƒå¤„ç†"/>
<meta name="twitter:description" content="webglé€šè¿‡çº¹ç†æ¥æ“ä½œå›¾åƒã€‚ æ¸²æŸ“å›¾åƒæµç¨‹ ç¼–å†™ç€è‰²å™¨ attribute vec2 a_position; // æ¥æ”¶çº¹ç†åæ ‡ attribute vec2 a_texCoord; // ä¼ é€’é¡¶ç‚¹çº¹ç†åæ ‡ï¼Œç”¨äºæ’å€¼; varying vec2 v_texCoord; uniform mat3 u_m; void main() { vec3 position=vec3(a_position.x,a_position.y,1.0); vec3 result=u_m*position; gl_Position = vec4(result.x,result.y,0,1);"/>


  
  
  
  
  <link rel="stylesheet" href="https://Sentisfate.github.io/assets/css/style.min.a9eba8a87a1f5444669cfe92317af83504187100f2529f484b2eeaff89777b86.css" integrity="sha256-qeuoqHofVERmnP6SMXr4NQQYcQDyUp9ISy7q/4l3e4Y=">

  <script src="https://Sentisfate.github.io/assets/js/main.min.182da266209851bc7c828aa7377f98f914e1e76c8decdd53a6cbe9bffea92cde.js" integrity="sha256-GC2iZiCYUbx8goqnN3&#43;Y&#43;RTh52yN7N1Tpsvpv/6pLN4="></script>

  </head><body><header class="header-container layout-block layout-padding">
  <div class="header-inner content-padding-large soft-size--large soft-style--box">
    <div class="header-logo">
      <a href="https://Sentisfate.github.io"><h1>GISå’–å–±æ£’</h1></a>
    </div>
    <nav class="header-nav">
      <div class="header-nav--btn">
        <div class="btn-item"></div>
        <div class="btn-item"></div>
        <div class="btn-item"></div>
      </div>
      <div class="header-nav--list">
        <div>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/" title="GISå’–å–±æ£’">ä¸»é¡µ</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/docs/" title="Docs">ç¬”è®°</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/categories/" title="Categories">åˆ†ç±»</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/tags/" title="Tags">æ ‡ç­¾</a>
          
        </div>
      </div>
    </nav>
  </div>
</header><main id="content">
    

    <div class="single-container layout-block">
      <div class="article-info">
        <div class="article-header layout-padding">
          <div class="article-cover card-container content-padding-large soft-size--large soft-style--box img">

  <div class="card-cover">
    
      <img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689056030651-91f36600-90e2-4980-bde4-ebe65963d632.png" alt="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689056030651-91f36600-90e2-4980-bde4-ebe65963d632.png" />
    
  </div>

  <div class="card-text">
    <h1 class="card-text--title">å›¾åƒå¤„ç†</h1>
    
      <p class="card-text--row">2023-07-06 03:04</p>
      
      
      

      
      
    
  </div>

</div>
        </div>

        <div class="article-content">
          <div class="markdown-body content-padding-large soft-size--large soft-style--box">
            <p>webglé€šè¿‡çº¹ç†æ¥æ“ä½œå›¾åƒã€‚
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="æ¸²æŸ“å›¾åƒæµç¨‹">æ¸²æŸ“å›¾åƒæµç¨‹</h1>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="ç¼–å†™ç€è‰²å™¨">ç¼–å†™ç€è‰²å™¨</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">attribute</span> <span style="color:#66d9ef">vec2</span> a_position;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// æ¥æ”¶çº¹ç†åæ ‡</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">attribute</span> <span style="color:#66d9ef">vec2</span> a_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ä¼ é€’é¡¶ç‚¹çº¹ç†åæ ‡ï¼Œç”¨äºæ’å€¼;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">varying</span> <span style="color:#66d9ef">vec2</span> v_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> mat3 u_m;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec3</span> position<span style="color:#f92672">=</span><span style="color:#66d9ef">vec3</span>(a_position.x,a_position.y,<span style="color:#ae81ff">1.0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec3</span> result<span style="color:#f92672">=</span>u_m<span style="color:#f92672">*</span>position;
</span></span><span style="display:flex;"><span>  gl_Position <span style="color:#f92672">=</span> <span style="color:#66d9ef">vec4</span>(result.x,result.y,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  v_texCoord<span style="color:#f92672">=</span>a_texCoord;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">precision</span> <span style="color:#66d9ef">mediump</span> <span style="color:#66d9ef">float</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å®šä¹‰ä¸€ä¸ªçº¹ç†é‡‡æ ·å™¨</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">sampler2D</span> u_image;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">varying</span> <span style="color:#66d9ef">vec2</span> v_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main(){
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ä»çº¹ç†ä¸Šå¯»æ‰¾å¯¹åº”åæ ‡çš„é¢œè‰²å€¼</span>
</span></span><span style="display:flex;"><span>  gl_FragColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="è®¾å®šæ•°æ®æº">è®¾å®šæ•°æ®æº</h2>
<p>è¿™é‡Œç”¨å›¾åƒä½œä¸ºæ•°æ®æºï¼Œä½¿ç”¨<code>Image</code>æ¥è·å–å›¾åƒ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;../../../public/img/wenli.jpg&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//æ¸²æŸ“å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">image</span>);
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="æ¸²æŸ“å›¾åƒ">æ¸²æŸ“å›¾åƒ</h2>
<p>è¿™é‡Œè·³è¿‡åˆ›å»ºç€è‰²å™¨ç¨‹åºç­‰æ“ä½œï¼Œç›´æ¥ä»å±æ€§ä¸å…¨å±€å˜é‡çš„è®¾ç½®å¼€å§‹ï¼Œå…ˆæ˜¯é…ç½®é¡¶ç‚¹åæ ‡å±æ€§ï¼Œç”¨ä¸¤ä¸ªä¸‰è§’å½¢å¡«å……æ»¡æ•´ä¸ªç”»å¸ƒï¼ˆæˆ‘çš„ç”»å¸ƒå¤§å°æ˜¯250X250ï¼‰ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// é¡¶ç‚¹åæ ‡å±æ€§ç›¸å…³é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionAttributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">program</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;a_position&#34;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">positionAttributeLocation</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">positionBuffer</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">positionAttributeLocation</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>æ¥ç€æ˜¯åˆå§‹åŒ–çº¹ç†åæ ‡å±æ€§ï¼Œéœ€è¦æ³¨æ„ï¼Œçº¹ç†ç©ºé—´èŒƒå›´æ˜¯0-1ï¼Œæ­¤å¤–çº¹ç†åæ ‡è¦å’Œé¡¶ç‚¹åæ ‡å¯¹åº”ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°åè½¬ï¼Œé•œåƒç­‰ã€‚<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689056030651-91f36600-90e2-4980-bde4-ebe65963d632.png#averageHue=%23f9f9f9&amp;clientId=u532e7da7-085c-4&amp;from=paste&amp;height=367&amp;id=ud68b7d42&amp;originHeight=367&amp;originWidth=363&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12797&amp;status=done&amp;style=none&amp;taskId=u49fa5bb1-334c-4c5b-9965-c321f63a4f2&amp;title=&amp;width=363" alt="image.png" loading="lazy" /></p>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">texLocation</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// åˆå§‹åŒ–çº¹ç†åæ ‡,å¹¶é…ç½®é¡¶ç‚¹å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texCoordBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">texCoordBuffer</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// çº¹ç†åæ ‡èŒƒå›´æ˜¯0-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([...<span style="color:#a6e22e">one</span>,...<span style="color:#a6e22e">three</span>,...<span style="color:#a6e22e">four</span>,...<span style="color:#a6e22e">one</span>,...<span style="color:#a6e22e">three</span>,...<span style="color:#a6e22e">two</span>]),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">texLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span></code></pre></div><p>åˆå§‹åŒ–çº¹ç†æ•°æ®è¿™æ˜¯ä¸€ç§é»˜è®¤ä½¿ç”¨çº¹ç†å•å…ƒ0çš„å†™æ³•ï¼Œ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// åˆ›å»ºçº¹ç†å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span><span style="color:#75715e">// é»˜è®¤å½“å‰æ´»åŠ¨çš„çº¹ç†å•å…ƒæ˜¯gl.TEXTURE0,å› æ­¤è¿™é‡Œæ˜¯ç»‘å®šäº†çº¹ç†å•å…ƒ0å’Œçº¹ç†å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†çš„è¯¦ç»†çº§åˆ«ï¼Œ0æ˜¯åŸºæœ¬å›¾åƒï¼Œnæ˜¯ç¬¬nä¸ªé‡‘å­—å¡”ç®€åŒ–çº§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†ä¸­çš„é¢œè‰²ç»„ä»¶ï¼Œè¿™é‡Œæ˜¯RGBAï¼Œæ¯ä¸ªåƒç´ æœ‰å››ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚è¡¨ç¤ºå…¶ä¸­ä¸€ä¸ªé¢œè‰²é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//å¡«å……çº¹ç† gl.TEXTURE_2D è¡¨ç¤ºæ˜¯äºŒç»´çº¹ç†è´´å›¾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">image</span> <span style="color:#75715e">//å›¾åƒå¯ä»¥ä½œä¸ºçº¹ç†çš„åƒç´ æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¾ç½®å‚æ•°ï¼Œä»¥ä¾¿ç»˜åˆ¶ä»»ä½•å°ºå¯¸çš„å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨S(æ°´å¹³)æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨Tå‚ç›´æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¾ç½®çº¹ç†ç¼©å°å’Œæ”¾å¤§çš„æ»¤æ³¢å™¨,éƒ½æ˜¯ç”¨gl.NEAREST,å³,å½“çº¹ç†éœ€è¦ç¼©å°æˆ–æ”¾å¤§æ—¶,ä½¿ç”¨æ¥è¿‘çº¹ç†åæ ‡çš„åƒç´ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span></code></pre></div><p>å¦‚æœéœ€è¦å¦æŒ‡å®šçº¹ç†å•å…ƒéœ€è¦æ˜¾ç¤ºçš„å»æ¿€æ´»è¯¥çº¹ç†å•å…ƒã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">unit</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e">//æŒ‘é€‰ä¸€ä¸ªçº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// æ¿€æ´»çº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">activeTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE0</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å°†è¯¥çº¹ç†å•å…ƒä¸çº¹ç†å¯¹è±¡ç»‘å®š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†çš„è¯¦ç»†çº§åˆ«ï¼Œ0æ˜¯åŸºæœ¬å›¾åƒï¼Œnæ˜¯ç¬¬nä¸ªé‡‘å­—å¡”ç®€åŒ–çº§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†ä¸­çš„é¢œè‰²ç»„ä»¶ï¼Œè¿™é‡Œæ˜¯RGBAï¼Œæ¯ä¸ªåƒç´ æœ‰å››ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚è¡¨ç¤ºå…¶ä¸­ä¸€ä¸ªé¢œè‰²é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//å¡«å……çº¹ç† gl.TEXTURE_2D äºŒç»´çº¹ç†è´´å›¾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">image</span> <span style="color:#75715e">//å›¾åƒå¯ä»¥ä½œä¸ºçº¹ç†çš„åƒç´ æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¾ç½®å‚æ•°ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶ä»»ä½•å°ºå¯¸çš„å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨S(æ°´å¹³)æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨Tå‚ç›´æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¾ç½®çº¹ç†ç¼©å°å’Œæ”¾å¤§çš„æ»¤æ³¢å™¨,éƒ½æ˜¯ç”¨gl.NEAREST,å³,å½“çº¹ç†éœ€è¦ç¼©å°æˆ–æ”¾å¤§æ—¶,ä½¿ç”¨æ¥è¿‘çº¹ç†åæ ‡çš„åƒç´ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¾ç½®çº¹ç†é‡‡æ ·å™¨æ‰€ä½¿ç”¨çš„çº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_image&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å°†çº¹ç†é‡‡æ ·å™¨ä¸çº¹ç†å•å…ƒç›¸ç»‘å®š,ä¸ç»‘å®šé»˜è®¤ä¸çº¹ç†å•å…ƒ0ç»‘å®š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1i</span>(<span style="color:#a6e22e">imgLocation</span>, <span style="color:#a6e22e">unit</span>);
</span></span></code></pre></div><p>ç„¶åå°±æ˜¯è¿›è¡Œç»˜åˆ¶æ“ä½œï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Document&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      #glcanvas {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">black</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;glcanvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      ä½ çš„æµè§ˆå™¨ä¼¼ä¹ä¸æ”¯æŒæˆ–è€…ç¦ç”¨äº† HTML5 &lt;<span style="color:#f92672">code</span>&gt;&amp;lt;canvas&amp;gt;&lt;/<span style="color:#f92672">code</span>&gt; å…ƒç´ ã€‚
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">canvas</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;glcanvas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// ç¡®è®¤ WebGL æ”¯æŒæ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;æ— æ³•åˆå§‹åŒ– WebGLï¼Œä½ çš„æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿæˆ–ç¡¬ä»¶ç­‰å¯èƒ½ä¸æ”¯æŒ WebGLã€‚&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;ä¸æ”¯æŒgl&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// åˆ›å»ºç€è‰²å™¨çš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">shaderSource</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">source</span>); <span style="color:#75715e">//ä¸ºç€è‰²å™¨å¯¹è±¡æä¾›æ•°æ®æºï¼Œå³æˆ‘ä»¬å†™çš„ç€è‰²å™¨ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">compileShader</span>(<span style="color:#a6e22e">shader</span>); <span style="color:#75715e">//ç¼–è¯‘ç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getShaderParameter</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COMPILE_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æˆåŠŸç¼–è¯‘åè¿”å›ç€è‰²å™¨å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shader</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// è®¡ç®—å˜æ¢çŸ©é˜µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#f92672">-</span><span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">y</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>        ];
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createProgram</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">vertexShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">linkProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getProgramParameter</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">LINK_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">deleteProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // æ¥æ”¶çº¹ç†åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // ä¼ é€’é¡¶ç‚¹çº¹ç†åæ ‡ï¼Œç”¨äºæ’å€¼;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform mat3 u_m;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec3 position=vec3(a_position.x,a_position.y,1.0);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec3 result=u_m*position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = vec4(result.x,result.y,0,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_texCoord=a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      precision mediump float;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰ä¸€ä¸ªçº¹ç†é‡‡æ ·å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform sampler2D u_image;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // ä»çº¹ç†ä¸Šå¯»æ‰¾å¯¹åº”åæ ‡çš„é¢œè‰²å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_FragColor=texture2D(u_image,v_texCoord).rgba;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;../../../public/img/apple.jpg&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// canvas.width = image.width;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// canvas.height = image.height;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">image</span>);
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">image</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆ›å»ºç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vertexShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">VERTEX_SHADER</span>, <span style="color:#a6e22e">vsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fragmentShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAGMENT_SHADER</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// å°†ç€è‰²å™¨é“¾æ¥åˆ°ä¸€ä¸ªprogramç€è‰²ç¨‹åº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">useProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// é¡¶ç‚¹åæ ‡å±æ€§ç›¸å…³é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionAttributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">program</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;a_position&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">positionAttributeLocation</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">positionBuffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">positionAttributeLocation</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// çº¹ç†åæ ‡ç›¸å…³é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">texLocation</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆå§‹åŒ–çº¹ç†åæ ‡,å¹¶é…ç½®é¡¶ç‚¹å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texCoordBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">texCoordBuffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// çº¹ç†åæ ‡èŒƒå›´æ˜¯0-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">four</span>,
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>            ...<span style="color:#a6e22e">two</span>,
</span></span><span style="display:flex;"><span>          ]),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">texLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆ›å»ºçº¹ç†å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// é»˜è®¤å½“å‰æ´»åŠ¨çš„çº¹ç†å•å…ƒæ˜¯gl.TEXTURE0,å› æ­¤è¿™é‡Œæ˜¯ç»‘å®šäº†çº¹ç†å•å…ƒ0å’Œçº¹ç†å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†çš„è¯¦ç»†çº§åˆ«ï¼Œ0æ˜¯åŸºæœ¬å›¾åƒï¼Œnæ˜¯ç¬¬nä¸ªé‡‘å­—å¡”ç®€åŒ–çº§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†ä¸­çš„é¢œè‰²ç»„ä»¶ï¼Œè¿™é‡Œæ˜¯RGBAï¼Œæ¯ä¸ªåƒç´ æœ‰å››ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚è¡¨ç¤ºå…¶ä¸­ä¸€ä¸ªé¢œè‰²é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å¡«å……çº¹ç† gl.TEXTURE_2D äºŒç»´çº¹ç†è´´å›¾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">image</span> <span style="color:#75715e">//å›¾åƒå¯ä»¥ä½œä¸ºçº¹ç†çš„åƒç´ æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// è®¾ç½®å‚æ•°ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶ä»»ä½•å°ºå¯¸çš„å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨S(æ°´å¹³)æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨Tå‚ç›´æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// è®¾ç½®çº¹ç†ç¼©å°å’Œæ”¾å¤§çš„æ»¤æ³¢å™¨,éƒ½æ˜¯ç”¨gl.NEAREST,å³,å½“çº¹ç†éœ€è¦ç¼©å°æˆ–æ”¾å¤§æ—¶,ä½¿ç”¨æ¥è¿‘çº¹ç†åæ ‡çš„åƒç´ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//  å°†çº¹ç†é‡‡æ ·å™¨ç»‘å®šä¸€ä¸ªçº¹ç†å•å…ƒ æ²¡æœ‰ç»‘å®šçº¹ç†å•å…ƒ,é»˜è®¤æ˜¯gl.TEXTURE0è¿™ä¸ªå•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">bindTextureUnit</span>() {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">unit</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e">//æŒ‘é€‰ä¸€ä¸ªçº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#75715e">// æ¿€æ´»çº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">activeTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE0</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// å°†è¯¥çº¹ç†å•å…ƒä¸çº¹ç†å¯¹è±¡ç»‘å®š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†çš„è¯¦ç»†çº§åˆ«ï¼Œ0æ˜¯åŸºæœ¬å›¾åƒï¼Œnæ˜¯ç¬¬nä¸ªé‡‘å­—å¡”ç®€åŒ–çº§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†ä¸­çš„é¢œè‰²ç»„ä»¶ï¼Œè¿™é‡Œæ˜¯RGBAï¼Œæ¯ä¸ªåƒç´ æœ‰å››ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚è¡¨ç¤ºå…¶ä¸­ä¸€ä¸ªé¢œè‰²é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//å¡«å……çº¹ç† gl.TEXTURE_2D äºŒç»´çº¹ç†è´´å›¾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span> <span style="color:#75715e">//å›¾åƒå¯ä»¥ä½œä¸ºçº¹ç†çš„åƒç´ æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          );
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// è®¾ç½®å‚æ•°ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶ä»»ä½•å°ºå¯¸çš„å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨S(æ°´å¹³)æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨Tå‚ç›´æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// è®¾ç½®çº¹ç†ç¼©å°å’Œæ”¾å¤§çš„æ»¤æ³¢å™¨,éƒ½æ˜¯ç”¨gl.NEAREST,å³,å½“çº¹ç†éœ€è¦ç¼©å°æˆ–æ”¾å¤§æ—¶,ä½¿ç”¨æ¥è¿‘çº¹ç†åæ ‡çš„åƒç´ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// // è®¾ç½®çº¹ç†é‡‡æ ·å™¨æ‰€ä½¿ç”¨çš„çº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_image&#34;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// å°†çº¹ç†é‡‡æ ·å™¨ä¸çº¹ç†å•å…ƒç›¸ç»‘å®š,ä¸ç»‘å®šé»˜è®¤ä¸çº¹ç†å•å…ƒ0ç»‘å®š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1i</span>(<span style="color:#a6e22e">imgLocation</span>, <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// bindTextureUnit();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// å…¨å±€å˜é‡ç›¸å…³é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_m</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_m&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">bottom</span>, <span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">left</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getBoundingClientRect</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// è®¡ç®— canvasçš„ä¸­å¿ƒç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">center</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">left</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">right</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">bottom</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniformMatrix3fv</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">u_m</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>, <span style="color:#a6e22e">center</span>.<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">center</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>          )
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">viewport</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clearColor</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>); <span style="color:#75715e">//è®¾ç½®æ¸…ç©ºé¢œè‰²
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_BUFFER_BIT</span>); <span style="color:#75715e">//æ¸…ç©ºç”»å¸ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">drawArrays</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689068167852-e7d309af-92b1-4b9e-8800-476209773c8e.png#averageHue=%23f9fdfc&amp;clientId=u710d0586-5b16-4&amp;from=paste&amp;height=232&amp;id=uc7cf5582&amp;originHeight=232&amp;originWidth=266&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=47856&amp;status=done&amp;style=none&amp;taskId=u3fc5782a-afe1-48c6-956e-bf00deab074&amp;title=&amp;width=266" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå›¾åƒä¸Šä¸‹é¢ å€’äº†ã€‚æ˜æ˜æ˜¯æŒ‰ç…§é¡¶ç‚¹åæ ‡å’Œçº¹ç†åæ ‡ä¸€ä¸€å¯¹åº”ï¼Œä½†ä»ç„¶å‡ºç°äº†é¢ å€’é—®é¢˜ã€‚åé¢å‘ç°webglåœ¨æ¸²æŸ“çº¹ç†æ—¶ï¼Œä½¿ç”¨çš„ä»ç„¶æ˜¯å›¾ç‰‡åæ ‡ç³»ã€‚</p>
<blockquote>
<p>çº¹ç†åæ ‡ç³»æ˜¯ç†æƒ³çŠ¶æ€ï¼Œå®é™…æ¸²æŸ“çº¹ç†æ—¶ webgl ä½¿ç”¨çš„å›¾ç‰‡åæ ‡ç³»ã€‚å› æ­¤åœ¨å‘ç¼“å†²åŒºå¯¹è±¡ä¸­ä¼ é€’å‡ ä½•å›¾å½¢çš„ç‚¹ä½å’Œçº¹ç†å›¾åƒçš„ç‚¹ä½æ—¶ï¼Œåº”è¯¥ä½¿ç”¨å›¾ç‰‡åæ ‡ç³»ä½œä¸ºå‚è€ƒã€‚</p>
</blockquote>
<p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689068414088-a1abab0a-86c1-4ae0-8f7a-7bc17a1d4333.png#averageHue=%23fbfbfb&amp;clientId=u710d0586-5b16-4&amp;from=paste&amp;height=365&amp;id=u58450721&amp;originHeight=365&amp;originWidth=359&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=44420&amp;status=done&amp;style=none&amp;taskId=u85ac45e6-3ef6-4271-a093-2a2575e6d71&amp;title=&amp;width=359" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->ä¹Ÿå°±æ˜¯å°†çº¹ç†åæ ‡è¿›è¡Œç¨å¾®æ”¹åŠ¨ä¸€ä¸‹å³å¯</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689068683539-3f013e4e-fe91-41b7-a985-2f0a34b10b4b.png#averageHue=%23f9fdfc&amp;clientId=u710d0586-5b16-4&amp;from=paste&amp;height=235&amp;id=u69b1cb33&amp;originHeight=235&amp;originWidth=269&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=47745&amp;status=done&amp;style=none&amp;taskId=ue363cfef-fc50-4beb-9896-98495c3fee9&amp;title=&amp;width=269" alt="image.png" loading="lazy" /></p>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#f92672">&lt;!</span><span style="color:#a6e22e">DOCTYPE</span> <span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">head</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">title</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Document</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/title&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">style</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">margin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">padding</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">glcanvas</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">border</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span><span style="color:#a6e22e">px</span> <span style="color:#a6e22e">solid</span> <span style="color:#a6e22e">black</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/style&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/head&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">body</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;glcanvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ä½ çš„æµè§ˆå™¨ä¼¼ä¹ä¸æ”¯æŒæˆ–è€…ç¦ç”¨äº†</span> <span style="color:#a6e22e">HTML5</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">code</span><span style="color:#f92672">&gt;&amp;</span><span style="color:#a6e22e">lt</span>;<span style="color:#a6e22e">canvas</span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gt</span>;<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/code&gt; å…ƒç´ ã€‚</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/canvas&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;glcanvas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ç¡®è®¤ WebGL æ”¯æŒæ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">alert</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;æ— æ³•åˆå§‹åŒ– WebGLï¼Œä½ çš„æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿæˆ–ç¡¬ä»¶ç­‰å¯èƒ½ä¸æ”¯æŒ WebGLã€‚&#34;</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;ä¸æ”¯æŒgl&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// åˆ›å»ºç€è‰²å™¨çš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">shaderSource</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">source</span>); <span style="color:#75715e">//ä¸ºç€è‰²å™¨å¯¹è±¡æä¾›æ•°æ®æºï¼Œå³æˆ‘ä»¬å†™çš„ç€è‰²å™¨ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">compileShader</span>(<span style="color:#a6e22e">shader</span>); <span style="color:#75715e">//ç¼–è¯‘ç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getShaderParameter</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COMPILE_STATUS</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// æˆåŠŸç¼–è¯‘åè¿”å›ç€è‰²å™¨å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shader</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¡ç®—å˜æ¢çŸ©é˜µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">-</span><span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>    (<span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">y</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createProgram</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">vertexShader</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">linkProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getProgramParameter</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">LINK_STATUS</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">deleteProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // æ¥æ”¶çº¹ç†åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // ä¼ é€’é¡¶ç‚¹çº¹ç†åæ ‡ï¼Œç”¨äºæ’å€¼;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform mat3 u_m;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec3 position=vec3(a_position.x,a_position.y,1.0);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec3 result=u_m*position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = vec4(result.x,result.y,0,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_texCoord=a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      precision mediump float;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰ä¸€ä¸ªçº¹ç†é‡‡æ ·å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform sampler2D u_image;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // ä»çº¹ç†ä¸Šå¯»æ‰¾å¯¹åº”åæ ‡çš„é¢œè‰²å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_FragColor=texture2D(u_image,v_texCoord).rgba;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;../../../public/img/apple.jpg&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// canvas.width = image.width;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// canvas.height = image.height;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">image</span>);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">image</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// åˆ›å»ºç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vertexShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">VERTEX_SHADER</span>, <span style="color:#a6e22e">vsSource</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fragmentShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAGMENT_SHADER</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// å°†ç€è‰²å™¨é“¾æ¥åˆ°ä¸€ä¸ªprogramç€è‰²ç¨‹åº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">useProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// é¡¶ç‚¹åæ ‡å±æ€§ç›¸å…³é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionAttributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">program</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;a_position&#34;</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">positionAttributeLocation</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">positionBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">positionBuffer</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">positionAttributeLocation</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// çº¹ç†åæ ‡ç›¸å…³é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">texLocation</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// åˆå§‹åŒ–çº¹ç†åæ ‡,å¹¶é…ç½®é¡¶ç‚¹å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texCoordBuffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">texCoordBuffer</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// çº¹ç†åæ ‡èŒƒå›´æ˜¯0-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>([
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">four</span>,
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>      ...<span style="color:#a6e22e">two</span>,
</span></span><span style="display:flex;"><span>    ]),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">texLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// åˆ›å»ºçº¹ç†å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// é»˜è®¤å½“å‰æ´»åŠ¨çš„çº¹ç†å•å…ƒæ˜¯gl.TEXTURE0,å› æ­¤è¿™é‡Œæ˜¯ç»‘å®šäº†çº¹ç†å•å…ƒ0å’Œçº¹ç†å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†çš„è¯¦ç»†çº§åˆ«ï¼Œ0æ˜¯åŸºæœ¬å›¾åƒï¼Œnæ˜¯ç¬¬nä¸ªé‡‘å­—å¡”ç®€åŒ–çº§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†ä¸­çš„é¢œè‰²ç»„ä»¶ï¼Œè¿™é‡Œæ˜¯RGBAï¼Œæ¯ä¸ªåƒç´ æœ‰å››ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚è¡¨ç¤ºå…¶ä¸­ä¸€ä¸ªé¢œè‰²é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//å¡«å……çº¹ç† gl.TEXTURE_2D äºŒç»´çº¹ç†è´´å›¾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">image</span> <span style="color:#75715e">//å›¾åƒå¯ä»¥ä½œä¸ºçº¹ç†çš„åƒç´ æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// è®¾ç½®å‚æ•°ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶ä»»ä½•å°ºå¯¸çš„å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨S(æ°´å¹³)æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨Tå‚ç›´æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// è®¾ç½®çº¹ç†ç¼©å°å’Œæ”¾å¤§çš„æ»¤æ³¢å™¨,éƒ½æ˜¯ç”¨gl.NEAREST,å³,å½“çº¹ç†éœ€è¦ç¼©å°æˆ–æ”¾å¤§æ—¶,ä½¿ç”¨æ¥è¿‘çº¹ç†åæ ‡çš„åƒç´ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//  å°†çº¹ç†é‡‡æ ·å™¨ç»‘å®šä¸€ä¸ªçº¹ç†å•å…ƒ æ²¡æœ‰ç»‘å®šçº¹ç†å•å…ƒ,é»˜è®¤æ˜¯gl.TEXTURE0è¿™ä¸ªå•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">bindTextureUnit</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">unit</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e">//æŒ‘é€‰ä¸€ä¸ªçº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// æ¿€æ´»çº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">activeTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE0</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å°†è¯¥çº¹ç†å•å…ƒä¸çº¹ç†å¯¹è±¡ç»‘å®š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†çš„è¯¦ç»†çº§åˆ«ï¼Œ0æ˜¯åŸºæœ¬å›¾åƒï¼Œnæ˜¯ç¬¬nä¸ªé‡‘å­—å¡”ç®€åŒ–çº§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†ä¸­çš„é¢œè‰²ç»„ä»¶ï¼Œè¿™é‡Œæ˜¯RGBAï¼Œæ¯ä¸ªåƒç´ æœ‰å››ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚è¡¨ç¤ºå…¶ä¸­ä¸€ä¸ªé¢œè‰²é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å¡«å……çº¹ç† gl.TEXTURE_2D äºŒç»´çº¹ç†è´´å›¾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">image</span> <span style="color:#75715e">//å›¾åƒå¯ä»¥ä½œä¸ºçº¹ç†çš„åƒç´ æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è®¾ç½®å‚æ•°ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶ä»»ä½•å°ºå¯¸çš„å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨S(æ°´å¹³)æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è®¾ç½®çº¹ç†åœ¨Tå‚ç›´æ–¹å‘ä¸Šçš„ç¯ç»•æ¨¡å¼,çº¹ç†åæ ‡è¶…å‡ºèŒƒå›´[0,1]æ—¶,å¤¹åœ¨çº¹ç†çš„è¾¹ç¼˜å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è®¾ç½®çº¹ç†ç¼©å°å’Œæ”¾å¤§çš„æ»¤æ³¢å™¨,éƒ½æ˜¯ç”¨gl.NEAREST,å³,å½“çº¹ç†éœ€è¦ç¼©å°æˆ–æ”¾å¤§æ—¶,ä½¿ç”¨æ¥è¿‘çº¹ç†åæ ‡çš„åƒç´ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// // è®¾ç½®çº¹ç†é‡‡æ ·å™¨æ‰€ä½¿ç”¨çš„çº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_image&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å°†çº¹ç†é‡‡æ ·å™¨ä¸çº¹ç†å•å…ƒç›¸ç»‘å®š,ä¸ç»‘å®šé»˜è®¤ä¸çº¹ç†å•å…ƒ0ç»‘å®š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1i</span>(<span style="color:#a6e22e">imgLocation</span>, <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// bindTextureUnit();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// å…¨å±€å˜é‡ç›¸å…³é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_m</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_m&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">bottom</span>, <span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">top</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">left</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getBoundingClientRect</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// è®¡ç®— canvasçš„ä¸­å¿ƒç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">center</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">left</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">right</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">bottom</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniformMatrix3fv</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">u_m</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>, <span style="color:#a6e22e">center</span>.<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">center</span>.<span style="color:#a6e22e">y</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">viewport</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clearColor</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>); <span style="color:#75715e">//è®¾ç½®æ¸…ç©ºé¢œè‰²
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_BUFFER_BIT</span>); <span style="color:#75715e">//æ¸…ç©ºç”»å¸ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">drawArrays</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/body&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/html&gt;</span>
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="ç®€å•å›¾åƒæ“ä½œ">ç®€å•å›¾åƒæ“ä½œ</h2>
<p>å¯ä»¥é€šè¿‡ä¿®æ”¹ç‰‡æ®µç€è‰²å™¨ï¼Œæ¥åšä¸€äº›ç®€å•çš„æ“ä½œï¼Œå¦‚æ”¹å˜é¢œè‰²åˆ†é‡é€šé“ã€‚å¾—åˆ°ä¸€ä¸ªæ¼‚äº®çš„è“è‹¹æœã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span>gl_FragColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord).bgra;<span style="color:#75715e">//å°†çº¢è“å¯¹è°ƒ</span>
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689068795297-d8fd7b37-017a-4285-806f-4299f56e00f6.png#averageHue=%23fafdfa&amp;clientId=u710d0586-5b16-4&amp;from=paste&amp;height=259&amp;id=u0db2913b&amp;originHeight=259&amp;originWidth=250&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=48352&amp;status=done&amp;style=none&amp;taskId=u8d1d4998-71d8-43de-83e7-dc527223586&amp;title=&amp;width=250" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->å¦‚æœè¦æ›´ç»†èŠ‚çš„å»æ“ä½œå›¾åƒï¼Œéœ€è¦è‡³å°‘èƒ½è·å–åˆ°ä»»æ„åƒç´ åœ¨çº¹ç†ç©ºé—´ä¸­çš„åæ ‡ã€‚<code>1/image.width``1/image.height</code>å°±æ˜¯å›¾ç‰‡1ä¸ªåƒç´ åœ¨è£å‰ªç©ºé—´çš„åæ ‡é•¿åº¦ã€‚<!-- raw HTML omitted -->æ“ä½œæ¯ä¸€ä¸ªåƒç´ åˆ™å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ç§å½¢å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">vec2</span> texCoord<span style="color:#f92672">=</span>v_texCoord<span style="color:#f92672">+</span><span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>image.width<span style="color:#f92672">*</span>m,<span style="color:#ae81ff">1.</span>image.height<span style="color:#f92672">*</span>n)
</span></span></code></pre></div><p>ä¸‹é¢å†™ä¸€ä¸ªç®€å•çš„å‡å€¼æ»¤æ³¢åå­—å½¢çª—å£æ¥è¿›è¡Œå›¾åƒæ¨¡ç³Šï¼Œå°†å›¾åƒçš„æ¯ä¸ªåƒç´ ï¼Œç”¨å…¶ä¸Šä¸‹å·¦å³ç›¸é‚»çš„åƒç´ çš„å‡å€¼æ›¿ä»£ã€‚ç®€å•ä¿®æ”¹ä¸‹ç‰‡æ®µç€è‰²å™¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">precision</span> <span style="color:#66d9ef">mediump</span> <span style="color:#66d9ef">float</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å®šä¹‰ä¸€ä¸ªçº¹ç†é‡‡æ ·å™¨</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">sampler2D</span> u_image;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ä¸€ä¸ªå›¾åƒåƒç´ å¯¹åº”çš„è£å‰ªç©ºé—´åæ ‡,è€Œä¸æ˜¯canvasçš„å®½é«˜,å› ä¸ºå¯èƒ½å­˜åœ¨ç¼©æ”¾çš„æƒ…å†µ</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">vec2</span> u_onePixel;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">varying</span> <span style="color:#66d9ef">vec2</span> v_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main(){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> leftColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord<span style="color:#f92672">-</span><span style="color:#66d9ef">vec2</span>(u_onePixel.x,<span style="color:#ae81ff">0.0</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> rightColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord<span style="color:#f92672">+</span><span style="color:#66d9ef">vec2</span>(u_onePixel.x,<span style="color:#ae81ff">0.0</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> topColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord<span style="color:#f92672">-</span><span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">0.0</span>,u_onePixel.y));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> bottomColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord<span style="color:#f92672">+</span><span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">0.0</span>,u_onePixel.y));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> centerColor<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// è¿›è¡Œäº†æ¨¡ç³Šæ“ä½œ</span>
</span></span><span style="display:flex;"><span>  gl_FragColor<span style="color:#f92672">=</span>(leftColor<span style="color:#f92672">+</span>rightColor<span style="color:#f92672">+</span>topColor<span style="color:#f92672">+</span>bottomColor<span style="color:#f92672">+</span>centerColor)<span style="color:#f92672">/</span><span style="color:#ae81ff">5.0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// gl_FragColor=centerColor; //æ²¡æœ‰è¿›è¡Œæ¨¡ç³Šæ“ä½œ</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è®¾ç½®onePixelå…¨å±€å˜é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_OnePixel</span><span style="color:#f92672">=</span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>,<span style="color:#e6db74">&#39;u_onePixel&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform2f</span>(<span style="color:#a6e22e">u_OnePixel</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>)
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689124550290-7158cf06-faae-4604-84b7-98ea06c916d3.png#averageHue=%23fafcfd&amp;clientId=u688450fe-eea9-4&amp;from=paste&amp;height=213&amp;id=u59adcc1a&amp;originHeight=213&amp;originWidth=236&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=40761&amp;status=done&amp;style=none&amp;taskId=ua1f6aec4-7a24-4646-b6e5-a837f03c4cc&amp;title=&amp;width=236" alt="image.png" loading="lazy" /></p>

  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689124567407-7b954666-66f5-49b6-ad24-caccb1eeab92.png#averageHue=%23fafdfe&amp;clientId=u688450fe-eea9-4&amp;from=paste&amp;height=217&amp;id=uf526a48c&amp;originHeight=217&amp;originWidth=228&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46669&amp;status=done&amp;style=none&amp;taskId=ub29b04ca-a972-4c7f-a44f-12d5841f20d&amp;title=&amp;width=228" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->èƒ½æ¸…æ™°çœ‹åˆ°å›¾ç‰‡çš„å˜åŒ–ã€‚</p>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸ªç»†èŠ‚,åå­—çª—å£åœ¨è¶…å‡ºå›¾åƒè¾¹ç•ŒèŒƒå›´æ—¶ï¼Œä¸Šä¸‹å·¦å³åƒç´ æ˜¯å¦‚ä½•å–çš„ï¼Ÿæ ¹æ®å‰é¢è®¾ç½®çš„<code>texParameteri</code>ï¼Œè¶…å‡ºæ—¶ç”¨è¾¹ç•Œåƒç´ æ›¿ä»£ï¼Œå¦‚ä¸‹å›¾ï¼ˆç”±äºè‹¹æœå‘¨å›´éƒ½æ˜¯ç©ºç™½ï¼Œæ•ˆæœä¸æ˜æ˜¾ï¼Œå› æ­¤æ¢äº†ä¸ªçº¹ç†å›¾ï¼‰</p>
</blockquote>
<p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689125450745-232f8362-389e-44b1-b163-b8f053df4415.png#averageHue=%23a97345&amp;clientId=u688450fe-eea9-4&amp;from=paste&amp;height=257&amp;id=ue4ac0974&amp;originHeight=257&amp;originWidth=260&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=24044&amp;status=done&amp;style=none&amp;taskId=ue3a3b52e-6215-413b-a2c1-16855cb309a&amp;title=&amp;width=260" alt="image.png" loading="lazy" /></p>

<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="å›¾åƒå¤„ç†">å›¾åƒå¤„ç†</h1>
<blockquote>
<p>å­¦çš„é¥æ„Ÿæ•°å­—å›¾åƒå¤„ç†æ€»ç®—æ´¾ä¸Šç”¨åœºäº†ï¼Œè™½ç„¶å·²ç»å¿˜å¾—å·®ä¸å¤šäº†ã€‚ã€‚ã€‚</p>
</blockquote>
<p>ä¸åŒçš„å›¾åƒå¤„ç†æ–¹æ³•å¾€å¾€å¯¹åº”ç€ä¸åŒçš„ç”¨é€”ï¼Œå¦‚æ¨¡ç³Šå›¾åƒï¼Œå¢å¼ºå›¾åƒï¼Œå»é™¤å™ªå£°ï¼Œå¢å¼ºå™ªå£°ç­‰ã€‚</p>
<blockquote>
<p>æ»¤æ³¢å’Œå·ç§¯æ ¸æ˜¯å›¾åƒå¹³æ»‘ä¸­çš„ä¸¤ä¸ªé‡è¦æ¦‚å¿µã€‚æ»¤æ³¢æ˜¯æŒ‡å°†ä¸€ä¸ªå·ç§¯æ ¸åº”ç”¨äºå›¾åƒçš„æ¯ä¸ªåƒç´ ï¼Œé€šè¿‡è®¡ç®—å·ç§¯æ ¸ä¸å›¾åƒå±€éƒ¨åŒºåŸŸçš„åŠ æƒå’Œæ¥å¾—åˆ°æ–°çš„åƒç´ å€¼ã€‚å·ç§¯æ ¸æ˜¯ä¸€ä¸ªå°çš„çŸ©é˜µï¼Œå…¶ä¸­çš„å…ƒç´ è¡¨ç¤ºäº†åœ¨è®¡ç®—åŠ æƒå’Œæ—¶æ¯ä¸ªåƒç´ çš„æƒé‡ã€‚
æ»¤æ³¢å’Œå·ç§¯æ ¸çš„åŒºåˆ«åœ¨äºå®ƒä»¬çš„æ¦‚å¿µå’Œåº”ç”¨æ–¹å¼ã€‚æ»¤æ³¢æ˜¯ä¸€ç§å›¾åƒå¤„ç†æŠ€æœ¯ï¼Œç”¨äºå¹³æ»‘å›¾åƒæˆ–æå–å›¾åƒç‰¹å¾ã€‚è€Œå·ç§¯æ ¸æ˜¯æ»¤æ³¢è¿‡ç¨‹ä¸­çš„ä¸€ç§æ•°å­¦å·¥å…·ï¼Œç”¨äºè®¡ç®—æ¯ä¸ªåƒç´ çš„æ–°å€¼ã€‚æ»¤æ³¢å¯ä»¥ä½¿ç”¨ä¸åŒç±»å‹çš„å·ç§¯æ ¸æ¥å®ç°ä¸åŒçš„å¹³æ»‘æ•ˆæœï¼Œä¾‹å¦‚å‡å€¼æ»¤æ³¢ã€é«˜æ–¯æ»¤æ³¢ç­‰ã€‚</p>
</blockquote>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="å›¾åƒæ»¤æ³¢å™¨">å›¾åƒæ»¤æ³¢å™¨</h2>
<p>ç®€å•å†™äº†ä¸€ä¸ªç”¨3X3å·ç§¯æ ¸å¯¹åŸå§‹å›¾åƒå¤„ç†çš„demoã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Document&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      #glcanvas {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">black</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;glcanvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      ä½ çš„æµè§ˆå™¨ä¼¼ä¹ä¸æ”¯æŒæˆ–è€…ç¦ç”¨äº† HTML5 &lt;<span style="color:#f92672">code</span>&gt;&amp;lt;canvas&amp;gt;&lt;/<span style="color:#f92672">code</span>&gt; å…ƒç´ ã€‚
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">canvas</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upload&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">div</span>&gt;3x3å·ç§¯æ ¸ï¼š&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>      /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">br</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>      /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">br</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> /&gt;&lt;<span style="color:#f92672">input</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>      /&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deal-image-btn&#34;</span>&gt;å›¾åƒå¤„ç†&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// åˆ›å»ºç€è‰²å™¨çš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">shaderSource</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">source</span>); <span style="color:#75715e">//ä¸ºç€è‰²å™¨å¯¹è±¡æä¾›æ•°æ®æºï¼Œå³æˆ‘ä»¬å†™çš„ç€è‰²å™¨ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">compileShader</span>(<span style="color:#a6e22e">shader</span>); <span style="color:#75715e">//ç¼–è¯‘ç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getShaderParameter</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COMPILE_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æˆåŠŸç¼–è¯‘åè¿”å›ç€è‰²å™¨å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shader</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// è®¡ç®—å˜æ¢çŸ©é˜µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#f92672">-</span><span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">y</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>        ];
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createProgram</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">vertexShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">linkProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getProgramParameter</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">LINK_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">deleteProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      precision mediump float;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰ä¸€ä¸ªçº¹ç†é‡‡æ ·å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform sampler2D u_image;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // ä¸€ä¸ªå›¾åƒåƒç´ å¯¹åº”çš„è£å‰ªç©ºé—´åæ ‡é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform vec2 u_onePixel;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰ä¸€ä¸ª3*3å·ç§¯æ ¸
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernel[9];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰æƒé‡ä¹‹å’Œï¼Œä¾¿äºå½’ä¸€åŒ–å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernelWeight;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topLeft=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 top=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topRight=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 left=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 center=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 right=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 leftBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 bottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 rightBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 colorSum=topLeft*u_kernel[0]+top*u_kernel[1]+topRight*u_kernel[2]+left*u_kernel[3]+center*u_kernel[4]+right*u_kernel[5]+leftBottom*u_kernel[6]+bottom*u_kernel[7]+rightBottom*u_kernel[8];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // è¿›è¡Œå·ç§¯è¿ç®— ä¸è®¡ç®—é€æ˜åº¦é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_FragColor=vec4(colorSum.rgb/u_kernelWeight,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // gl_FragColor=center; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// å›¾ç‰‡é“ºæ»¡æ•´ä¸ªcanvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vsSource2</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = vec4(a_position,0,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_texCoord=a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource</span>, <span style="color:#a6e22e">fsSource</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆ›å»ºç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vertexShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">VERTEX_SHADER</span>, <span style="color:#a6e22e">vsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fragmentShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAGMENT_SHADER</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// å°†ç€è‰²å™¨é“¾æ¥åˆ°ä¸€ä¸ªprogramç€è‰²ç¨‹åº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">useProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>, <span style="color:#a6e22e">dataArr</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">attributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">attributeLocation</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(<span style="color:#a6e22e">dataArr</span>),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">attributeLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initTexture2D</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">image</span>, <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">uniformName</span>, <span style="color:#a6e22e">unit</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æ¿€æ´»çº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">activeTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE0</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†çš„è¯¦ç»†çº§åˆ«ï¼Œ0æ˜¯åŸºæœ¬å›¾åƒï¼Œnæ˜¯ç¬¬nä¸ªé‡‘å­—å¡”ç®€åŒ–çº§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">internalformat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>; <span style="color:#75715e">//æŒ‡å®šçº¹ç†ä¸­çš„é¢œè‰²ç»„ä»¶ï¼Œè¿™é‡Œæ˜¯RGBAï¼Œæ¯ä¸ªåƒç´ æœ‰å››ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚è¡¨ç¤ºå…¶ä¸­ä¸€ä¸ªé¢œè‰²é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">image</span> <span style="color:#75715e">//å›¾åƒå¯ä»¥ä½œä¸ºçº¹ç†çš„åƒç´ æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// è®¾ç½®çº¹ç†é‡‡æ ·å™¨æ‰€ä½¿ç”¨çš„çº¹ç†å•å…ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imgLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">uniformName</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1i</span>(<span style="color:#a6e22e">imgLocation</span>, <span style="color:#a6e22e">unit</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">viewport</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clearColor</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>); <span style="color:#75715e">//è®¾ç½®æ¸…ç©ºé¢œè‰²
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_BUFFER_BIT</span>); <span style="color:#75715e">//æ¸…ç©ºç”»å¸ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">drawArrays</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">count</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getKernel</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">inputs</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#39;input[type=&#34;number&#34;]&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">inputs</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">input</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputs</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">kernel</span>.<span style="color:#a6e22e">push</span>(Number(<span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">kernel</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernel</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">prev</span>, <span style="color:#a6e22e">curr</span>) =&gt; <span style="color:#a6e22e">prev</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">curr</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">weight</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;glcanvas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>, { <span style="color:#a6e22e">preserveDrawingBuffer</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> });
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// ç¡®è®¤ WebGL æ”¯æŒæ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;æ— æ³•åˆå§‹åŒ– WebGLï¼Œä½ çš„æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿæˆ–ç¡¬ä»¶ç­‰å¯èƒ½ä¸æ”¯æŒ WebGLã€‚&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;ä¸æ”¯æŒgl&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">image</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;upload&#34;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">createObjectURL</span>(<span style="color:#a6e22e">file</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">url</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">program</span><span style="color:#f92672">=</span><span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">renderImage</span>(<span style="color:#a6e22e">image</span>,<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">revokeObjectURL</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>      document
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;deal-image-btn&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;click&#34;</span>, (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">renderImage</span>(<span style="color:#a6e22e">image</span>,<span style="color:#a6e22e">program</span>,<span style="color:#a6e22e">getKernel</span>());
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource2</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆå§‹åŒ–é¡¶ç‚¹åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v1</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v2</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v3</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v4</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_position&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v2</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v4</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆå§‹åŒ–çº¹ç†åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">two</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">four</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// å›¾åƒå¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">renderImage</span>(<span style="color:#a6e22e">image</span>,<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>]) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆå§‹åŒ–çº¹ç†é‡‡æ ·å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">initTexture2D</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">image</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_image&#34;</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆå§‹åŒ–å›¾ç‰‡ä¸Šä¸€ä¸ªåƒç´ çš„å•ä½é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_OnePixel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_onePixel&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform2f</span>(<span style="color:#a6e22e">u_OnePixel</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆå§‹åŒ–å·ç§¯æ ¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernel[0]&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1fv</span>(<span style="color:#a6e22e">u_kernel</span>, <span style="color:#a6e22e">kernel</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// è®¡ç®—æƒé‡ä¹‹å’Œï¼Œä»¥ä¾¿å½’ä¸€åŒ–å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernelWeight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernelWeight&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æƒé‡ä¹‹å’Œå°äºç­‰äº0æ—¶ï¼Œè®©å…¶ä¸º1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1f</span>(<span style="color:#a6e22e">u_kernelWeight</span>, <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689148718561-8a1cdd9e-a80e-4fd7-9cb0-82935eb489fc.png#averageHue=%23d9d8d8&amp;clientId=uab67cc43-4e29-4&amp;from=paste&amp;height=300&amp;id=utWb6&amp;originHeight=300&amp;originWidth=537&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=45066&amp;status=done&amp;style=none&amp;taskId=u75052460-6ebf-49c9-83f6-08c21929bde&amp;title=&amp;width=537" alt="image.png" loading="lazy" /></p>

<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="å¹³æ»‘æ»¤æ³¢">å¹³æ»‘æ»¤æ³¢</h3>
<p>å›¾åƒå¹³æ»‘æ˜¯ä¸€ç§å›¾åƒå¤„ç†æŠ€æœ¯ï¼Œç”¨äºå‡å°‘å›¾åƒä¸­çš„ç»†èŠ‚å’Œé«˜é¢‘ä¿¡æ¯ï¼Œä½¿å›¾åƒå˜å¾—æ¨¡ç³Šæˆ–æŸ”åŒ–ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<ol>
<li>å‡å€¼æ»¤æ³¢</li>
<li>ä¸­å€¼æ»¤æ³¢</li>
<li>é«˜æ–¯æ»¤æ³¢
<!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ol>
<h4 id="å‡å€¼æ»¤æ³¢">å‡å€¼æ»¤æ³¢</h4>
<p>é€‰ç”¨3X3çš„å·ç§¯æ ¸è¿›è¡Œè®¡ç®—ï¼Œæ–°çš„åƒç´ ä¸ºé‚»åŸŸèŒƒå›´å†…æ‰€æœ‰çš„åƒç´ ä¸çŸ©é˜µå¯¹åº”ç›¸ä¹˜<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689127623433-4b554fbc-f003-422e-b2bb-5e1cd1c4e7bf.png#averageHue=%23c8c8c8&amp;clientId=u688450fe-eea9-4&amp;from=paste&amp;id=u0deca1e9&amp;originHeight=100&amp;originWidth=100&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=3132&amp;status=done&amp;style=none&amp;taskId=ufb7f2f6e-1cec-42cd-99f3-df99d96836b&amp;title=" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->ä¿®æ”¹ä¸€ä¸‹ç‰‡æ®µç€è‰²å™¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">precision</span> <span style="color:#66d9ef">mediump</span> <span style="color:#66d9ef">float</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å®šä¹‰ä¸€ä¸ªçº¹ç†é‡‡æ ·å™¨</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">sampler2D</span> u_image;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ä¸€ä¸ªå›¾åƒåƒç´ å¯¹åº”çš„è£å‰ªç©ºé—´åæ ‡é•¿åº¦</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">vec2</span> u_onePixel;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å®šä¹‰ä¸€ä¸ª3*3å·ç§¯æ ¸</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">float</span> u_kernel[<span style="color:#ae81ff">9</span>];
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å®šä¹‰æƒé‡ä¹‹å’Œï¼Œä¾¿äºå½’ä¸€åŒ–å¤„ç†</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> <span style="color:#66d9ef">float</span> u_kernelWeight;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">varying</span> <span style="color:#66d9ef">vec2</span> v_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main(){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> topLeft<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> top<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> topRight<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">1</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> left<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> center<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> right<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> leftBottom<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> bottom<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> rightBottom<span style="color:#f92672">=</span>texture2D(u_image,v_texCoord <span style="color:#f92672">+</span> u_onePixel <span style="color:#f92672">*</span> <span style="color:#66d9ef">vec2</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec4</span> colorSum<span style="color:#f92672">=</span>topLeft<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">+</span>top<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">+</span>topRight<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">+</span>left<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">+</span>center<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">4</span>]<span style="color:#f92672">+</span>right<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">5</span>]<span style="color:#f92672">+</span>leftBottom<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">6</span>]<span style="color:#f92672">+</span>bottom<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">7</span>]<span style="color:#f92672">+</span>rightBottom<span style="color:#f92672">*</span>u_kernel[<span style="color:#ae81ff">8</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// è¿›è¡Œå·ç§¯è¿ç®— ä¸è®¡ç®—é€æ˜åº¦é€šé“</span>
</span></span><span style="display:flex;"><span>  gl_FragColor<span style="color:#f92672">=</span><span style="color:#66d9ef">vec4</span>(colorSum.rgb<span style="color:#f92672">/</span>u_kernelWeight,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// gl_FragColor=center; </span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è®¾ç½®å·ç§¯æ ¸ä»¥åŠæƒé‡å½’ä¸€åŒ–</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// åˆå§‹åŒ–å·ç§¯æ ¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernel</span><span style="color:#f92672">=</span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>,<span style="color:#e6db74">&#39;u_kernel[0]&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernel</span><span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1fv</span>(<span style="color:#a6e22e">u_kernel</span>,<span style="color:#a6e22e">kernel</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è®¡ç®—æƒé‡ä¹‹å’Œï¼Œä»¥ä¾¿å½’ä¸€åŒ–å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernelWeight</span><span style="color:#f92672">=</span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>,<span style="color:#e6db74">&#39;u_kernelWeight&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// æƒé‡ä¹‹å’Œå°äºç­‰äº0æ—¶ï¼Œè®©å…¶ä¸º1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span><span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>]){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">weight</span><span style="color:#f92672">=</span><span style="color:#a6e22e">kernel</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">prev</span>,<span style="color:#a6e22e">curr</span>)=&gt;<span style="color:#a6e22e">prev</span><span style="color:#f92672">+</span><span style="color:#a6e22e">curr</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">weight</span><span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">?</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">weight</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1f</span>(<span style="color:#a6e22e">u_kernelWeight</span>,<span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span>))
</span></span></code></pre></div><p>
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689131566484-19ae0241-8859-4bed-b096-fd7fe13b6239.png#averageHue=%23fafdfd&amp;clientId=u688450fe-eea9-4&amp;from=paste&amp;height=227&amp;id=uffcda12b&amp;originHeight=227&amp;originWidth=230&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=37122&amp;status=done&amp;style=none&amp;taskId=ua493d68c-a4fc-4968-a7e6-bf2c5961fd4&amp;title=&amp;width=230" alt="image.png" loading="lazy" /></p>

<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h4 id="ä¸­å€¼æ»¤æ³¢">ä¸­å€¼æ»¤æ³¢</h4>
<p>ä¸­å€¼æ»¤æ³¢èƒ½æœ‰æ•ˆå»é™¤å™ªå£°çš„åŒæ—¶ï¼Œèƒ½ä¿ç•™åŸå›¾åƒçš„ç»†èŠ‚
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="ç´¯åŠ å›¾åƒå¤„ç†">ç´¯åŠ å›¾åƒå¤„ç†</h2>
<p>æœ‰æ—¶å€™éœ€è¦å¯¹å›¾åƒç”¨å¤šä¸ªæ»¤æ³¢å™¨è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼ˆä»¿å†™çš„webglfundamentalsçš„ä¾‹å­ï¼‰ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Document&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      #glcanvas {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">black</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;glcanvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      ä½ çš„æµè§ˆå™¨ä¼¼ä¹ä¸æ”¯æŒæˆ–è€…ç¦ç”¨äº† HTML5 &lt;<span style="color:#f92672">code</span>&gt;&amp;lt;canvas&amp;gt;&lt;/<span style="color:#f92672">code</span>&gt; å…ƒç´ ã€‚
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">canvas</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upload&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox-container&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deal-image-btn&#34;</span>&gt;å›¾åƒå¤„ç†&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// åˆ›å»ºç€è‰²å™¨çš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">shaderSource</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">source</span>); <span style="color:#75715e">//ä¸ºç€è‰²å™¨å¯¹è±¡æä¾›æ•°æ®æºï¼Œå³æˆ‘ä»¬å†™çš„ç€è‰²å™¨ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">compileShader</span>(<span style="color:#a6e22e">shader</span>); <span style="color:#75715e">//ç¼–è¯‘ç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getShaderParameter</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COMPILE_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æˆåŠŸç¼–è¯‘åè¿”å›ç€è‰²å™¨å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shader</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// è®¡ç®—å˜æ¢çŸ©é˜µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getMat3</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#f92672">-</span><span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">x</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">w</span>,
</span></span><span style="display:flex;"><span>          (<span style="color:#ae81ff">2.0</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">y</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>        ];
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createProgram</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">vertexShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">linkProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getProgramParameter</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">LINK_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">deleteProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      precision mediump float;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰ä¸€ä¸ªçº¹ç†é‡‡æ ·å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform sampler2D u_image;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // ä¸€ä¸ªå›¾åƒåƒç´ å¯¹åº”çš„è£å‰ªç©ºé—´åæ ‡é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform vec2 u_onePixel;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰ä¸€ä¸ª3*3å·ç§¯æ ¸
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernel[9];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰æƒé‡ä¹‹å’Œï¼Œä¾¿äºå½’ä¸€åŒ–å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernelWeight;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topLeft=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 top=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topRight=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 left=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 center=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 right=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 leftBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 bottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 rightBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 colorSum=topLeft*u_kernel[0]+top*u_kernel[1]+topRight*u_kernel[2]+left*u_kernel[3]+center*u_kernel[4]+right*u_kernel[5]+leftBottom*u_kernel[6]+bottom*u_kernel[7]+rightBottom*u_kernel[8];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // è¿›è¡Œå·ç§¯è¿ç®— ä¸è®¡ç®—é€æ˜åº¦é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_FragColor=vec4(colorSum.rgb/u_kernelWeight,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // gl_FragColor=center; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// å›¾ç‰‡é“ºæ»¡æ•´ä¸ªcanvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vsSource2</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = vec4(a_position,0,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_texCoord=a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource</span>, <span style="color:#a6e22e">fsSource</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆ›å»ºç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vertexShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">VERTEX_SHADER</span>, <span style="color:#a6e22e">vsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fragmentShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAGMENT_SHADER</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// å°†ç€è‰²å™¨é“¾æ¥åˆ°ä¸€ä¸ªprogramç€è‰²ç¨‹åº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">useProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>, <span style="color:#a6e22e">dataArr</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">attributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">attributeLocation</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(<span style="color:#a6e22e">dataArr</span>),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">attributeLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">viewport</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clearColor</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>); <span style="color:#75715e">//è®¾ç½®æ¸…ç©ºé¢œè‰²
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_BUFFER_BIT</span>); <span style="color:#75715e">//æ¸…ç©ºç”»å¸ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">drawArrays</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">count</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernel</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">prev</span>, <span style="color:#a6e22e">curr</span>) =&gt; <span style="color:#a6e22e">prev</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">curr</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">weight</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;glcanvas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>, { <span style="color:#a6e22e">preserveDrawingBuffer</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> });
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// ç¡®è®¤ WebGL æ”¯æŒæ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;æ— æ³•åˆå§‹åŒ– WebGLï¼Œä½ çš„æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿæˆ–ç¡¬ä»¶ç­‰å¯èƒ½ä¸æ”¯æŒ WebGLã€‚&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;ä¸æ”¯æŒgl&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// çº¹ç†å•å…ƒ0åªæ˜¯å¯¹çº¹ç†å¯¹è±¡çš„å¼•ç”¨ï¼Œæ¯æ¬¡åˆ›å»ºå…¶å¼•ç”¨éƒ½ä¼šæŒ‡å‘æœ€æ–°çš„çº¹ç†å¯¹è±¡ï¼Œè€Œä¸æ˜¯çº¹ç†å¯¹è±¡å‘ç”Ÿå˜åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">tex</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// å®šä¹‰ä¸€äº›å·ç§¯æ ¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernels</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">normal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.332</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur2</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur3</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">unsharpen</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">9</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sharpness</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sharpen</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">16</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect2</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect3</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect4</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect5</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect6</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">39</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sobelHorizontal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sobelVertical</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">previtHorizontal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">previtVertical</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">boxBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">triangleBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">emboss</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// è¦ä½¿ç”¨çš„æ•ˆæœåˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">effectsToApply</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">kernels</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// åˆå§‹åŒ–å„ç§æ•ˆæœ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">template</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">effectsToApply</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">map</span>(
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;label&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;input type=&#34;checkbox&#34; value=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">item</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">item</span><span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/label&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;checkbox-container&#34;</span>).<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">template</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">originalTexture</span>, <span style="color:#a6e22e">image</span>;
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;upload&#34;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">createObjectURL</span>(<span style="color:#a6e22e">file</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">url</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// åˆå§‹åŒ–ç¨‹åºå¹¶è®¾ç½®çº¹ç†åæ ‡ï¼Œé¡¶ç‚¹åæ ‡ç­‰å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// åˆ›å»ºä¸€ä¸ªçº¹ç†ç”¨äºå­˜æ”¾åŸå§‹å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">originalTexture</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_OnePixel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_onePixel&#34;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform2f</span>(<span style="color:#a6e22e">u_OnePixel</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernels</span>[<span style="color:#e6db74">&#34;normal&#34;</span>]);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">getCheckedValues</span>());
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">revokeObjectURL</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernel</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernel[0]&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1fv</span>(<span style="color:#a6e22e">u_kernel</span>, <span style="color:#a6e22e">kernel</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernelWeight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernelWeight&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1f</span>(<span style="color:#a6e22e">u_kernelWeight</span>, <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span>));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">kernelNames</span> <span style="color:#f92672">=</span> []) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆ›å»ºä¸¤ä¸ªç©ºçº¹ç†å¯¹è±¡ç”¨äºå¯¹åŒä¸€ä¸ªå›¾åƒè¿›è¡Œå åŠ å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">textures</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ä¸¤ä¸ªå¸§ç¼“å†²ï¼Œç”¨äºå­˜å‚¨ç»˜åˆ¶çš„ç»“æœï¼Œå¸§ç¼“å†²ä¸å­˜å‚¨é¢œè‰²ä¿¡æ¯ï¼Œæ·±åº¦ä¿¡æ¯ï¼Œéœ€è¦é çº¹ç†ç­‰æ¥å­˜å‚¨ï¼Œå…¶åªå¼•ç”¨åˆ°å®ƒä»¬
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">framebuffers</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texture</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">textures</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">texture</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// åˆ›å»ºç©ºçš„å¸§ç¼“å†²åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fbo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createFramebuffer</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">framebuffers</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// å°†fboå…³è”åˆ°GPUçš„textureå¯¹è±¡ä¸Šï¼Œç»˜åˆ¶æ—¶ç›´æ¥ç»˜åˆ¶é¢œè‰²ä¿¡æ¯åˆ°çº¹ç†ä¸Š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">framebufferTexture2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_ATTACHMENT0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">texture</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ç»‘å®šçº¹ç†å•å…ƒ0ä¸åˆå§‹å›¾åƒçš„çº¹ç†,å³ç¬¬ä¸€æ¬¡ç»˜åˆ¶åŸå§‹å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">originalTexture</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">kernelNames</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">fbo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">framebuffers</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernels</span>[<span style="color:#a6e22e">kernelNames</span>[<span style="color:#a6e22e">i</span>]];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernel</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// ç»˜åˆ¶åˆ°å¸§ç¼“å†²
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// å°†å½“å‰çš„ç»˜åˆ¶ç»“æœä½œä¸ºä¸‹ä¸€æ¬¡ç»˜åˆ¶çš„çº¹ç†æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">textures</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ç»˜åˆ¶æœ€ç»ˆç»“æœåˆ°canvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getCheckedValues</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">checkdboxes</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;#checkbox-container input&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">checkdboxes</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">checkdboxes</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">checked</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">checkdboxes</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">checked</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">checked</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">values</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      document
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;checkbox-container&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">getCheckedValues</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// æ¯ä¸€æ¬¡ç”»ä¹‹å‰ï¼Œæ¸…é™¤ä¸Šä¸€æ¬¡çš„å·ç§¯æ ¸ï¼Œé˜²æ­¢æ²¡æœ‰å‹¾é€‰å†…å®¹æ—¶ï¼Œä»ä½¿ç”¨ä¸Šä¸€ä¸ªå·ç§¯æ ¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernels</span>[<span style="color:#e6db74">&#39;normal&#39;</span>])
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">values</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource2</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆå§‹åŒ–é¡¶ç‚¹åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v1</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v2</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v3</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v4</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_position&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v2</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v4</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆå§‹åŒ–çº¹ç†åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">two</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">four</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>å¯¹éœ€è¦ç´¯åŠ å¤„ç†çš„å›¾åƒï¼Œéœ€è¦è®°å½•å…¶æ¯æ¬¡çš„ç»“æœä½œä¸ºåä¸€æ¬¡çš„æ•°æ®æºã€‚è¿™é‡Œä½¿ç”¨<code>Framebuffer</code>å¸§ç¼“å†²æ¥è®°å½•ä¸­é—´ç»“æœï¼ˆå¸§ç¼“å†²æœ¬èº«ä¸èƒ½ç›´æ¥å­˜å‚¨é¢œè‰²ã€æ·±åº¦ä¿¡æ¯ï¼Œéœ€è¦å’Œçº¹ç†ç­‰é…åˆä½¿ç”¨ï¼Œå®é™…æ˜¯æ¸²æŸ“åˆ°çº¹ç†ï¼‰ã€‚å¦åˆ™å¯èƒ½å°±åƒå‰é¢å†™çš„3X3æ»¤æ³¢å™¨çš„ä¾‹å­ä¸­ä¸€æ ·ï¼Œé€šè¿‡è·å–canvasçš„urlæ¥è®°å½•æ¯æ¬¡çš„ä¿¡æ¯ã€‚<!-- raw HTML omitted -->å¸§ç¼“å†²å™¨çš„ä½¿ç”¨æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå¸§ç¼“å†²å¯¹è±¡<code>gl.createFramebuffer()</code></li>
<li>å°†å¸§ç¼“å†²å¯¹è±¡ä¸ç»‘å®šç›®æ ‡ç›¸å…³è”<code>gl.bindFramebuffer(target,fbo)</code>
<ul>
<li>target ç»‘å®šç›®æ ‡
<ul>
<li><code>gl.FRAMEBUFFER</code>ç»‘å®šå¸§ç¼“å†²å¯¹è±¡</li>
<li><code>gl.DRAW_FRAMEBUFFER</code>ç»‘å®šå¸§ç¼“å†²å¯¹è±¡ä½œä¸ºç»˜åˆ¶ç›®æ ‡</li>
</ul>
</li>
</ul>
</li>
<li>å°†å¸§ç¼“å†²å¯¹è±¡å’Œçº¹ç†å¯¹è±¡ç›¸å…³è”<code>gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0)</code></li>
<li>ç»˜åˆ¶å›¾åƒåˆ°å¸§ç¼“å†²åŒºå¯¹åº”çš„çº¹ç†ä¸­ï¼Œ<code>gl.drawArrays()</code></li>
</ol>
<p>è¿™é‡Œä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå³ä½¿ç”¨å¸§ç¼“å†²å¯¹è±¡çš„çº¹ç†ç»˜åˆ¶å‡ºçš„å›¾åƒä¼šé¢ å€’ï¼Œä½¿ç”¨åŸå§‹å›¾åƒä¸ºçº¹ç†åˆ™ä¸ä¼šã€‚<!-- raw HTML omitted -->
  <figure class="figure-image">
    <img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689323436286-fb2086f6-7d08-4155-ab56-1cd8e35d0e8f.png#averageHue=%23f9f7f6&amp;clientId=ud8e797fa-61d1-4&amp;from=paste&amp;height=609&amp;id=ub01b7b2c&amp;originHeight=609&amp;originWidth=331&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=56278&amp;status=done&amp;style=none&amp;taskId=u60f6434d-7cdc-4656-b785-285f2c3567f&amp;title=%E5%8E%9F%E5%A7%8B%E5%9B%BE%E5%83%8F&amp;width=331" title="åŸå§‹å›¾åƒ" alt="åŸå§‹å›¾åƒ" loading="lazy" />
    <figcaption>åŸå§‹å›¾åƒ</figcaption>
  </figure>

  <figure class="figure-image">
    <img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689323506039-c6a58685-c420-4159-ac24-bd56496764e1.png#averageHue=%23f9f8f6&amp;clientId=ud8e797fa-61d1-4&amp;from=paste&amp;height=617&amp;id=u0c0df7aa&amp;originHeight=617&amp;originWidth=357&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=56342&amp;status=done&amp;style=none&amp;taskId=u79f3b92a-3761-41e8-8802-7b98a3d0f15&amp;title=%E5%B8%A7%E7%BC%93%E5%86%B2%E4%B8%BA%E7%BA%B9%E7%90%86%E6%95%B0%E6%8D%AE%E6%BA%90&amp;width=357" title="å¸§ç¼“å†²ä¸ºçº¹ç†æ•°æ®æº" alt="å¸§ç¼“å†²ä¸ºçº¹ç†æ•°æ®æº" loading="lazy" />
    <figcaption>å¸§ç¼“å†²ä¸ºçº¹ç†æ•°æ®æº</figcaption>
  </figure>
<!-- raw HTML omitted -->æ¨æµ‹è¿™å¤šåŠæ˜¯ç”±äºç»˜åˆ¶çº¹ç†ç©ºé—´çš„åæ ‡ç³»ä¸ä¸€è‡´å¼•èµ·çš„ï¼Œå¸§ç¼“å†²å¯¹è±¡çš„çº¹ç†åæ ‡ç³»æ˜¯æ­£å¸¸çº¹ç†ç©ºé—´åæ ‡ç³»ï¼Œåæ ‡ç³»åŸç‚¹åœ¨å·¦ä¸‹è§’ï¼Œè€Œä½¿ç”¨å›¾åƒæ•°æ®ç”Ÿæˆçš„åˆå§‹çº¹ç†çš„åæ ‡ç³»æ˜¯å’Œå›¾åƒåæ ‡ç³»ä¸€è‡´çš„åŸç‚¹åœ¨å·¦ä¸Šè§’ï¼Œå› æ­¤æ‰ä¼šå¯¼è‡´åœ¨é€‰ä¸­å¥‡æ•°ä¸ªçš„æ»¤æ³¢å™¨æ—¶ï¼Œå›¾åƒç¿»è½¬äº†ï¼ˆé€‰ä¸­å¶æ•°ä¸ªåˆšå¥½è´Ÿè´Ÿå¾—æ­£ï¼‰ã€‚<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689324721210-722af6db-ec61-4937-ad63-e2fd85c5b1bc.png#averageHue=%23fdfdfd&amp;clientId=ud8e797fa-61d1-4&amp;from=paste&amp;height=603&amp;id=u008c54a2&amp;originHeight=603&amp;originWidth=515&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=15656&amp;status=done&amp;style=none&amp;taskId=u5c96c399-7f4f-48ab-a2fd-6802496afe7&amp;title=&amp;width=515" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->å› æ­¤åœ¨ä½¿ç”¨å¸§ç¼“å†²ç»˜åˆ¶å›¾åƒçš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œä¸€ä¸ªåæ ‡è½¬æ¢å°†å›¾åƒåæ ‡è½¬ä¸ºçº¹ç†ç©ºé—´åæ ‡ï¼ˆå› ä¸ºå‰é¢ä½¿ç”¨çš„æ˜¯å›¾åƒåæ ‡ï¼‰ï¼Œç®€å•çš„å¹³ç§»å†ç¿»è½¬ï¼Œç”¨ä¸€ä¸ªçŸ©é˜µæ¥è¡¨è¾¾å°±æ˜¯ï¼š<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/__latex/6bab1461a7e46c36a793b6fe4d529c70.svg#card=math&amp;code=%5Cbegin%7Bbmatrix%7Ds%5C%5Ct%5C%5C1%5Cend%7Bbmatrix%7D%3D%0A%5Cbegin%7Bbmatrix%7D1%260%260%5C%5C0%26-1%261%5C%5C0%260%261%5Cend%7Bbmatrix%7D%0A%2A%5Cbegin%7Bbmatrix%7Dx%5C%5Cy%5C%5C1%5Cend%7Bbmatrix%7D%3D%0A%5Cbegin%7Bbmatrix%7Dx%5C%5C1-y%5C%5C1%5Cend%7Bbmatrix%7D&amp;id=l14ks" alt="" loading="lazy" /></p>
<!-- raw HTML omitted -->å› æ­¤åªéœ€è¦åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­åŠ ä¸€ä¸ªè½¬æ¢çŸ©é˜µå°±å¯ä»¥äº†ï¼Œå°†çº¹ç†åæ ‡è½¬æ¢ä¸€ä¸‹ã€‚å°å°ä¿®æ”¹ä¸‹é¡¶ç‚¹ç€è‰²å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">attribute</span> <span style="color:#66d9ef">vec2</span> a_position;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">attribute</span> <span style="color:#66d9ef">vec2</span> a_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uniform</span> mat3 u_picToTex;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">varying</span> <span style="color:#66d9ef">vec2</span> v_texCoord;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main(){
</span></span><span style="display:flex;"><span>  gl_Position <span style="color:#f92672">=</span> <span style="color:#66d9ef">vec4</span>(a_position,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">vec3</span> texCoord<span style="color:#f92672">=</span>u_picToTex<span style="color:#f92672">*</span><span style="color:#66d9ef">vec3</span>(a_texCoord,<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  v_texCoord<span style="color:#f92672">=</span>texCoord.xy;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç®€å•å†™ä¸€ä¸ªç”¨äºè®¾ç½®å˜æ¢çŸ©é˜µçš„å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// å›¾åƒåæ ‡ç³»åˆ°çº¹ç†åæ ‡ç³»çš„è½¬æ¢çŸ©é˜µ æ³¨æ„åˆ—ä¼˜å…ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">picToTexMat</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ä¸å‘ç”Ÿä»»ä½•å˜æ¢çš„å•ä½çŸ©é˜µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mat3Unit</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">mat</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_picToTex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_picToTex&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniformMatrix3fv</span>(<span style="color:#a6e22e">u_picToTex</span>, <span style="color:#66d9ef">false</span>, <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(<span style="color:#a6e22e">mat</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åœ¨å¤„ç†å›¾åƒçš„æ–¹æ³•é‡Œä½¿ç”¨è¯¥å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// ç»‘å®šçº¹ç†å•å…ƒ0ä¸åˆå§‹å›¾åƒçš„çº¹ç†,å³ç¬¬ä¸€æ¬¡ç»˜åˆ¶åŸå§‹å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">originalTexture</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ç»˜åˆ¶åŸå§‹å›¾åƒæ—¶ï¼Œç”¨æ ‡å‡†çŸ©é˜µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">mat3Unit</span>)<span style="color:#75715e">//*******************
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">kernelNames</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">fbo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">framebuffers</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernels</span>[<span style="color:#a6e22e">kernelNames</span>[<span style="color:#a6e22e">i</span>]];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernel</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ç»˜åˆ¶åˆ°å¸§ç¼“å†²
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// å°†å½“å‰çš„ç»˜åˆ¶ç»“æœä½œä¸ºä¸‹ä¸€æ¬¡ç»˜åˆ¶çš„çº¹ç†æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">textures</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// åç»­æ¯æ¬¡ç»˜åˆ¶ä½¿ç”¨ç¿»è½¬çŸ©é˜µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">picToTexMat</span>)<span style="color:#75715e">//*********************
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ç»˜åˆ¶æœ€ç»ˆç»“æœåˆ°canvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span></code></pre></div><p>è¿™æ ·å°±ä¸ä¼šå‘ç”Ÿç¿»è½¬äº†ï¼Œä¹Ÿè¯å®å‰é¢çš„æ¨æµ‹æ˜¯æ­£ç¡®çš„ã€‚<!-- raw HTML omitted -->
  <p><img src="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689327237048-2457ca1c-065a-44f7-915f-b8df0990aa62.png#averageHue=%23dbd8d7&amp;clientId=u3b9209fa-a3fa-4&amp;from=paste&amp;height=615&amp;id=u13117d9d&amp;originHeight=615&amp;originWidth=315&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=26503&amp;status=done&amp;style=none&amp;taskId=u260436d4-24b3-4c07-899a-fba3b862724&amp;title=&amp;width=315" alt="image.png" loading="lazy" /></p>
<!-- raw HTML omitted -->ä¸‹é¢æ˜¯æ–°çš„å®Œæ•´ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#f92672">&lt;!</span><span style="color:#a6e22e">DOCTYPE</span> <span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">head</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">title</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Document</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/title&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">style</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">margin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">padding</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">glcanvas</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">border</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span><span style="color:#a6e22e">px</span> <span style="color:#a6e22e">solid</span> <span style="color:#a6e22e">black</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/style&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/head&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">body</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;glcanvas&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;250&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">ä½ çš„æµè§ˆå™¨ä¼¼ä¹ä¸æ”¯æŒæˆ–è€…ç¦ç”¨äº†</span> <span style="color:#a6e22e">HTML5</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">code</span><span style="color:#f92672">&gt;&amp;</span><span style="color:#a6e22e">lt</span>;<span style="color:#a6e22e">canvas</span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gt</span>;<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/code&gt; å…ƒç´ ã€‚</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/canvas&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upload&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox-container&#34;</span><span style="color:#f92672">&gt;&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// åˆ›å»ºç€è‰²å™¨çš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">source</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">shaderSource</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">source</span>); <span style="color:#75715e">//ä¸ºç€è‰²å™¨å¯¹è±¡æä¾›æ•°æ®æºï¼Œå³æˆ‘ä»¬å†™çš„ç€è‰²å™¨ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">compileShader</span>(<span style="color:#a6e22e">shader</span>); <span style="color:#75715e">//ç¼–è¯‘ç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getShaderParameter</span>(<span style="color:#a6e22e">shader</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COMPILE_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æˆåŠŸç¼–è¯‘åè¿”å›ç€è‰²å™¨å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">shader</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createProgram</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">vertexShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">attachShader</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">linkProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getProgramParameter</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">LINK_STATUS</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">success</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">deleteProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fsSource</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      precision mediump float;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰ä¸€ä¸ªçº¹ç†é‡‡æ ·å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform sampler2D u_image;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // ä¸€ä¸ªå›¾åƒåƒç´ å¯¹åº”çš„è£å‰ªç©ºé—´åæ ‡é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform vec2 u_onePixel;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰ä¸€ä¸ª3*3å·ç§¯æ ¸
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernel[9];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      // å®šä¹‰æƒé‡ä¹‹å’Œï¼Œä¾¿äºå½’ä¸€åŒ–å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform float u_kernelWeight;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topLeft=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 top=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 topRight=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,-1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 left=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 center=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 right=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,0));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 leftBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(-1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 bottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(0,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 rightBottom=texture2D(u_image,v_texCoord + u_onePixel * vec2(1,1));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec4 colorSum=topLeft*u_kernel[0]+top*u_kernel[1]+topRight*u_kernel[2]+left*u_kernel[3]+center*u_kernel[4]+right*u_kernel[5]+leftBottom*u_kernel[6]+bottom*u_kernel[7]+rightBottom*u_kernel[8];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // è¿›è¡Œå·ç§¯è¿ç®— ä¸è®¡ç®—é€æ˜åº¦é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_FragColor=vec4(colorSum.rgb/u_kernelWeight,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        // gl_FragColor=center; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// å›¾ç‰‡é“ºæ»¡æ•´ä¸ªcanvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vsSource2</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_position;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      attribute vec2 a_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      uniform mat3 u_picToTex;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      varying vec2 v_texCoord;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      void main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gl_Position = vec4(a_position,0,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vec3 texCoord=u_picToTex*vec3(a_texCoord,1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        v_texCoord=texCoord.xy;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource</span>, <span style="color:#a6e22e">fsSource</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆ›å»ºç€è‰²å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vertexShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">VERTEX_SHADER</span>, <span style="color:#a6e22e">vsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fragmentShader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createShader</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAGMENT_SHADER</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// å°†ç€è‰²å™¨é“¾æ¥åˆ°ä¸€ä¸ªprogramç€è‰²ç¨‹åº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vertexShader</span>, <span style="color:#a6e22e">fragmentShader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">useProgram</span>(<span style="color:#a6e22e">program</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>, <span style="color:#a6e22e">dataArr</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">attributeLocation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">attrName</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">enableVertexAttribArray</span>(<span style="color:#a6e22e">attributeLocation</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buffer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createBuffer</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindBuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>, <span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bufferData</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">ARRAY_BUFFER</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(<span style="color:#a6e22e">dataArr</span>),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">STATIC_DRAW</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttribPointer</span>(<span style="color:#a6e22e">attributeLocation</span>, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FLOAT</span>, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">count</span>, <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">viewport</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clearColor</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>); <span style="color:#75715e">//è®¾ç½®æ¸…ç©ºé¢œè‰²
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_BUFFER_BIT</span>); <span style="color:#75715e">//æ¸…ç©ºç”»å¸ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">drawArrays</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">count</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernel</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">prev</span>, <span style="color:#a6e22e">curr</span>) =&gt; <span style="color:#a6e22e">prev</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">curr</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">weight</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">weight</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;glcanvas&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>, { <span style="color:#a6e22e">preserveDrawingBuffer</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> });
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// ç¡®è®¤ WebGL æ”¯æŒæ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;æ— æ³•åˆå§‹åŒ– WebGLï¼Œä½ çš„æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿæˆ–ç¡¬ä»¶ç­‰å¯èƒ½ä¸æ”¯æŒ WebGLã€‚&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;ä¸æ”¯æŒgl&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createTexture</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// çº¹ç†å•å…ƒ0åªæ˜¯å¯¹çº¹ç†å¯¹è±¡çš„å¼•ç”¨ï¼Œæ¯æ¬¡åˆ›å»ºå…¶å¼•ç”¨éƒ½ä¼šæŒ‡å‘æœ€æ–°çš„çº¹ç†å¯¹è±¡ï¼Œè€Œä¸æ˜¯çº¹ç†å¯¹è±¡å‘ç”Ÿå˜åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">tex</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_S</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_WRAP_T</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">CLAMP_TO_EDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MIN_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texParameteri</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_MAG_FILTER</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">NEAREST</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">tex</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// å®šä¹‰ä¸€äº›å·ç§¯æ ¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernels</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">normal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.332</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>, <span style="color:#ae81ff">0.122</span>, <span style="color:#ae81ff">0.045</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur2</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gaussianBlur3</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">unsharpen</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">9</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sharpness</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sharpen</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">16</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.125</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect2</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect3</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect4</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect5</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">edgeDetect6</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">39</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sobelHorizontal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sobelVertical</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">previtHorizontal</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">previtVertical</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">boxBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>, <span style="color:#ae81ff">0.111</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">triangleBlur</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>, <span style="color:#ae81ff">0.125</span>, <span style="color:#ae81ff">0.0625</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">emboss</span><span style="color:#f92672">:</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// è¦ä½¿ç”¨çš„æ•ˆæœåˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">effectsToApply</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">kernels</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// åˆå§‹åŒ–å„ç§æ•ˆæœ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">template</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">effectsToApply</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">map</span>(
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;label&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;input type=&#34;checkbox&#34; value=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">item</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">item</span><span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/label&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      `</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;checkbox-container&#34;</span>).<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">template</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">program</span>, <span style="color:#a6e22e">originalTexture</span>, <span style="color:#a6e22e">image</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;upload&#34;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">createObjectURL</span>(<span style="color:#a6e22e">file</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">url</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// åˆå§‹åŒ–ç¨‹åºå¹¶è®¾ç½®çº¹ç†åæ ‡ï¼Œé¡¶ç‚¹åæ ‡ç­‰å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// åˆ›å»ºä¸€ä¸ªçº¹ç†ç”¨äºå­˜æ”¾åŸå§‹å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">originalTexture</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_OnePixel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_onePixel&#34;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform2f</span>(<span style="color:#a6e22e">u_OnePixel</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernels</span>[<span style="color:#e6db74">&#34;normal&#34;</span>]);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">getCheckedValues</span>());
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">revokeObjectURL</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernel</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernel[0]&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1fv</span>(<span style="color:#a6e22e">u_kernel</span>, <span style="color:#a6e22e">kernel</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_kernelWeight</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_kernelWeight&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform1f</span>(<span style="color:#a6e22e">u_kernelWeight</span>, <span style="color:#a6e22e">computeKernelWeight</span>(<span style="color:#a6e22e">kernel</span>));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// å›¾åƒåæ ‡ç³»åˆ°çº¹ç†åæ ‡ç³»çš„è½¬æ¢çŸ©é˜µ æ³¨æ„åˆ—ä¼˜å…ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">picToTexMat</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// ä¸å‘ç”Ÿä»»ä½•å˜æ¢çš„å•ä½çŸ©é˜µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mat3Unit</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">mat</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">u_picToTex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;u_picToTex&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniformMatrix3fv</span>(<span style="color:#a6e22e">u_picToTex</span>, <span style="color:#66d9ef">false</span>, <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Float32Array</span>(<span style="color:#a6e22e">mat</span>));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">kernelNames</span> <span style="color:#f92672">=</span> []) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆ›å»ºä¸¤ä¸ªç©ºçº¹ç†å¯¹è±¡ç”¨äºå¯¹åŒä¸€ä¸ªå›¾åƒè¿›è¡Œå åŠ å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">textures</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ä¸¤ä¸ªå¸§ç¼“å†²ï¼Œç”¨äºå­˜å‚¨ç»˜åˆ¶çš„ç»“æœï¼Œå¸§ç¼“å†²ä¸å­˜å‚¨é¢œè‰²ä¿¡æ¯ï¼Œæ·±åº¦ä¿¡æ¯ï¼Œéœ€è¦é çº¹ç†ç­‰æ¥å­˜å‚¨ï¼Œå…¶åªå¼•ç”¨åˆ°å®ƒä»¬
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">framebuffers</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">texture</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createTexture</span>(<span style="color:#a6e22e">gl</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">texImage2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">RGBA</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">UNSIGNED_BYTE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">textures</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">texture</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// åˆ›å»ºç©ºçš„å¸§ç¼“å†²åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fbo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">createFramebuffer</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">framebuffers</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// å°†fboå…³è”åˆ°GPUçš„textureå¯¹è±¡ä¸Šï¼Œç»˜åˆ¶æ—¶ç›´æ¥ç»˜åˆ¶é¢œè‰²ä¿¡æ¯åˆ°çº¹ç†ä¸Š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">framebufferTexture2D</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">COLOR_ATTACHMENT0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">texture</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ç»‘å®šçº¹ç†å•å…ƒ0ä¸åˆå§‹å›¾åƒçš„çº¹ç†,å³ç¬¬ä¸€æ¬¡ç»˜åˆ¶åŸå§‹å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">originalTexture</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ç»˜åˆ¶åŸå§‹å›¾åƒæ—¶ï¼Œç”¨æ ‡å‡†çŸ©é˜µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">mat3Unit</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">kernelNames</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">fbo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">framebuffers</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#a6e22e">fbo</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">kernel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">kernels</span>[<span style="color:#a6e22e">kernelNames</span>[<span style="color:#a6e22e">i</span>]];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernel</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// ç»˜åˆ¶åˆ°å¸§ç¼“å†²
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// å°†å½“å‰çš„ç»˜åˆ¶ç»“æœä½œä¸ºä¸‹ä¸€æ¬¡ç»˜åˆ¶çš„çº¹ç†æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindTexture</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TEXTURE_2D</span>, <span style="color:#a6e22e">textures</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// åç»­æ¯æ¬¡ç»˜åˆ¶ä½¿ç”¨ç¿»è½¬çŸ©é˜µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">setPixToTex</span>(<span style="color:#a6e22e">picToTexMat</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ç»˜åˆ¶æœ€ç»ˆç»“æœåˆ°canvas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">bindFramebuffer</span>(<span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">FRAMEBUFFER</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">TRIANGLES</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getCheckedValues</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">checkdboxes</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;#checkbox-container input&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">checkdboxes</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">checkdboxes</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">checked</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">checkdboxes</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">checked</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">checked</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">values</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      document
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;checkbox-container&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">getCheckedValues</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// æ¯ä¸€æ¬¡ç”»ä¹‹å‰ï¼Œæ¸…é™¤ä¸Šä¸€æ¬¡çš„å·ç§¯æ ¸ï¼Œé˜²æ­¢æ²¡æœ‰å‹¾é€‰å†…å®¹æ—¶ï¼Œä»ä½¿ç”¨ä¸Šä¸€ä¸ªå·ç§¯æ ¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">setKernelAndWeight</span>(<span style="color:#a6e22e">kernels</span>[<span style="color:#e6db74">&#34;normal&#34;</span>]);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">dealImage</span>(<span style="color:#a6e22e">values</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">prepareForRender</span>(<span style="color:#a6e22e">image</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">program</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">initProgram</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">vsSource2</span>, <span style="color:#a6e22e">fsSource</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆå§‹åŒ–é¡¶ç‚¹åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v1</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v2</span> <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v3</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v4</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_position&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v2</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v1</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v4</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">v3</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åˆå§‹åŒ–çº¹ç†åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">one</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">two</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">three</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">four</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">initAttributeVec2</span>(<span style="color:#a6e22e">gl</span>, <span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#34;a_texCoord&#34;</span>, [
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">two</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">one</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">four</span>,
</span></span><span style="display:flex;"><span>          ...<span style="color:#a6e22e">three</span>,
</span></span><span style="display:flex;"><span>        ]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">program</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/body&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/html&gt;</span>
</span></span></code></pre></div><blockquote>
<p>ä»£ç å¥½å¤šï¼Œéšä¾¿ä¸€ä¸ªç¤ºä¾‹éƒ½å¾—æœ‰å‡ ç™¾è¡Œåº“ğŸ˜­</p>
</blockquote>

          </div>
        </div>
                 
      
  
  
  
  

  

  <div class="article-paging">
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" ></div>
  <div class="card-text">
    <a href="/docs/en0rkylr58ns9y67/"><h4 class="card-text--title text-ellipsis">æ–‡ä»¶ä¸Šä¼ </h4></a>
    <p class="card-text--row">2023-07-06 07:36</p>
  </div>
</section>
    
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" background-image-lazy data-img="https://cdn.nlark.com/yuque/0/2023/png/29064333/1689063686800-83121075-329f-4e55-9442-1248a574fa4e.png"></div>
  <div class="card-text">
    <a href="/docs/hoi4g5unhcu8uf5d/"><h4 class="card-text--title text-ellipsis">çº¹ç†</h4></a>
    <p class="card-text--row">2023-07-06 02:11</p>
  </div>
</section>
    
  </div>
</div>
  <aside class="widget-info">
    
<section class="aside-widget widget-author content-padding-large soft-size--large soft-style--box">
  <div class="widget-body">
    <div class="author-box avatar">
      
      <img class="author-avatar soft-size--round soft-style--box" src="https://cdn.jsdelivr.net/gh/Sentisfate/wanhuatong@main/img/cdai.jfif" alt="gisculibur">
      
      <h2 class="author-name text-ellipsis">gisculibur</h2>
      
      <p class="author-desc text-ellipsis">æ–°æ‰‹WebGISæ”»åŸç‹®</p>
      
    </div>
  </div>
</section>


    

<section class="aside-widget widget-toc content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>ç›®å½•</span>
    </div>
  </h2>
  <div class="widget-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#æ¸²æŸ“å›¾åƒæµç¨‹">æ¸²æŸ“å›¾åƒæµç¨‹</a>
      <ul>
        <li><a href="#ç¼–å†™ç€è‰²å™¨">ç¼–å†™ç€è‰²å™¨</a></li>
        <li><a href="#è®¾å®šæ•°æ®æº">è®¾å®šæ•°æ®æº</a></li>
        <li><a href="#æ¸²æŸ“å›¾åƒ">æ¸²æŸ“å›¾åƒ</a></li>
        <li><a href="#ç®€å•å›¾åƒæ“ä½œ">ç®€å•å›¾åƒæ“ä½œ</a></li>
      </ul>
    </li>
    <li><a href="#å›¾åƒå¤„ç†">å›¾åƒå¤„ç†</a>
      <ul>
        <li><a href="#å›¾åƒæ»¤æ³¢å™¨">å›¾åƒæ»¤æ³¢å™¨</a>
          <ul>
            <li><a href="#å¹³æ»‘æ»¤æ³¢">å¹³æ»‘æ»¤æ³¢</a>
              <ul>
                <li><a href="#å‡å€¼æ»¤æ³¢">å‡å€¼æ»¤æ³¢</a></li>
                <li><a href="#ä¸­å€¼æ»¤æ³¢">ä¸­å€¼æ»¤æ³¢</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#ç´¯åŠ å›¾åƒå¤„ç†">ç´¯åŠ å›¾åƒå¤„ç†</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</section>


    










<section class="aside-widget widget-articles content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>ç›¸å…³æ–‡ç« </span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="post-list">
      
      
        <li class="post-item"><a href="/docs/ix726493ddpi6i3q/">3dTiles</a></li>
      
        <li class="post-item"><a href="/posts/qa4vydlw37pbsi3v/">WebGL å›¾åƒå¤„ç†</a></li>
      
        <li class="post-item"><a href="/docs/goz05uyu3i5v92c9/">Cesium æ¨¡å‹å‹å¹³</a></li>
      
        <li class="post-item"><a href="/docs/cl6l0mww8kkkizwb/">ä¸‰è§’å‰–åˆ†</a></li>
      
        <li class="post-item"><a href="/docs/prgrgit7lss8vggf/">GISç†è®ºåŸºç¡€</a></li>
      
        <li class="post-item"><a href="/docs/vzxnspucb4agb00w/">é—®é¢˜</a></li>
      
    </ul>
  </div>
</section>


    




<section class="aside-widget widget-categories content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>åˆ†ç±»</span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="categories-list">
      
        <li>
          <a href="https://Sentisfate.github.io/categories/webgl/">WebGL</a>
          <span>1</span>
        </li>
      
        <li>
          <a href="https://Sentisfate.github.io/categories/%E5%9B%BE%E5%BA%8A/">å›¾åºŠ</a>
          <span>1</span>
        </li>
      
    </ul>
  </div>

  
</section>


    




<section class="aside-widget widget-tags content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>æ ‡ç­¾</span>
    </div>
  </h2>
  <div class="widget-body">
    <div class="tags-list">
      
        <a href="https://Sentisfate.github.io/tags/github/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">github</a>
      
        <a href="https://Sentisfate.github.io/tags/picgo/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">picgo</a>
      
        <a href="https://Sentisfate.github.io/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">å›¾åƒå¤„ç†</a>
      
    </div>
  </div>

  
</section>

  </aside>
</div>
  </main><footer class="footer-container layout-block">
  
  <div class="social-icons">
    
      <a class="soft-size--primary soft-style--box" href="https://github.com/Sentisfate" target="_blank" rel="noopener noreferrer">
          
        <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
        </svg>
        

        

        

        

        
      </a>
    
  </div>
  

  <div class="colour-bar"></div>
  
  

  

  <p>
    Powered by
    <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a>
    Theme - 
    <a href="https://github.com/miiiku/hugo-theme-kagome" target="_blank" rel="noopener noreferrer author">kagome</a>
  </p>

  <p>
    <a href="javascript:;" id="theme-light">ğŸŒ æµ…è‰²</a>
    <a href="javascript:;" id="theme-dark">ğŸŒ› æ·±è‰²</a>
    <a href="javascript:;" id="theme-auto">ğŸ¤–ï¸ è‡ªåŠ¨</a>
  </p>
</footer>



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>






</body>

</html>